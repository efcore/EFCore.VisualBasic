Imports System.ComponentModel
Imports System.Data
Imports System.Linq.Expressions
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Design
Imports EntityFrameworkCore.VisualBasic.Design.AnnotationCodeGeneratorProvider
Imports EntityFrameworkCore.VisualBasic.Design.Internal
Imports EntityFrameworkCore.VisualBasic.Migrations.Design.VisualBasicMigrationsGeneratorTests
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.ChangeTracking
Imports Microsoft.EntityFrameworkCore.ChangeTracking.Internal
Imports Microsoft.EntityFrameworkCore.Cosmos.ValueGeneration.Internal
Imports Microsoft.EntityFrameworkCore.Design
Imports Microsoft.EntityFrameworkCore.Diagnostics
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.InMemory.Storage.Internal
Imports Microsoft.EntityFrameworkCore.Internal
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Builders
Imports Microsoft.EntityFrameworkCore.Metadata.Internal
Imports Microsoft.EntityFrameworkCore.Query.SqlExpressions
Imports Microsoft.EntityFrameworkCore.Scaffolding
Imports Microsoft.EntityFrameworkCore.Sqlite.Design.Internal
Imports Microsoft.EntityFrameworkCore.SqlServer.Design.Internal
Imports Microsoft.EntityFrameworkCore.SqlServer.Metadata.Internal
Imports Microsoft.EntityFrameworkCore.Storage
Imports Microsoft.EntityFrameworkCore.Storage.ValueConversion
Imports Microsoft.EntityFrameworkCore.ValueGeneration.Internal
Imports Microsoft.Extensions.DependencyInjection
Imports NetTopologySuite
Imports NetTopologySuite.Geometries
Imports Newtonsoft.Json.Linq
Imports Xunit

Namespace Global
    Public Class GlobalNamespaceContext
        Inherits ContextBase

        Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
            MyBase.OnModelCreating(modelBuilder)

            modelBuilder.Entity("1",
                Sub(e)
                    e.Property(Of Integer)("Id")
                    e.HasKey("Id")
                End Sub)
        End Sub
    End Class
End Namespace

Namespace Scaffolding.Internal
    Public Class VisualBasicRuntimeModelCodeGeneratorTest

        <ConditionalFact>
        Public Sub Self_referential_property()
            Test(New TestModel.Internal.SelfReferentialDbContext(),
                CreateCompiledModelCodeGenerationOptions(),
                assertModel:=Sub(Model)
                                 Assert.Single(Model.GetEntityTypes())
                                 Assert.Same(Model, Model.FindRuntimeAnnotationValue("ReadOnlyModel"))
                             End Sub
            )
        End Sub

        <ConditionalFact>
        Public Sub Empty_model()

            Dim rm1 As String =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.EmptyContext))>
    Public Partial Class EmptyContextModel
        Inherits RuntimeModel

        Private Shared _Instance As EmptyContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New EmptyContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim rm2 As String =
            <![CDATA[' <auto-generated />
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Public Partial Class EmptyContextModel

        Private Sub Initialize()
        End Sub
    End Class
End Namespace
]]>.Value

            Test(New EmptyContext(),
                 CreateCompiledModelCodeGenerationOptions(),
                 Sub(code)
                     Assert.
                        Collection(code,
                                   Sub(c) AssertFileContents("EmptyContextModel.vb", rm1, c),
                                   Sub(c) AssertFileContents("EmptyContextModelBuilder.vb", rm2, c))
                 End Sub,
                Sub(Model)
                    Assert.Empty(Model.GetEntityTypes())
                    Assert.Same(Model, Model.FindRuntimeAnnotationValue("ReadOnlyModel"))
                End Sub)
        End Sub

        Public Class EmptyContext
            Inherits ContextBase
        End Class

        <ConditionalFact>
        Public Sub Global_Namespace_works()
            Test(New GlobalNamespaceContext(),
                New CompiledModelCodeGenerationOptions With {
                    .Language = "VB",
                    .ModelNamespace = String.Empty
                },
                Sub(code)
                    Assert.All(code, Sub(f) Assert.DoesNotContain("Namespace ", f.Code))
                End Sub,
                Sub(Model)
                    Assert.NotNull(Model.FindEntityType("1"))
                End Sub)
        End Sub

        <ConditionalFact>
        Public Sub Throws_for_constructor_binding()
            Test(
                New ConstructorBindingContext(),
                CreateCompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=DesignStrings.CompiledModelConstructorBinding("Lazy", "Customize()", "LazyEntityType"))
        End Sub

        Public Class ConstructorBindingContext
            Inherits ContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(
                    "Lazy", Sub(e)
                                e.Property(Of Integer)("Id")
                                e.HasKey("Id")
                                DirectCast(e.Metadata, EntityType).ConstructorBinding = New ConstructorBinding(
                                    GetType(Object).GetConstructor(Type.EmptyTypes),
                                    Array.Empty(Of ParameterBinding)())
                            End Sub)
            End Sub

            Protected Overrides Sub OnConfiguring(options As DbContextOptionsBuilder)
                MyBase.OnConfiguring(options.UseLazyLoadingProxies())
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Manual_lazy_loading()
            Test(
                New LazyLoadingContext(),
                CreateCompiledModelCodeGenerationOptions(),
                assertModel:=Sub(Model)
                                 Dim lazyConstructorEntity = Model.FindEntityType(GetType(LazyConstructorEntity))
                                 Dim lazyParameterBinding = lazyConstructorEntity.ConstructorBinding.ParameterBindings.Single()
                                 Assert.Equal(GetType(ILazyLoader), lazyParameterBinding.ParameterType)

                                 Dim lazyPropertyEntity = Model.FindEntityType(GetType(LazyPropertyEntity))
                                 Dim lazyServiceProperty = lazyPropertyEntity.GetServiceProperties().Single()
                                 Assert.Equal(GetType(ILazyLoader), lazyServiceProperty.ClrType)

                                 Dim lazyPropertyDelegateEntity = Model.FindEntityType(GetType(LazyPropertyDelegateEntity))
                                 Assert.Equal(2, lazyPropertyDelegateEntity.GetServiceProperties().Count())
                                 Assert.Contains(lazyPropertyDelegateEntity.GetServiceProperties(), Function(p) p.ClrType = GetType(ILazyLoader))
                                 Assert.Contains(lazyPropertyDelegateEntity.GetServiceProperties(), Function(p) p.ClrType = GetType(Action(Of Object, String)))
                             End Sub)
        End Sub

        Public Class LazyLoadingContext
            Inherits ContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(Of LazyConstructorEntity)()

                modelBuilder.Entity(Of LazyPropertyDelegateEntity)(
                    Sub(b)
                        Dim ServiceProperty = DirectCast(b.Metadata.AddServiceProperty(
                                                    GetType(LazyPropertyDelegateEntity).GetAnyProperty("LoaderState"),
                                                    GetType(ILazyLoader)),
                                                ServiceProperty)

                        ServiceProperty.SetParameterBinding(
                            New DependencyInjectionParameterBinding(GetType(Object), GetType(ILazyLoader), ServiceProperty),
                            ConfigurationSource.Explicit)
                    End Sub)
            End Sub
        End Class

        Public Class LazyConstructorEntity
            Private ReadOnly _loader As ILazyLoader

            Public Sub New(loader As ILazyLoader)
                _loader = loader
            End Sub

            Public Property Id As Integer

            Public Property LazyPropertyEntity As LazyPropertyEntity
            Public Property LazyPropertyDelegateEntity As LazyPropertyDelegateEntity
        End Class

        Public Class LazyPropertyEntity
            Public Property Loader As ILazyLoader
            Public Property Id As Integer
            Public Property LazyConstructorEntityId As Integer

            Public Property LazyConstructorEntity As LazyConstructorEntity
        End Class

        Public Class LazyPropertyDelegateEntity
            Public Property LoaderState As Object
            Private Property LazyLoader As Action(Of Object, String)

            Public Property Id As Integer
            Public Property LazyConstructorEntityId As Integer

            Public Property LazyConstructorEntity As LazyConstructorEntity
        End Class

        <ConditionalFact>
        Public Sub Lazy_loading_proxies()
            Test(
                New LazyLoadingProxiesContext(),
                CreateCompiledModelCodeGenerationOptions(),
                assertModel:=
                    Sub(Model)
                        Assert.Equal(
                        GetType(ILazyLoader), Model.FindEntityType(GetType(LazyProxiesEntity1)).GetServiceProperties().Single().ClrType)
                        Assert.Equal(
                        GetType(ILazyLoader), Model.FindEntityType(GetType(LazyProxiesEntity1)).GetServiceProperties().Single().ClrType)
                    End Sub)
        End Sub

        Public Class LazyLoadingProxiesContext
            Inherits ContextBase
            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(Of LazyProxiesEntity1)()
            End Sub

            Protected Overrides Sub OnConfiguring(options As DbContextOptionsBuilder)
                MyBase.OnConfiguring(options.UseLazyLoadingProxies())
            End Sub
        End Class

        Public Class LazyProxiesEntity1
            Public Property Id As Integer

            Public Overridable Property ReferenceNavigation As LazyProxiesEntity2
        End Class

        Public Class LazyProxiesEntity2
            Public Property Loader As ILazyLoader

            Public Property Id As Integer
            Public Overridable Property CollectionNavigation As ICollection(Of LazyProxiesEntity1)
        End Class

        <ConditionalFact>
        Public Sub Throws_for_query_filter()
            Test(New QueryFilterContext(),
                 CreateCompiledModelCodeGenerationOptions(),
                 expectedExceptionMessage:=DesignStrings.CompiledModelQueryFilter("QueryFilter"))
        End Sub

        Public Class QueryFilterContext
            Inherits ContextBase
            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(
                    "QueryFilter", Sub(e)
                                       e.Property(Of Integer)("Id")
                                       e.HasKey("Id")
                                       e.HasQueryFilter(DirectCast(Function(x) x IsNot Nothing, Expression(Of Func(Of Dictionary(Of String, Object), Boolean))))
                                   End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Throws_for_defining_query()
            Test(
                New DefiningQueryContext(),
                CreateCompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=DesignStrings.CompiledModelDefiningQuery("object"))
        End Sub

        Public Class DefiningQueryContext
            Inherits ContextBase
            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(Of Object)(Sub(e)
                                                   e.Property(Of Integer)("Id")
                                                   e.HasKey("Id")
                                                   e.Metadata.SetInMemoryQuery(DirectCast(Function() [Set](Of Object)(), Expression(Of Func(Of IQueryable(Of Object)))))
                                               End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Throws_for_value_generator()
            Test(
                New ValueGeneratorContext(),
                CreateCompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=DesignStrings.CompiledModelValueGenerator(
                    "MyEntity", "Id", NameOf(PropertyBuilder.HasValueGeneratorFactory)))
        End Sub

        Public Class ValueGeneratorContext
            Inherits ContextBase
            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(
                    "MyEntity", Sub(e)
                                    e.Property(Of Integer)("Id").
                                                        HasValueGenerator(Function(p, en) Nothing)
                                    e.HasKey("Id")
                                End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Throws_for_value_converter()
            Test(New ValueConverterContext(),
                CreateCompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=DesignStrings.CompiledModelValueConverter(
                    "MyEntity", "Id", NameOf(PropertyBuilder.HasConversion)))
        End Sub

        Public Class ValueConverterContext
            Inherits ContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(
                    "MyEntity", Sub(e)
                                    e.Property(Of Integer)("Id").HasConversion(Function(i) i, Function(i) i)
                                    e.HasKey("Id")
                                End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Throws_for_value_comparer()
            Test(New ValueComparerContext(),
             CreateCompiledModelCodeGenerationOptions(),
             expectedExceptionMessage:=DesignStrings.CompiledModelValueComparer(
                "MyEntity", "Id", NameOf(PropertyBuilder.HasConversion)))
        End Sub

        Public Class ValueComparerContext
            Inherits ContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)

                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(
                    "MyEntity", Sub(e)
                                    e.Property(Of Integer)("Id").
                                            HasConversion(GetType(Integer), New FakeValueComparer())
                                    e.HasKey("Id")
                                End Sub)
            End Sub
        End Class

        Private Class FakeValueComparer
            Inherits ValueComparer(Of Integer)

            Public Sub New()
                MyBase.New(False)
            End Sub

            Public Overrides ReadOnly Property Type As Type = GetType(Integer)

            Public Overrides Function Equals(left As Object, right As Object) As Boolean
                Throw New NotImplementedException()
            End Function

            Public Overrides Function GetHashCode(instance As Object) As Integer
                Throw New NotImplementedException()
            End Function

            Public Overrides Function Snapshot(instance As Object) As Object
                Throw New NotImplementedException()
            End Function
        End Class

        <ConditionalFact>
        Public Sub Throws_for_provider_value_comparer()
            Test(
                New ProviderValueComparerContext,
                New CompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=DesignStrings.CompiledModelValueComparer(
                    "MyEntity", "Id", NameOf(PropertyBuilder.HasConversion)))
        End Sub

        Public Class ProviderValueComparerContext
            Inherits ContextBase
            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(
                    "MyEntity",
                    Sub(e)
                        e.Property(Of Integer)("Id").HasConversion(GetType(Integer), Nothing, New FakeValueComparer())
                        e.HasKey("Id")
                    End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Throws_for_custom_type_mapping()
            Test(
                New TypeMappingContext(),
                CreateCompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=DesignStrings.CompiledModelTypeMapping(
                    "MyEntity", "Id", "Customize()", "MyEntityEntityType"))
        End Sub

        Public Class TypeMappingContext
            Inherits ContextBase
            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(
                    "MyEntity",
                    Sub(e)
                        e.Property(Of Integer)("Id").
                            Metadata.SetTypeMapping(New InMemoryTypeMapping(GetType(Integer)))
                        e.HasKey("Id")
                    End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Throws_for_custom_function_translation()
            Test(
                New FunctionTranslationContext(),
                CreateCompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=RelationalStrings.CompiledModelFunctionTranslation("GetSqlFragmentShared"))
        End Sub

        Public Class FunctionTranslationContext
            Inherits SqlServerContextBase

            Public Shared Function GetSqlFragmentShared() As String
                Throw New NotImplementedException()
            End Function

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.
                    HasDbFunction(GetType(FunctionTranslationContext).
                    GetMethod(NameOf(GetSqlFragmentShared))).
                    HasTranslation(Function(args) New SqlFragmentExpression("NULL"))
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Throws_for_custom_function_type_mapping()
            Test(
                New FunctionTypeMappingContext(),
                CreateCompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=RelationalStrings.CompiledModelFunctionTypeMapping(
                    "GetSqlFragmentShared", "Customize()", "FunctionTypeMappingContextModel"))
        End Sub

        Public Class FunctionTypeMappingContext
            Inherits SqlServerContextBase

            Public Shared Function GetSqlFragmentShared(param As String) As String
                Throw New NotImplementedException()
            End Function

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.
                    HasDbFunction(GetType(FunctionTypeMappingContext).
                    GetMethod(NameOf(GetSqlFragmentShared))).
                    Metadata.TypeMapping = New StringTypeMapping("varchar", DbType.AnsiString)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Throws_for_custom_function_parameter_type_mapping()
            Test(
                New FunctionParameterTypeMappingContext(),
                CreateCompiledModelCodeGenerationOptions(),
                expectedExceptionMessage:=RelationalStrings.CompiledModelFunctionParameterTypeMapping(
                    "GetSqlFragmentShared", "param", "Customize()", "FunctionParameterTypeMappingContextModel"))
        End Sub

        Public Class FunctionParameterTypeMappingContext
            Inherits SqlServerContextBase

            Public Shared Function GetSqlFragmentShared(param As String) As String
                Throw New NotImplementedException()
            End Function

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.
                    HasDbFunction(GetType(FunctionParameterTypeMappingContext).
                    GetMethod(NameOf(GetSqlFragmentShared))).
                    HasParameter("param").Metadata.TypeMapping = New StringTypeMapping("varchar", DbType.AnsiString)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Fully_qualified_model()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.TestModel.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace Internal
    <DbContext(GetType(DbContext))>
    Public Partial Class DbContextModel
        Inherits RuntimeModel

        Private Shared _Instance As DbContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New DbContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim DbContext =
            <![CDATA[' <auto-generated />
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace Internal
    Public Partial Class DbContextModel

        Private Sub Initialize()
            Dim index = IndexEntityType.Create(Me)
            Dim internal = InternalEntityType.Create(Me)
            Dim identityUser = IdentityUserEntityType.Create(Me)
            Dim identityUser0 = IdentityUser0EntityType.Create(Me, identityUser)

            IndexEntityType.CreateAnnotations(index)
            InternalEntityType.CreateAnnotations(internal)
            IdentityUserEntityType.CreateAnnotations(identityUser)
            IdentityUser0EntityType.CreateAnnotations(identityUser0)

        End Sub
    End Class
End Namespace
]]>.Value

            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace Internal
    Friend Partial Class IndexEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.Index",
                GetType(EntityFrameworkCore.VisualBasic.Scaffolding.Internal.Index),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Guid),
                propertyInfo:=GetType(EntityFrameworkCore.VisualBasic.Scaffolding.Internal.Index).GetProperty("Id", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(EntityFrameworkCore.VisualBasic.Scaffolding.Internal.Index).GetField("_Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace Internal
    Friend Partial Class InternalEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.Internal",
                GetType(EntityFrameworkCore.VisualBasic.Scaffolding.Internal.Internal),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Long),
                propertyInfo:=GetType(EntityFrameworkCore.VisualBasic.Scaffolding.Internal.Internal).GetProperty("Id", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(EntityFrameworkCore.VisualBasic.Scaffolding.Internal.Internal).GetField("_Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e3 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.TestModels.AspNetIdentity
Imports Microsoft.EntityFrameworkCore.ValueGeneration

Namespace Internal
    Friend Partial Class IdentityUserEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "Microsoft.EntityFrameworkCore.TestModels.AspNetIdentity.IdentityUser",
                GetType(IdentityUser),
                baseEntityType,
                discriminatorProperty:="Discriminator",
                discriminatorValue:="IdentityUser")

            Dim id = entityType.AddProperty(
                "Id",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("Id", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<Id>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                afterSaveBehavior:=PropertySaveBehavior.Throw)

            Dim accessFailedCount = entityType.AddProperty(
                "AccessFailedCount",
                GetType(Integer),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("AccessFailedCount", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<AccessFailedCount>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim concurrencyStamp = entityType.AddProperty(
                "ConcurrencyStamp",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("ConcurrencyStamp", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<ConcurrencyStamp>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim discriminator = entityType.AddProperty(
                "Discriminator",
                GetType(String),
                afterSaveBehavior:=PropertySaveBehavior.Throw,
                valueGeneratorFactory:=AddressOf New DiscriminatorValueGeneratorFactory().Create)

            Dim email = entityType.AddProperty(
                "Email",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("Email", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<Email>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim emailConfirmed = entityType.AddProperty(
                "EmailConfirmed",
                GetType(Boolean),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("EmailConfirmed", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<EmailConfirmed>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim lockoutEnabled = entityType.AddProperty(
                "LockoutEnabled",
                GetType(Boolean),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("LockoutEnabled", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<LockoutEnabled>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim lockoutEnd = entityType.AddProperty(
                "LockoutEnd",
                GetType(DateTimeOffset?),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("LockoutEnd", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<LockoutEnd>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim normalizedEmail = entityType.AddProperty(
                "NormalizedEmail",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("NormalizedEmail", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<NormalizedEmail>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim normalizedUserName = entityType.AddProperty(
                "NormalizedUserName",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("NormalizedUserName", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<NormalizedUserName>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim passwordHash = entityType.AddProperty(
                "PasswordHash",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("PasswordHash", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<PasswordHash>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim phoneNumber = entityType.AddProperty(
                "PhoneNumber",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("PhoneNumber", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<PhoneNumber>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim phoneNumberConfirmed = entityType.AddProperty(
                "PhoneNumberConfirmed",
                GetType(Boolean),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("PhoneNumberConfirmed", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<PhoneNumberConfirmed>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim securityStamp = entityType.AddProperty(
                "SecurityStamp",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("SecurityStamp", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<SecurityStamp>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim twoFactorEnabled = entityType.AddProperty(
                "TwoFactorEnabled",
                GetType(Boolean),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("TwoFactorEnabled", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<TwoFactorEnabled>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim userName = entityType.AddProperty(
                "UserName",
                GetType(String),
                propertyInfo:=GetType(IdentityUser(Of String)).GetProperty("UserName", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(IdentityUser(Of String)).GetField("<UserName>k__BackingField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e4 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace Internal
    Friend Partial Class IdentityUser0EntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.IdentityUser",
                GetType(IdentityUser),
                baseEntityType,
                discriminatorProperty:="Discriminator",
                discriminatorValue:="DerivedIdentityUser")

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim CompiledModelCodeGenerationOptions = CreateCompiledModelCodeGenerationOptions()
            CompiledModelCodeGenerationOptions.ModelNamespace = "Internal"

            Test(
                New TestModel.Internal.DbContext(),
                CompiledModelCodeGenerationOptions,
                Sub(code)
                    Assert.Collection(
                        code,
                        Sub(c) AssertFileContents("DbContextModel.vb", rm1, c),
                        Sub(c) AssertFileContents("DbContextModelBuilder.vb", DbContext, c),
                        Sub(c) AssertFileContents("IndexEntityType.vb", e1, c),
                        Sub(c) AssertFileContents("InternalEntityType.vb", e2, c),
                        Sub(c) AssertFileContents("IdentityUserEntityType.vb", e3, c),
                        Sub(c) AssertFileContents("IdentityUser0EntityType.vb", e4, c))
                End Sub,
                Sub(Model)
                    Assert.Equal(4, Model.GetEntityTypes().Count())
                    Assert.Same(Model, Model.FindRuntimeAnnotationValue("ReadOnlyModel"))
                End Sub,
                additionalDesignTimeServices:=GetType(FullyQualifiedDesignTimeServices))
        End Sub

        Private Class FullyQualifiedDesignTimeServices
            Implements IDesignTimeServices
            Public Sub ConfigureDesignTimeServices(serviceCollection As IServiceCollection) _
                Implements IDesignTimeServices.ConfigureDesignTimeServices

                serviceCollection.AddSingleton(Of IVisualBasicHelper, FullyQualifiedVisualBasicHelper)()
            End Sub
        End Class

        Private Class FullyQualifiedVisualBasicHelper
            Inherits VisualBasicHelper

            Public Sub New(typeMappingSource As ITypeMappingSource)
                MyBase.New(typeMappingSource)
            End Sub

            Protected Overrides Function ShouldUseFullName(type As Type) As Boolean
                Return MyBase.ShouldUseFullName(type)
            End Function

            Protected Overrides Function ShouldUseFullName(shortTypeName As String) As Boolean
                Return MyBase.ShouldUseFullName(shortTypeName) OrElse
                       shortTypeName = NameOf(Index) OrElse
                       shortTypeName = NameOf(Internal)
            End Function
        End Class

        <ConditionalFact>
        Public Sub BigModel()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.BigContext))>
    Public Partial Class BigContextModel
        Inherits RuntimeModel

        Private Shared _Instance As BigContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New BigContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Internal
Imports Microsoft.EntityFrameworkCore.Migrations

Namespace TestNamespace
    Public Partial Class BigContextModel

        Private Sub Initialize()
            Dim dependentBase = DependentBaseEntityType.Create(Me)
            Dim principalBase = PrincipalBaseEntityType.Create(Me)
            Dim ownedType = OwnedTypeEntityType.Create(Me)
            Dim ownedType0 = OwnedType0EntityType.Create(Me)
            Dim principalBasePrincipalDerivedDependentBasebyte = PrincipalBasePrincipalDerivedDependentBasebyteEntityType.Create(Me)
            Dim dependentDerived = DependentDerivedEntityType.Create(Me, dependentBase)
            Dim principalDerived = PrincipalDerivedEntityType.Create(Me, principalBase)

            DependentBaseEntityType.CreateForeignKey1(dependentBase, principalBase)
            DependentBaseEntityType.CreateForeignKey2(dependentBase, principalDerived)
            OwnedTypeEntityType.CreateForeignKey1(ownedType, principalBase)
            OwnedTypeEntityType.CreateForeignKey2(ownedType, ownedType)
            OwnedType0EntityType.CreateForeignKey1(ownedType0, principalDerived)
            PrincipalBasePrincipalDerivedDependentBasebyteEntityType.CreateForeignKey1(principalBasePrincipalDerivedDependentBasebyte, principalDerived)
            PrincipalBasePrincipalDerivedDependentBasebyteEntityType.CreateForeignKey2(principalBasePrincipalDerivedDependentBasebyte, principalBase)
            PrincipalDerivedEntityType.CreateForeignKey1(principalDerived, principalBase)

            PrincipalBaseEntityType.CreateSkipNavigation1(principalBase, principalDerived, principalBasePrincipalDerivedDependentBasebyte)
            PrincipalDerivedEntityType.CreateSkipNavigation1(principalDerived, principalBase, principalBasePrincipalDerivedDependentBasebyte)

            DependentBaseEntityType.CreateAnnotations(dependentBase)
            PrincipalBaseEntityType.CreateAnnotations(principalBase)
            OwnedTypeEntityType.CreateAnnotations(ownedType)
            OwnedType0EntityType.CreateAnnotations(ownedType0)
            PrincipalBasePrincipalDerivedDependentBasebyteEntityType.CreateAnnotations(principalBasePrincipalDerivedDependentBasebyte)
            DependentDerivedEntityType.CreateAnnotations(dependentDerived)
            PrincipalDerivedEntityType.CreateAnnotations(principalDerived)

            AddAnnotation("Relational:MaxIdentifierLength", 128)
            AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim dependentBase = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            dependentBase.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>", Nothing, relationalModel)
            Dim dataColumnBase As New ColumnBase(Of ColumnMappingBase)("Data", "char(20)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Data", dataColumnBase)
            Dim enumDiscriminatorColumnBase As New ColumnBase(Of ColumnMappingBase)("EnumDiscriminator", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("EnumDiscriminator", enumDiscriminatorColumnBase)
            Dim idColumnBase As New ColumnBase(Of ColumnMappingBase)("Id", "tinyint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Id", idColumnBase)
            Dim moneyColumnBase As New ColumnBase(Of ColumnMappingBase)("Money", "decimal(9,3)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Money", moneyColumnBase)
            Dim principalAlternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalAlternateId", "uniqueidentifier", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("PrincipalAlternateId", principalAlternateIdColumnBase)
            Dim principalIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalId", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("PrincipalId", principalIdColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase As New TableMappingBase(Of ColumnMappingBase)(dependentBase, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalAlternateId"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("PrincipalAlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalId"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("PrincipalId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("EnumDiscriminator"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("EnumDiscriminator"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)

            Dim tableMappings As New List(Of TableMapping)()
            dependentBase.SetRuntimeAnnotation("Relational:TableMappings", tableMappings)
            Dim dependentBasebyteTable As New Table("DependentBase<byte?>", Nothing, relationalModel)
            Dim principalIdColumn As New Column("PrincipalId", "bigint", dependentBasebyteTable)
            dependentBasebyteTable.Columns.Add("PrincipalId", principalIdColumn)
            Dim principalAlternateIdColumn As New Column("PrincipalAlternateId", "uniqueidentifier", dependentBasebyteTable)
            dependentBasebyteTable.Columns.Add("PrincipalAlternateId", principalAlternateIdColumn)
            Dim dataColumn As New Column("Data", "char(20)", dependentBasebyteTable) With {
                .IsNullable = True
            }
            dependentBasebyteTable.Columns.Add("Data", dataColumn)
            Dim enumDiscriminatorColumn As New Column("EnumDiscriminator", "int", dependentBasebyteTable)
            dependentBasebyteTable.Columns.Add("EnumDiscriminator", enumDiscriminatorColumn)
            Dim idColumn As New Column("Id", "tinyint", dependentBasebyteTable) With {
                .IsNullable = True
            }
            dependentBasebyteTable.Columns.Add("Id", idColumn)
            Dim moneyColumn As New Column("Money", "decimal(9,3)", dependentBasebyteTable) With {
                .IsNullable = True
            }
            dependentBasebyteTable.Columns.Add("Money", moneyColumn)
            Dim pK_DependentBasebyte As New UniqueConstraint("PK_DependentBase<byte?>", dependentBasebyteTable, {principalIdColumn, principalAlternateIdColumn})
            dependentBasebyteTable.PrimaryKey = pK_DependentBasebyte
            Dim pK_DependentBasebyteUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId", "PrincipalAlternateId"})
            pK_DependentBasebyte.MappedKeys.Add(pK_DependentBasebyteUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DependentBasebyteUc).Add(pK_DependentBasebyte)
            dependentBasebyteTable.UniqueConstraints.Add("PK_DependentBase<byte?>", pK_DependentBasebyte)
            Dim iX_DependentBasebyte_PrincipalId As New TableIndex(
            "IX_DependentBase<byte?>_PrincipalId", dependentBasebyteTable, {principalIdColumn}, True)
            Dim iX_DependentBasebyte_PrincipalIdIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId"})
            iX_DependentBasebyte_PrincipalId.MappedIndexes.Add(iX_DependentBasebyte_PrincipalIdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_DependentBasebyte_PrincipalIdIx).Add(iX_DependentBasebyte_PrincipalId)
            dependentBasebyteTable.Indexes.Add("IX_DependentBase<byte?>_PrincipalId", iX_DependentBasebyte_PrincipalId)
            relationalModel.Tables.Add(("DependentBase<byte?>", Nothing), dependentBasebyteTable)
            Dim dependentBasebyteTableMapping As New TableMapping(dependentBase, dependentBasebyteTable, True) With {
                .IsSharedTablePrincipal = True
            }
            dependentBasebyteTable.AddEntityTypeMapping(dependentBasebyteTableMapping, False)
            tableMappings.Add(dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalAlternateId"), dependentBase.FindProperty("PrincipalAlternateId"), dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalId"), dependentBase.FindProperty("PrincipalId"), dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("EnumDiscriminator"), dependentBase.FindProperty("EnumDiscriminator"), dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Id"), dependentBase.FindProperty("Id"), dependentBasebyteTableMapping)

            Dim dependentDerived = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentDerived<byte?>")

            Dim defaultTableMappings0 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            dependentDerived.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings0)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0 As New TableMappingBase(Of ColumnMappingBase)(dependentDerived, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0, False)
            defaultTableMappings0.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalAlternateId"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("PrincipalAlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalId"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("PrincipalId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Data"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("Data"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("EnumDiscriminator"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("EnumDiscriminator"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Money"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("Money"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)

            Dim tableMappings0 As New List(Of TableMapping)()
            dependentDerived.SetRuntimeAnnotation("Relational:TableMappings", tableMappings0)
            Dim dependentBasebyteTableMapping0 As New TableMapping(dependentDerived, dependentBasebyteTable, True) With {
                .IsSharedTablePrincipal = False
            }
            dependentBasebyteTable.AddEntityTypeMapping(dependentBasebyteTableMapping0, False)
            tableMappings0.Add(dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalAlternateId"), dependentDerived.FindProperty("PrincipalAlternateId"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalId"), dependentDerived.FindProperty("PrincipalId"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Data"), dependentDerived.FindProperty("Data"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("EnumDiscriminator"), dependentDerived.FindProperty("EnumDiscriminator"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Id"), dependentDerived.FindProperty("Id"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Money"), dependentDerived.FindProperty("Money"), dependentBasebyteTableMapping0)

            Dim principalBase = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase")

            Dim defaultTableMappings1 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalBase.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings1)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase", Nothing, relationalModel)
            Dim alternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("AlternateId", "uniqueidentifier", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("AlternateId", alternateIdColumnBase)
            Dim idColumnBase0 As New ColumnBase(Of ColumnMappingBase)("Id", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("Id", idColumnBase0)
            Dim pointColumnBase As New ColumnBase(Of ColumnMappingBase)("Point", "geometry", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("Point", pointColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase As New TableMappingBase(Of ColumnMappingBase)(principalBase, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase, False)
            defaultTableMappings1.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("AlternateId"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("AlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Point"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("Point"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)

            Dim tableMappings1 As New List(Of TableMapping)()
            principalBase.SetRuntimeAnnotation("Relational:TableMappings", tableMappings1)
            Dim principalBaseTable As New Table("PrincipalBase", "mySchema", relationalModel)
            Dim idColumn0 As New Column("Id", "bigint", principalBaseTable)
            principalBaseTable.Columns.Add("Id", idColumn0)
            Dim alternateIdColumn As New Column("AlternateId", "uniqueidentifier", principalBaseTable)
            principalBaseTable.Columns.Add("AlternateId", alternateIdColumn)
            Dim owned_NumberColumn As New Column("Owned_Number", "int", principalBaseTable)
            principalBaseTable.Columns.Add("Owned_Number", owned_NumberColumn)
            Dim pointColumn As New Column("Point", "geometry", principalBaseTable) With {
                .IsNullable = True
            }
            principalBaseTable.Columns.Add("Point", pointColumn)
            Dim aK_PrincipalBase_Id As New UniqueConstraint("AK_PrincipalBase_Id", principalBaseTable, {idColumn0})
            Dim aK_PrincipalBase_IdUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id"})
            aK_PrincipalBase_Id.MappedKeys.Add(aK_PrincipalBase_IdUc)
            RelationalModel.GetOrCreateUniqueConstraints(aK_PrincipalBase_IdUc).Add(aK_PrincipalBase_Id)
            principalBaseTable.UniqueConstraints.Add("AK_PrincipalBase_Id", aK_PrincipalBase_Id)
            Dim pK As New UniqueConstraint("PK", principalBaseTable, {idColumn0, alternateIdColumn})
            principalBaseTable.PrimaryKey = pK
            Dim pKUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id", "AlternateId"})
            pK.MappedKeys.Add(pKUc)
            RelationalModel.GetOrCreateUniqueConstraints(pKUc).Add(pK)
            Dim pKUc0 = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType",
                {"PrincipalBaseId", "PrincipalBaseAlternateId"})
            pK.MappedKeys.Add(pKUc0)
            RelationalModel.GetOrCreateUniqueConstraints(pKUc0).Add(pK)
            principalBaseTable.UniqueConstraints.Add("PK", pK)
            Dim iX_PrincipalBase_AlternateId_Id As New TableIndex(
            "IX_PrincipalBase_AlternateId_Id", principalBaseTable, {alternateIdColumn, idColumn0}, False)
            Dim iX_PrincipalBase_AlternateId_IdIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"AlternateId", "Id"})
            iX_PrincipalBase_AlternateId_Id.MappedIndexes.Add(iX_PrincipalBase_AlternateId_IdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_PrincipalBase_AlternateId_IdIx).Add(iX_PrincipalBase_AlternateId_Id)
            principalBaseTable.Indexes.Add("IX_PrincipalBase_AlternateId_Id", iX_PrincipalBase_AlternateId_Id)
            relationalModel.Tables.Add(("PrincipalBase", "mySchema"), principalBaseTable)
            Dim principalBaseTableMapping As New TableMapping(principalBase, principalBaseTable, True) With {
                .IsSharedTablePrincipal = True
            }
            principalBaseTable.AddEntityTypeMapping(principalBaseTableMapping, False)
            tableMappings1.Add(principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("AlternateId"), principalBase.FindProperty("AlternateId"), principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Id"), principalBase.FindProperty("Id"), principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Point"), principalBase.FindProperty("Point"), principalBaseTableMapping)

            Dim ownedType = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType")

            Dim defaultTableMappings2 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            ownedType.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings2)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType", Nothing, relationalModel)
            Dim detailsColumnBase As New ColumnBase(Of ColumnMappingBase)("Details", "nvarchar(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.Columns.Add("Details", detailsColumnBase)
            Dim numberColumnBase As New ColumnBase(Of ColumnMappingBase)("Number", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.Columns.Add("Number", numberColumnBase)
            Dim principalBaseAlternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalBaseAlternateId", "uniqueidentifier", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.Columns.Add("PrincipalBaseAlternateId", principalBaseAlternateIdColumnBase)
            Dim principalBaseIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalBaseId", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.Columns.Add("PrincipalBaseId", principalBaseIdColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase As New TableMappingBase(Of ColumnMappingBase)(ownedType, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase, False)
            defaultTableMappings2.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.FindColumn("PrincipalBaseAlternateId"), ColumnBase(Of ColumnMappingBase)), ownedType.FindProperty("PrincipalBaseAlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.FindColumn("PrincipalBaseId"), ColumnBase(Of ColumnMappingBase)), ownedType.FindProperty("PrincipalBaseId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.FindColumn("Details"), ColumnBase(Of ColumnMappingBase)), ownedType.FindProperty("Details"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.FindColumn("Number"), ColumnBase(Of ColumnMappingBase)), ownedType.FindProperty("Number"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase)

            Dim tableMappings2 As New List(Of TableMapping)()
            ownedType.SetRuntimeAnnotation("Relational:TableMappings", tableMappings2)
            Dim principalBaseTableMapping0 As New TableMapping(ownedType, principalBaseTable, True) With {
                .IsSharedTablePrincipal = False,
                .IsSplitEntityTypePrincipal = True
            }
            principalBaseTable.AddEntityTypeMapping(principalBaseTableMapping0, False)
            tableMappings2.Add(principalBaseTableMapping0)
            principalBaseTable.AddRowInternalForeignKey(ownedType, RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType",
                {"PrincipalBaseId", "PrincipalBaseAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id", "AlternateId"}))
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("AlternateId"), ownedType.FindProperty("PrincipalBaseAlternateId"), principalBaseTableMapping0)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Id"), ownedType.FindProperty("PrincipalBaseId"), principalBaseTableMapping0)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Owned_Number"), ownedType.FindProperty("Number"), principalBaseTableMapping0)
            Dim detailsTable As New Table("Details", Nothing, relationalModel)
            Dim principalBaseIdColumn As New Column("PrincipalBaseId", "bigint", detailsTable)
            detailsTable.Columns.Add("PrincipalBaseId", principalBaseIdColumn)
            Dim principalBaseAlternateIdColumn As New Column("PrincipalBaseAlternateId", "uniqueidentifier", detailsTable)
            detailsTable.Columns.Add("PrincipalBaseAlternateId", principalBaseAlternateIdColumn)
            Dim detailsColumn As New Column("Details", "nvarchar(max)", detailsTable) With {
                .IsNullable = True
            }
            detailsTable.Columns.Add("Details", detailsColumn)
            Dim pK_Details As New UniqueConstraint("PK_Details", detailsTable, {principalBaseIdColumn, principalBaseAlternateIdColumn})
            detailsTable.PrimaryKey = pK_Details
            Dim pK_DetailsUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType",
                {"PrincipalBaseId", "PrincipalBaseAlternateId"})
            pK_Details.MappedKeys.Add(pK_DetailsUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DetailsUc).Add(pK_Details)
            detailsTable.UniqueConstraints.Add("PK_Details", pK_Details)
            relationalModel.Tables.Add(("Details", Nothing), detailsTable)
            Dim detailsTableMapping As New TableMapping(ownedType, detailsTable, True) With {
                .IsSplitEntityTypePrincipal = False
            }
            detailsTable.AddEntityTypeMapping(detailsTableMapping, False)
            tableMappings2.Add(detailsTableMapping)
            RelationalModel.CreateColumnMapping(detailsTable.FindColumn("PrincipalBaseAlternateId"), ownedType.FindProperty("PrincipalBaseAlternateId"), detailsTableMapping)
            RelationalModel.CreateColumnMapping(detailsTable.FindColumn("PrincipalBaseId"), ownedType.FindProperty("PrincipalBaseId"), detailsTableMapping)
            RelationalModel.CreateColumnMapping(detailsTable.FindColumn("Details"), ownedType.FindProperty("Details"), detailsTableMapping)

            Dim principalDerived = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>")

            Dim defaultTableMappings3 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalDerived.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings3)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0 As New TableMappingBase(Of ColumnMappingBase)(principalDerived, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase, False)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0, False)
            defaultTableMappings3.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("AlternateId"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("AlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Point"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("Point"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)

            Dim defaultTableMappings4 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalDerived.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings4)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>", Nothing, relationalModel)
            Dim alternateIdColumnBase0 As New ColumnBase(Of ColumnMappingBase)("AlternateId", "uniqueidentifier", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("AlternateId", alternateIdColumnBase0)
            Dim idColumnBase1 As New ColumnBase(Of ColumnMappingBase)("Id", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Id", idColumnBase1)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase As New TableMappingBase(Of ColumnMappingBase)(principalDerived, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase, False)
            defaultTableMappings4.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("AlternateId"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("AlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)

            Dim tableMappings3 As New List(Of TableMapping)()
            principalDerived.SetRuntimeAnnotation("Relational:TableMappings", tableMappings3)
            Dim principalBaseTableMapping1 As New TableMapping(principalDerived, principalBaseTable, False) With {
                .IsSharedTablePrincipal = False
            }
            principalBaseTable.AddEntityTypeMapping(principalBaseTableMapping1, False)
            tableMappings3.Add(principalBaseTableMapping1)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("AlternateId"), principalDerived.FindProperty("AlternateId"), principalBaseTableMapping1)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Id"), principalDerived.FindProperty("Id"), principalBaseTableMapping1)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Point"), principalDerived.FindProperty("Point"), principalBaseTableMapping1)
            Dim principalDerivedTable As New Table("PrincipalDerived", Nothing, relationalModel)
            Dim derivedIdColumn As New Column("DerivedId", "bigint", principalDerivedTable)
            principalDerivedTable.Columns.Add("DerivedId", derivedIdColumn)
            Dim alternateIdColumn0 As New Column("AlternateId", "uniqueidentifier", principalDerivedTable)
            principalDerivedTable.Columns.Add("AlternateId", alternateIdColumn0)
            Dim aK_PrincipalDerived_DerivedId As New UniqueConstraint("AK_PrincipalDerived_DerivedId", principalDerivedTable, {derivedIdColumn})
            Dim aK_PrincipalDerived_DerivedIdUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id"})
            aK_PrincipalDerived_DerivedId.MappedKeys.Add(aK_PrincipalDerived_DerivedIdUc)
            RelationalModel.GetOrCreateUniqueConstraints(aK_PrincipalDerived_DerivedIdUc).Add(aK_PrincipalDerived_DerivedId)
            principalDerivedTable.UniqueConstraints.Add("AK_PrincipalDerived_DerivedId", aK_PrincipalDerived_DerivedId)
            Dim pK0 As New UniqueConstraint("PK", principalDerivedTable, {derivedIdColumn, alternateIdColumn0})
            principalDerivedTable.PrimaryKey = pK0
            Dim pK0Uc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id", "AlternateId"})
            pK0.MappedKeys.Add(pK0Uc)
            RelationalModel.GetOrCreateUniqueConstraints(pK0Uc).Add(pK0)
            principalDerivedTable.UniqueConstraints.Add("PK", pK0)
            Dim iX_PrincipalDerived_AlternateId_DerivedId As New TableIndex(
            "IX_PrincipalDerived_AlternateId_DerivedId", principalDerivedTable, {alternateIdColumn0, derivedIdColumn}, False)
            Dim iX_PrincipalDerived_AlternateId_DerivedIdIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"AlternateId", "Id"})
            iX_PrincipalDerived_AlternateId_DerivedId.MappedIndexes.Add(iX_PrincipalDerived_AlternateId_DerivedIdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_PrincipalDerived_AlternateId_DerivedIdIx).Add(iX_PrincipalDerived_AlternateId_DerivedId)
            principalDerivedTable.Indexes.Add("IX_PrincipalDerived_AlternateId_DerivedId", iX_PrincipalDerived_AlternateId_DerivedId)
            relationalModel.Tables.Add(("PrincipalDerived", Nothing), principalDerivedTable)
            Dim principalDerivedTableMapping As New TableMapping(principalDerived, principalDerivedTable, True)
            principalDerivedTable.AddEntityTypeMapping(principalDerivedTableMapping, False)
            tableMappings3.Add(principalDerivedTableMapping)
            RelationalModel.CreateColumnMapping(principalDerivedTable.FindColumn("AlternateId"), principalDerived.FindProperty("AlternateId"), principalDerivedTableMapping)
            RelationalModel.CreateColumnMapping(principalDerivedTable.FindColumn("DerivedId"), principalDerived.FindProperty("Id"), principalDerivedTableMapping)

            Dim ownedType0 = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType")

            Dim defaultTableMappings5 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            ownedType0.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings5)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType", Nothing, relationalModel)
            Dim detailsColumnBase0 As New ColumnBase(Of ColumnMappingBase)("Details", "nvarchar(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.Columns.Add("Details", detailsColumnBase0)
            Dim idColumnBase2 As New ColumnBase(Of ColumnMappingBase)("Id", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.Columns.Add("Id", idColumnBase2)
            Dim numberColumnBase0 As New ColumnBase(Of ColumnMappingBase)("Number", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.Columns.Add("Number", numberColumnBase0)
            Dim principalDerivedDependentBasebyteAlternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalDerived<DependentBase<byte?>>AlternateId", "uniqueidentifier", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.Columns.Add("PrincipalDerived<DependentBase<byte?>>AlternateId", principalDerivedDependentBasebyteAlternateIdColumnBase)
            Dim principalDerivedDependentBasebyteIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalDerived<DependentBase<byte?>>Id", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.Columns.Add("PrincipalDerived<DependentBase<byte?>>Id", principalDerivedDependentBasebyteIdColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase As New TableMappingBase(Of ColumnMappingBase)(ownedType0, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase, False)
            defaultTableMappings5.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), ownedType0.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.FindColumn("PrincipalDerived<DependentBase<byte?>>AlternateId"), ColumnBase(Of ColumnMappingBase)), ownedType0.FindProperty("PrincipalDerivedAlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.FindColumn("PrincipalDerived<DependentBase<byte?>>Id"), ColumnBase(Of ColumnMappingBase)), ownedType0.FindProperty("PrincipalDerivedId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.FindColumn("Details"), ColumnBase(Of ColumnMappingBase)), ownedType0.FindProperty("Details"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.FindColumn("Number"), ColumnBase(Of ColumnMappingBase)), ownedType0.FindProperty("Number"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase)

            Dim tableMappings4 As New List(Of TableMapping)()
            ownedType0.SetRuntimeAnnotation("Relational:TableMappings", tableMappings4)
            Dim manyOwnedTable As New Table("ManyOwned", Nothing, relationalModel)
            Dim principalDerivedDependentBasebyteIdColumn As New Column("PrincipalDerived<DependentBase<byte?>>Id", "bigint", manyOwnedTable)
            manyOwnedTable.Columns.Add("PrincipalDerived<DependentBase<byte?>>Id", principalDerivedDependentBasebyteIdColumn)
            Dim principalDerivedDependentBasebyteAlternateIdColumn As New Column("PrincipalDerived<DependentBase<byte?>>AlternateId", "uniqueidentifier", manyOwnedTable)
            manyOwnedTable.Columns.Add("PrincipalDerived<DependentBase<byte?>>AlternateId", principalDerivedDependentBasebyteAlternateIdColumn)
            Dim idColumn1 As New Column("Id", "int", manyOwnedTable)
            manyOwnedTable.Columns.Add("Id", idColumn1)
            Dim detailsColumn0 As New Column("Details", "nvarchar(max)", manyOwnedTable) With {
                .IsNullable = True
            }
            manyOwnedTable.Columns.Add("Details", detailsColumn0)
            Dim numberColumn As New Column("Number", "int", manyOwnedTable)
            manyOwnedTable.Columns.Add("Number", numberColumn)
            Dim pK_ManyOwned As New UniqueConstraint("PK_ManyOwned", manyOwnedTable, {principalDerivedDependentBasebyteIdColumn, principalDerivedDependentBasebyteAlternateIdColumn, idColumn1})
            manyOwnedTable.PrimaryKey = pK_ManyOwned
            Dim pK_ManyOwnedUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType",
                {"PrincipalDerivedId", "PrincipalDerivedAlternateId", "Id"})
            pK_ManyOwned.MappedKeys.Add(pK_ManyOwnedUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_ManyOwnedUc).Add(pK_ManyOwned)
            manyOwnedTable.UniqueConstraints.Add("PK_ManyOwned", pK_ManyOwned)
            relationalModel.Tables.Add(("ManyOwned", Nothing), manyOwnedTable)
            Dim manyOwnedTableMapping As New TableMapping(ownedType0, manyOwnedTable, True)
            manyOwnedTable.AddEntityTypeMapping(manyOwnedTableMapping, False)
            tableMappings4.Add(manyOwnedTableMapping)
            RelationalModel.CreateColumnMapping(manyOwnedTable.FindColumn("Id"), ownedType0.FindProperty("Id"), manyOwnedTableMapping)
            RelationalModel.CreateColumnMapping(manyOwnedTable.FindColumn("PrincipalDerived<DependentBase<byte?>>AlternateId"), ownedType0.FindProperty("PrincipalDerivedAlternateId"), manyOwnedTableMapping)
            RelationalModel.CreateColumnMapping(manyOwnedTable.FindColumn("PrincipalDerived<DependentBase<byte?>>Id"), ownedType0.FindProperty("PrincipalDerivedId"), manyOwnedTableMapping)
            RelationalModel.CreateColumnMapping(manyOwnedTable.FindColumn("Details"), ownedType0.FindProperty("Details"), manyOwnedTableMapping)
            RelationalModel.CreateColumnMapping(manyOwnedTable.FindColumn("Number"), ownedType0.FindProperty("Number"), manyOwnedTableMapping)

            Dim principalBasePrincipalDerivedDependentBasebyte = FindEntityType("PrincipalBasePrincipalDerived<DependentBase<byte?>>")

            Dim defaultTableMappings6 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalBasePrincipalDerivedDependentBasebyte.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings6)
            Dim principalBasePrincipalDerivedDependentBasebyteTableBase As New TableBase("PrincipalBasePrincipalDerived<DependentBase<byte?>>", Nothing, relationalModel)
            Dim derivedsAlternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("DerivedsAlternateId", "uniqueidentifier", principalBasePrincipalDerivedDependentBasebyteTableBase)
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("DerivedsAlternateId", derivedsAlternateIdColumnBase)
            Dim derivedsIdColumnBase As New ColumnBase(Of ColumnMappingBase)("DerivedsId", "bigint", principalBasePrincipalDerivedDependentBasebyteTableBase)
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("DerivedsId", derivedsIdColumnBase)
            Dim principalsAlternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalsAlternateId", "uniqueidentifier", principalBasePrincipalDerivedDependentBasebyteTableBase)
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("PrincipalsAlternateId", principalsAlternateIdColumnBase)
            Dim principalsIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalsId", "bigint", principalBasePrincipalDerivedDependentBasebyteTableBase)
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("PrincipalsId", principalsIdColumnBase)
            Dim rowidColumnBase As New ColumnBase(Of ColumnMappingBase)("rowid", "rowversion", principalBasePrincipalDerivedDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("rowid", rowidColumnBase)
            relationalModel.DefaultTables.Add("PrincipalBasePrincipalDerived<DependentBase<byte?>>", principalBasePrincipalDerivedDependentBasebyteTableBase)
            Dim principalBasePrincipalDerivedDependentBasebyteMappingBase As New TableMappingBase(Of ColumnMappingBase)(principalBasePrincipalDerivedDependentBasebyte, principalBasePrincipalDerivedDependentBasebyteTableBase, True)
            principalBasePrincipalDerivedDependentBasebyteTableBase.AddEntityTypeMapping(principalBasePrincipalDerivedDependentBasebyteMappingBase, False)
            defaultTableMappings6.Add(principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("DerivedsAlternateId"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("DerivedsAlternateId"), principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("DerivedsId"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("DerivedsId"), principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("PrincipalsAlternateId"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("PrincipalsAlternateId"), principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("PrincipalsId"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("PrincipalsId"), principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("rowid"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("rowid"), principalBasePrincipalDerivedDependentBasebyteMappingBase)

            Dim tableMappings5 As New List(Of TableMapping)()
            principalBasePrincipalDerivedDependentBasebyte.SetRuntimeAnnotation("Relational:TableMappings", tableMappings5)
            Dim principalBasePrincipalDerivedDependentBasebyteTable As New Table("PrincipalBasePrincipalDerived<DependentBase<byte?>>", Nothing, relationalModel)
            Dim derivedsIdColumn As New Column("DerivedsId", "bigint", principalBasePrincipalDerivedDependentBasebyteTable)
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("DerivedsId", derivedsIdColumn)
            Dim derivedsAlternateIdColumn As New Column("DerivedsAlternateId", "uniqueidentifier", principalBasePrincipalDerivedDependentBasebyteTable)
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("DerivedsAlternateId", derivedsAlternateIdColumn)
            Dim principalsIdColumn As New Column("PrincipalsId", "bigint", principalBasePrincipalDerivedDependentBasebyteTable)
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("PrincipalsId", principalsIdColumn)
            Dim principalsAlternateIdColumn As New Column("PrincipalsAlternateId", "uniqueidentifier", principalBasePrincipalDerivedDependentBasebyteTable)
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("PrincipalsAlternateId", principalsAlternateIdColumn)
            Dim rowidColumn As New Column("rowid", "rowversion", principalBasePrincipalDerivedDependentBasebyteTable) With {
                .IsNullable = True
            }
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("rowid", rowidColumn)
            Dim pK_PrincipalBasePrincipalDerivedDependentBasebyte As New UniqueConstraint("PK_PrincipalBasePrincipalDerived<DependentBase<byte?>>", principalBasePrincipalDerivedDependentBasebyteTable, {derivedsIdColumn, derivedsAlternateIdColumn, principalsIdColumn, principalsAlternateIdColumn})
            principalBasePrincipalDerivedDependentBasebyteTable.PrimaryKey = pK_PrincipalBasePrincipalDerivedDependentBasebyte
            Dim pK_PrincipalBasePrincipalDerivedDependentBasebyteUc = RelationalModel.GetKey(Me,
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                {"DerivedsId", "DerivedsAlternateId", "PrincipalsId", "PrincipalsAlternateId"})
            pK_PrincipalBasePrincipalDerivedDependentBasebyte.MappedKeys.Add(pK_PrincipalBasePrincipalDerivedDependentBasebyteUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_PrincipalBasePrincipalDerivedDependentBasebyteUc).Add(pK_PrincipalBasePrincipalDerivedDependentBasebyte)
            principalBasePrincipalDerivedDependentBasebyteTable.UniqueConstraints.Add("PK_PrincipalBasePrincipalDerived<DependentBase<byte?>>", pK_PrincipalBasePrincipalDerivedDependentBasebyte)
            Dim iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateId As New TableIndex(
            "IX_PrincipalBasePrincipalDerived<DependentBase<byte?>>_PrincipalsId_PrincipalsAlternateId", principalBasePrincipalDerivedDependentBasebyteTable, {principalsIdColumn, principalsAlternateIdColumn}, False)
            Dim iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateIdIx = RelationalModel.GetIndex(Me,
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                {"PrincipalsId", "PrincipalsAlternateId"})
            iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateId.MappedIndexes.Add(iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateIdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateIdIx).Add(iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateId)
            principalBasePrincipalDerivedDependentBasebyteTable.Indexes.Add("IX_PrincipalBasePrincipalDerived<DependentBase<byte?>>_PrincipalsId_PrincipalsAlternateId", iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateId)
            relationalModel.Tables.Add(("PrincipalBasePrincipalDerived<DependentBase<byte?>>", Nothing), principalBasePrincipalDerivedDependentBasebyteTable)
            Dim principalBasePrincipalDerivedDependentBasebyteTableMapping As New TableMapping(principalBasePrincipalDerivedDependentBasebyte, principalBasePrincipalDerivedDependentBasebyteTable, True)
            principalBasePrincipalDerivedDependentBasebyteTable.AddEntityTypeMapping(principalBasePrincipalDerivedDependentBasebyteTableMapping, False)
            tableMappings5.Add(principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("DerivedsAlternateId"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("DerivedsAlternateId"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("DerivedsId"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("DerivedsId"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("PrincipalsAlternateId"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("PrincipalsAlternateId"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("PrincipalsId"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("PrincipalsId"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("rowid"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("rowid"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            Dim fK_DependentBasebyte_PrincipalBase_PrincipalId As New ForeignKeyConstraint(
                "FK_DependentBase<byte?>_PrincipalBase_PrincipalId", dependentBasebyteTable, principalBaseTable,
                {principalIdColumn},
                principalBaseTable.FindUniqueConstraint("AK_PrincipalBase_Id"), ReferentialAction.Cascade)
            Dim fK_DependentBasebyte_PrincipalBase_PrincipalIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id"})
            fK_DependentBasebyte_PrincipalBase_PrincipalId.MappedForeignKeys.Add(fK_DependentBasebyte_PrincipalBase_PrincipalIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_DependentBasebyte_PrincipalBase_PrincipalIdFk).Add(fK_DependentBasebyte_PrincipalBase_PrincipalId)
            dependentBasebyteTable.ForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalBase_PrincipalId)
            principalBaseTable.ReferencingForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalBase_PrincipalId)
            Dim fK_DependentBasebyte_PrincipalDerived_PrincipalId_PrincipalAlternateId As New ForeignKeyConstraint(
                "FK_DependentBase<byte?>_PrincipalDerived_PrincipalId_PrincipalAlternateId", dependentBasebyteTable, principalDerivedTable,
                {principalIdColumn, principalAlternateIdColumn},
                principalDerivedTable.FindUniqueConstraint("PK"), ReferentialAction.NoAction)
            Dim fK_DependentBasebyte_PrincipalDerived_PrincipalId_PrincipalAlternateIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId", "PrincipalAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id", "AlternateId"})
            fK_DependentBasebyte_PrincipalDerived_PrincipalId_PrincipalAlternateId.MappedForeignKeys.Add(fK_DependentBasebyte_PrincipalDerived_PrincipalId_PrincipalAlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_DependentBasebyte_PrincipalDerived_PrincipalId_PrincipalAlternateIdFk).Add(fK_DependentBasebyte_PrincipalDerived_PrincipalId_PrincipalAlternateId)
            dependentBasebyteTable.ForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalDerived_PrincipalId_PrincipalAlternateId)
            principalDerivedTable.ReferencingForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalDerived_PrincipalId_PrincipalAlternateId)
            Dim fK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateId As New ForeignKeyConstraint(
                "FK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateId", detailsTable, principalBaseTable,
                {principalBaseIdColumn, principalBaseAlternateIdColumn},
                principalBaseTable.FindUniqueConstraint("PK"), ReferentialAction.Cascade)
            Dim fK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType",
                {"PrincipalBaseId", "PrincipalBaseAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType",
                {"PrincipalBaseId", "PrincipalBaseAlternateId"})
            fK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateId.MappedForeignKeys.Add(fK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateIdFk).Add(fK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateId)
            detailsTable.ForeignKeyConstraints.Add(fK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateId)
            principalBaseTable.ReferencingForeignKeyConstraints.Add(fK_Details_PrincipalBase_PrincipalBaseId_PrincipalBaseAlternateId)
            Dim fK_ManyOwned_PrincipalDerived_PrincipalDerivedDependentBasebyteId_PrincipalDerivedDependentBasebyteAlternateId As New ForeignKeyConstraint(
                "FK_ManyOwned_PrincipalDerived_PrincipalDerived<DependentBase<byte?>>Id_PrincipalDerived<DependentBase<byte?>>AlternateId", manyOwnedTable, principalDerivedTable,
                {principalDerivedDependentBasebyteIdColumn, principalDerivedDependentBasebyteAlternateIdColumn},
                principalDerivedTable.FindUniqueConstraint("PK"), ReferentialAction.Cascade)
            Dim fK_ManyOwned_PrincipalDerived_PrincipalDerivedDependentBasebyteId_PrincipalDerivedDependentBasebyteAlternateIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType",
                {"PrincipalDerivedId", "PrincipalDerivedAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id", "AlternateId"})
            fK_ManyOwned_PrincipalDerived_PrincipalDerivedDependentBasebyteId_PrincipalDerivedDependentBasebyteAlternateId.MappedForeignKeys.Add(fK_ManyOwned_PrincipalDerived_PrincipalDerivedDependentBasebyteId_PrincipalDerivedDependentBasebyteAlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_ManyOwned_PrincipalDerived_PrincipalDerivedDependentBasebyteId_PrincipalDerivedDependentBasebyteAlternateIdFk).Add(fK_ManyOwned_PrincipalDerived_PrincipalDerivedDependentBasebyteId_PrincipalDerivedDependentBasebyteAlternateId)
            manyOwnedTable.ForeignKeyConstraints.Add(fK_ManyOwned_PrincipalDerived_PrincipalDerivedDependentBasebyteId_PrincipalDerivedDependentBasebyteAlternateId)
            principalDerivedTable.ReferencingForeignKeyConstraints.Add(fK_ManyOwned_PrincipalDerived_PrincipalDerivedDependentBasebyteId_PrincipalDerivedDependentBasebyteAlternateId)
            Dim fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId As New ForeignKeyConstraint(
                "FK_PrincipalBasePrincipalDerived<DependentBase<byte?>>_PrincipalBase_PrincipalsId_PrincipalsAlternateId", principalBasePrincipalDerivedDependentBasebyteTable, principalBaseTable,
                {principalsIdColumn, principalsAlternateIdColumn},
                principalBaseTable.FindUniqueConstraint("PK"), ReferentialAction.NoAction)
            Dim fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateIdFk = RelationalModel.GetForeignKey(Me,
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                {"PrincipalsId", "PrincipalsAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id", "AlternateId"})
            fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId.MappedForeignKeys.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateIdFk).Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId)
            principalBasePrincipalDerivedDependentBasebyteTable.ForeignKeyConstraints.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId)
            principalBaseTable.ReferencingForeignKeyConstraints.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId)
            Dim fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalDerived_DerivedsId_DerivedsAlternateId As New ForeignKeyConstraint(
                "FK_PrincipalBasePrincipalDerived<DependentBase<byte?>>_PrincipalDerived_DerivedsId_DerivedsAlternateId", principalBasePrincipalDerivedDependentBasebyteTable, principalDerivedTable,
                {derivedsIdColumn, derivedsAlternateIdColumn},
                principalDerivedTable.FindUniqueConstraint("PK"), ReferentialAction.Cascade)
            Dim fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalDerived_DerivedsId_DerivedsAlternateIdFk = RelationalModel.GetForeignKey(Me,
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                {"DerivedsId", "DerivedsAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id", "AlternateId"})
            fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalDerived_DerivedsId_DerivedsAlternateId.MappedForeignKeys.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalDerived_DerivedsId_DerivedsAlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalDerived_DerivedsId_DerivedsAlternateIdFk).Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalDerived_DerivedsId_DerivedsAlternateId)
            principalBasePrincipalDerivedDependentBasebyteTable.ForeignKeyConstraints.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalDerived_DerivedsId_DerivedsAlternateId)
            principalDerivedTable.ReferencingForeignKeyConstraints.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalDerived_DerivedsId_DerivedsAlternateId)
            Dim fK_PrincipalDerived_PrincipalBase_DerivedId_AlternateId As New ForeignKeyConstraint(
                "FK_PrincipalDerived_PrincipalBase_DerivedId_AlternateId", principalDerivedTable, principalBaseTable,
                {derivedIdColumn, alternateIdColumn0},
                principalBaseTable.FindUniqueConstraint("PK"), ReferentialAction.Cascade)
            Dim fK_PrincipalDerived_PrincipalBase_DerivedId_AlternateIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id", "AlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id", "AlternateId"})
            fK_PrincipalDerived_PrincipalBase_DerivedId_AlternateId.MappedForeignKeys.Add(fK_PrincipalDerived_PrincipalBase_DerivedId_AlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_PrincipalDerived_PrincipalBase_DerivedId_AlternateIdFk).Add(fK_PrincipalDerived_PrincipalBase_DerivedId_AlternateId)
            principalDerivedTable.ForeignKeyConstraints.Add(fK_PrincipalDerived_PrincipalBase_DerivedId_AlternateId)
            principalBaseTable.ReferencingForeignKeyConstraints.Add(fK_PrincipalDerived_PrincipalBase_DerivedId_AlternateId)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value
            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Migrations.Design
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.ValueGeneration

Namespace TestNamespace
    Friend Partial Class DependentBaseEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)),
                baseEntityType,
                discriminatorProperty:="EnumDiscriminator",
                discriminatorValue:=VisualBasicMigrationsGeneratorTests.Enum1.One)

            Dim principalId = entityType.AddProperty(
                "PrincipalId",
                GetType(Long),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalAlternateId = entityType.AddProperty(
                "PrincipalAlternateId",
                GetType(Guid),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim enumDiscriminator = entityType.AddProperty(
                "EnumDiscriminator",
                GetType(VisualBasicMigrationsGeneratorTests.Enum1),
                afterSaveBehavior:=PropertySaveBehavior.Throw,
                valueGeneratorFactory:=AddressOf New DiscriminatorValueGeneratorFactory().Create)
            enumDiscriminator.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Byte?),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetProperty("Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetField("_Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {principalId, principalAlternateId})
            entityType.SetPrimaryKey(key)

            Dim index = entityType.AddIndex(
                {principalId},
                unique:=True)

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                unique:=True,
                required:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Function CreateForeignKey2(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalId"), declaringEntityType.FindProperty("PrincipalAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.ClientNoAction,
                unique:=True,
                required:=True)

            Dim principal = declaringEntityType.AddNavigation("Principal",
                runtimeForeignKey,
                onDependent:=True,
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetProperty("Principal", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetField("_Principal", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim dependent = principalEntityType.AddNavigation("Dependent",
                runtimeForeignKey,
                onDependent:=False,
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetProperty("Dependent", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetField("_Dependent", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                eagerLoaded:=True,
                lazyLoadingEnabled:=False)

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("DiscriminatorMappingComplete", False)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:MappingStrategy", "TPH")
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "DependentBase<byte?>")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Storage.ValueConversion
Imports NetTopologySuite.Geometries

Namespace TestNamespace
    Friend Partial Class PrincipalBaseEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase),
                baseEntityType,
                discriminatorValue:="PrincipalBase")

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Long?),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetProperty("Id", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("_Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)

            Dim [overrides] As New StoreObjectDictionary(Of RuntimeRelationalPropertyOverrides)()
            Dim idPrincipalDerived As New RuntimeRelationalPropertyOverrides(
                id,
                StoreObjectIdentifier.Table("PrincipalDerived", Nothing),
                True,
                "DerivedId")
            [overrides].GetType().GetMethod("Add").Invoke([overrides], {StoreObjectIdentifier.Table("PrincipalDerived", Nothing), idPrincipalDerived})
            id.AddAnnotation("Relational:RelationalOverrides", [overrides])

            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)

            Dim alternateId = entityType.AddProperty(
                "AlternateId",
                GetType(Guid),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("AlternateId", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                propertyAccessMode:=PropertyAccessMode.FieldDuringConstruction,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            alternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim point = entityType.AddProperty(
                "Point",
                GetType(Point),
                nullable:=True,
                valueGenerated:=ValueGenerated.OnAdd,
                valueConverter:=New CastingConverter(Of Point, Point)(),
                valueComparer:=New VisualBasicRuntimeModelCodeGeneratorTest.CustomValueComparer(Of Point)(),
                providerValueComparer:=New VisualBasicRuntimeModelCodeGeneratorTest.CustomValueComparer(Of Point)())
            point.AddAnnotation("Relational:ColumnType", "geometry")
            point.AddAnnotation("Relational:DefaultValue", CType(New NetTopologySuite.IO.WKTReader().Read("SRID=0;POINT Z(0 0 0)"), NetTopologySuite.Geometries.Point))
            point.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {id})

            Dim key0 = entityType.AddKey(
                {id, alternateId})
            entityType.SetPrimaryKey(key0)
            key0.AddAnnotation("Relational:Name", "PK")

            Dim index = entityType.AddIndex(
                {alternateId, id})

            Return entityType
        End Function

        Public Shared Function CreateSkipNavigation1(declaringEntityType As RuntimeEntityType, targetEntityType As RuntimeEntityType, joinEntityType As RuntimeEntityType) As RuntimeSkipNavigation
            Dim skipNavigation = declaringEntityType.AddSkipNavigation(
                "Deriveds",
                targetEntityType,
                joinEntityType.FindForeignKey(
                    {joinEntityType.FindProperty("PrincipalsId"), joinEntityType.FindProperty("PrincipalsAlternateId")},
                    declaringEntityType.FindKey({declaringEntityType.FindProperty("Id"), declaringEntityType.FindProperty("AlternateId")}),
                    declaringEntityType),
                True,
                False,
                GetType(ICollection(Of VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetProperty("Deriveds", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("_Deriveds", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim inverse = targetEntityType.FindSkipNavigation("Principals")
            If inverse IsNot Nothing Then
                skipNavigation.Inverse = inverse
                inverse.Inverse = skipNavigation
            End If

            Return skipNavigation
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:MappingStrategy", "TPT")
            entityType.AddAnnotation("Relational:Schema", "mySchema")
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBase")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e3 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class OwnedTypeEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType),
                baseEntityType,
                sharedClrType:=True,
                changeTrackingStrategy:=ChangeTrackingStrategy.ChangingAndChangedNotificationsWithOriginalValues)

            Dim principalBaseId = entityType.AddProperty(
                "PrincipalBaseId",
                GetType(Long),
                propertyAccessMode:=PropertyAccessMode.Field,
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)

            Dim [overrides] As New StoreObjectDictionary(Of RuntimeRelationalPropertyOverrides)()
            Dim principalBaseIdPrincipalBase As New RuntimeRelationalPropertyOverrides(
                principalBaseId,
                StoreObjectIdentifier.Table("PrincipalBase", "mySchema"),
                False,
                Nothing)
            principalBaseIdPrincipalBase.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            [overrides].GetType().GetMethod("Add").Invoke([overrides], {StoreObjectIdentifier.Table("PrincipalBase", "mySchema"), principalBaseIdPrincipalBase})
            principalBaseId.AddAnnotation("Relational:RelationalOverrides", [overrides])

            principalBaseId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)

            Dim principalBaseAlternateId = entityType.AddProperty(
                "PrincipalBaseAlternateId",
                GetType(Guid),
                propertyAccessMode:=PropertyAccessMode.Field,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalBaseAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim details = entityType.AddProperty(
                "Details",
                GetType(String),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Details", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetField("_Details", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                propertyAccessMode:=PropertyAccessMode.Field,
                nullable:=True)

            Dim overrides0 As New StoreObjectDictionary(Of RuntimeRelationalPropertyOverrides)()
            Dim detailsDetails As New RuntimeRelationalPropertyOverrides(
                details,
                StoreObjectIdentifier.Table("Details", Nothing),
                False,
                Nothing)
            overrides0.GetType().GetMethod("Add").Invoke(overrides0, {StoreObjectIdentifier.Table("Details", Nothing), detailsDetails})
            details.AddAnnotation("Relational:RelationalOverrides", overrides0)

            details.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim number = entityType.AddProperty(
                "Number",
                GetType(Integer),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Number", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetField("_Number", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                propertyAccessMode:=PropertyAccessMode.Field)
            number.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim context = entityType.AddServiceProperty(
                "Context",
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Context", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                serviceType:=GetType(Microsoft.EntityFrameworkCore.DbContext))

            Dim key = entityType.AddKey(
                {principalBaseId, principalBaseAlternateId})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalBaseId"), declaringEntityType.FindProperty("PrincipalBaseAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                unique:=True,
                required:=True,
                requiredDependent:=True,
                ownership:=True)

            Dim owned = principalEntityType.AddNavigation("Owned",
                runtimeForeignKey,
                onDependent:=False,
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetProperty("Owned", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("_ownedField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                propertyAccessMode:=PropertyAccessMode.Field,
                eagerLoaded:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Function CreateForeignKey2(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalBaseId"), declaringEntityType.FindProperty("PrincipalBaseAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("PrincipalBaseId"), principalEntityType.FindProperty("PrincipalBaseAlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                unique:=True,
                required:=True,
                requiredDependent:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            Dim fragments As New StoreObjectDictionary(Of RuntimeEntityTypeMappingFragment)()
            Dim detailsFragment As New RuntimeEntityTypeMappingFragment(
                entityType,
                StoreObjectIdentifier.Table("Details", Nothing),
                Nothing)
            fragments.GetType().GetMethod("Add").Invoke(fragments, {StoreObjectIdentifier.Table("Details", Nothing), detailsFragment})
            entityType.AddAnnotation("Relational:MappingFragments", fragments)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", "mySchema")
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBase")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value
            Dim e4 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class OwnedType0EntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType),
                baseEntityType,
                sharedClrType:=True)

            Dim principalDerivedId = entityType.AddProperty(
                "PrincipalDerivedId",
                GetType(Long),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalDerivedId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalDerivedAlternateId = entityType.AddProperty(
                "PrincipalDerivedAlternateId",
                GetType(Guid),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalDerivedAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Integer),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)

            Dim details = entityType.AddProperty(
                "Details",
                GetType(String),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Details", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetField("_Details", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            details.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim number = entityType.AddProperty(
                "Number",
                GetType(Integer),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Number", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetField("_Number", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))
            number.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim context = entityType.AddServiceProperty(
                "Context",
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Context", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                serviceType:=GetType(Microsoft.EntityFrameworkCore.DbContext))

            Dim key = entityType.AddKey(
                {principalDerivedId, principalDerivedAlternateId, id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalDerivedId"), declaringEntityType.FindProperty("PrincipalDerivedAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                required:=True,
                ownership:=True)

            Dim manyOwned = principalEntityType.AddNavigation("ManyOwned",
                runtimeForeignKey,
                onDependent:=False,
                GetType(ICollection(Of VisualBasicRuntimeModelCodeGeneratorTest.OwnedType)),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetField("ManyOwned", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                eagerLoaded:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "ManyOwned")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)
            entityType.AddAnnotation("SqlServer:MemoryOptimized", True)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e5 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class PrincipalBasePrincipalDerivedDependentBasebyteEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                GetType(Dictionary(Of String, Object)),
                baseEntityType,
                sharedClrType:=True,
                indexerPropertyInfo:=RuntimeEntityType.FindIndexerProperty(GetType(Dictionary(Of String, Object))),
                propertyBag:=True)

            Dim derivedsId = entityType.AddProperty(
                "DerivedsId",
                GetType(Long),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            derivedsId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim derivedsAlternateId = entityType.AddProperty(
                "DerivedsAlternateId",
                GetType(Guid),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            derivedsAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalsId = entityType.AddProperty(
                "PrincipalsId",
                GetType(Long),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalsId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalsAlternateId = entityType.AddProperty(
                "PrincipalsAlternateId",
                GetType(Guid),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalsAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim rowid = entityType.AddProperty(
                "rowid",
                GetType(Byte()),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                nullable:=True,
                concurrencyToken:=True,
                valueGenerated:=ValueGenerated.OnAddOrUpdate,
                beforeSaveBehavior:=PropertySaveBehavior.Ignore,
                afterSaveBehavior:=PropertySaveBehavior.Ignore)
            rowid.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {derivedsId, derivedsAlternateId, principalsId, principalsAlternateId})
            entityType.SetPrimaryKey(key)

            Dim index = entityType.AddIndex(
                {principalsId, principalsAlternateId})

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("DerivedsId"), declaringEntityType.FindProperty("DerivedsAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                required:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Function CreateForeignKey2(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalsId"), declaringEntityType.FindProperty("PrincipalsAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.ClientCascade,
                required:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBasePrincipalDerived<DependentBase<byte?>>")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e6 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Migrations.Design
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class DependentDerivedEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentDerived<byte?>",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentDerived(Of Byte?)),
                baseEntityType,
                discriminatorProperty:="EnumDiscriminator",
                discriminatorValue:=VisualBasicMigrationsGeneratorTests.Enum1.Two)

            Dim data = entityType.AddProperty(
                "Data",
                GetType(String),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentDerived(Of Byte?)).GetProperty("Data", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentDerived(Of Byte?)).GetField("_Data", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True,
                maxLength:=20,
                unicode:=False)
            data.AddAnnotation("Relational:IsFixedLength", True)
            data.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim money = entityType.AddProperty(
                "Money",
                GetType(Decimal),
                precision:=9,
                scale:=3)
            money.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "DependentBase<byte?>")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e7 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class PrincipalDerivedEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))),
                baseEntityType,
                discriminatorValue:="PrincipalDerived<DependentBase<byte?>>")

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("Id"), declaringEntityType.FindProperty("AlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                unique:=True,
                required:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Function CreateSkipNavigation1(declaringEntityType As RuntimeEntityType, targetEntityType As RuntimeEntityType, joinEntityType As RuntimeEntityType) As RuntimeSkipNavigation
            Dim skipNavigation = declaringEntityType.AddSkipNavigation(
                "Principals",
                targetEntityType,
                joinEntityType.FindForeignKey(
                    {joinEntityType.FindProperty("DerivedsId"), joinEntityType.FindProperty("DerivedsAlternateId")},
                    declaringEntityType.FindKey({declaringEntityType.FindProperty("Id"), declaringEntityType.FindProperty("AlternateId")}),
                    declaringEntityType),
                True,
                False,
                GetType(ICollection(Of VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetProperty("Principals", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetField("_Principals", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                eagerLoaded:=True,
                lazyLoadingEnabled:=False)

            Dim inverse = targetEntityType.FindSkipNavigation("Deriveds")
            If inverse IsNot Nothing Then
                skipNavigation.Inverse = inverse
                inverse.Inverse = skipNavigation
            End If

            Return skipNavigation
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalDerived")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New BigContext(),
                CreateCompiledModelCodeGenerationOptions,
                Sub(code)
                    Assert.
                        Collection(code,
                        Sub(c) AssertFileContents("BigContextModel.vb", rm1, c),
                        Sub(c) AssertFileContents("BigContextModelBuilder.vb", rm2, c),
                        Sub(c) AssertFileContents("DependentBaseEntityType.vb", e1, c),
                        Sub(c) AssertFileContents("PrincipalBaseEntityType.vb", e2, c),
                        Sub(c) AssertFileContents("OwnedTypeEntityType.vb", e3, c),
                        Sub(c) AssertFileContents("OwnedType0EntityType.vb", e4, c),
                        Sub(c) AssertFileContents("PrincipalBasePrincipalDerivedDependentBasebyteEntityType.vb", e5, c),
                        Sub(c) AssertFileContents("DependentDerivedEntityType.vb", e6, c),
                        Sub(c) AssertFileContents("PrincipalDerivedEntityType.vb", e7, c))
                End Sub,
                Sub(Model)
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() Model.GetCollation()).Message)
                    Assert.Equal(
                        {RelationalAnnotationNames.MaxIdentifierLength, SqlServerAnnotationNames.ValueGenerationStrategy},
                        Model.GetAnnotations().Select(Function(a) a.Name))
                    Assert.Equal(SqlServerValueGenerationStrategy.IdentityColumn, Model.GetValueGenerationStrategy())
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() Model.GetPropertyAccessMode()).Message)
                    Assert.Null(Model(SqlServerAnnotationNames.IdentitySeed))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() Model.GetIdentitySeed()).Message)
                    Assert.Null(Model(SqlServerAnnotationNames.IdentityIncrement))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() Model.GetIdentityIncrement()).Message)

                    Assert.Null(Model.FindEntityType(GetType(AbstractBase)))
                    Dim MyPrincipalBase = Model.FindEntityType(GetType(PrincipalBase))
                    Assert.Equal(GetType(PrincipalBase).FullName, MyPrincipalBase.Name)
                    Assert.False(MyPrincipalBase.HasSharedClrType)
                    Assert.False(MyPrincipalBase.IsPropertyBag)
                    Assert.False(MyPrincipalBase.IsOwned())
                    Assert.Null(MyPrincipalBase.BaseType)
                    Assert.IsType(Of ConstructorBinding)(MyPrincipalBase.ConstructorBinding)
                    Assert.Null(MyPrincipalBase.FindIndexerPropertyInfo())
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, MyPrincipalBase.GetChangeTrackingStrategy())
                    Assert.Null(MyPrincipalBase.GetQueryFilter())
                    Assert.Equal("PrincipalBase", MyPrincipalBase.GetTableName())
                    Assert.Equal("mySchema", MyPrincipalBase.GetSchema())
                    Assert.Equal(CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() MyPrincipalBase.GetSeedData()).Message)

                    Dim PrincipalId = MyPrincipalBase.FindProperty(NameOf(PrincipalBase.Id))
                    Assert.Equal(
                        {RelationalAnnotationNames.RelationalOverrides, SqlServerAnnotationNames.ValueGenerationStrategy},
                        PrincipalId.GetAnnotations().Select(Function(a) a.Name))
                    Assert.Equal(GetType(Long?), PrincipalId.ClrType)
                    Assert.Equal(GetType(Long?), PrincipalId.PropertyInfo.PropertyType)
                    Assert.Equal(GetType(Long?), PrincipalId.FieldInfo.FieldType)
                    Assert.False(PrincipalId.IsNullable)
                    Assert.Equal(ValueGenerated.OnAdd, PrincipalId.ValueGenerated)
                    Assert.Equal(PropertySaveBehavior.Throw, PrincipalId.GetAfterSaveBehavior())
                    Assert.Equal(PropertySaveBehavior.Save, PrincipalId.GetBeforeSaveBehavior())
                    Assert.Null(PrincipalId(CoreAnnotationNames.BeforeSaveBehavior))
                    Assert.Null(PrincipalId(CoreAnnotationNames.AfterSaveBehavior))
                    Assert.Equal("Id", PrincipalId.GetColumnName())
                    Assert.Equal("Id", PrincipalId.GetColumnName(StoreObjectIdentifier.Table("PrincipalBase", "mySchema")))
                    Assert.Equal("DerivedId", PrincipalId.GetColumnName(StoreObjectIdentifier.Table("PrincipalDerived")))
                    Assert.Equal("bigint", PrincipalId.GetColumnType())
                    Assert.Null(PrincipalId.GetValueConverter())
                    Assert.NotNull(PrincipalId.GetValueComparer())
                    Assert.NotNull(PrincipalId.GetKeyValueComparer())
                    Assert.Equal(SqlServerValueGenerationStrategy.IdentityColumn, PrincipalId.GetValueGenerationStrategy())
                    Assert.Null(PrincipalId(SqlServerAnnotationNames.IdentitySeed))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() PrincipalId.GetIdentitySeed()).Message)
                    Assert.Null(PrincipalId(SqlServerAnnotationNames.IdentityIncrement))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() PrincipalId.GetIdentityIncrement()).Message)

                    Dim pointProperty = MyPrincipalBase.FindProperty("Point")
                    Assert.Equal(GetType(Point), pointProperty.ClrType)
                    Assert.True(pointProperty.IsNullable)
                    Assert.Equal(ValueGenerated.OnAdd, pointProperty.ValueGenerated)
                    Assert.Equal("Point", pointProperty.GetColumnName())
                    Assert.Equal("geometry", pointProperty.GetColumnType())
                    Assert.Equal(0, DirectCast(pointProperty.GetDefaultValue(), Point).SRID)
                    Assert.IsType(Of CastingConverter(Of Point, Point))(pointProperty.GetValueConverter())
                    Assert.IsType(Of CustomValueComparer(Of Point))(pointProperty.GetValueComparer())
                    Assert.IsType(Of CustomValueComparer(Of Point))(pointProperty.GetKeyValueComparer())
                    Assert.IsType(Of CustomValueComparer(Of Point))(pointProperty.GetProviderValueComparer())
                    Assert.Equal(SqlServerValueGenerationStrategy.None, pointProperty.GetValueGenerationStrategy())
                    Assert.Null(pointProperty(CoreAnnotationNames.PropertyAccessMode))

                    Assert.Null(MyPrincipalBase.FindDiscriminatorProperty())

                    Dim principalAlternateId = MyPrincipalBase.FindProperty(NameOf(PrincipalBase.AlternateId))
                    Dim compositeIndex = MyPrincipalBase.GetIndexes().Single()
                    Assert.Equal(PropertyAccessMode.FieldDuringConstruction, principalAlternateId.GetPropertyAccessMode())
                    Assert.Empty(compositeIndex.GetAnnotations())
                    Assert.Equal({principalAlternateId, PrincipalId}, compositeIndex.Properties)
                    Assert.False(compositeIndex.IsUnique)
                    Assert.Null(compositeIndex.Name)
                    Assert.Equal("IX_PrincipalBase_AlternateId_Id", compositeIndex.GetDatabaseName())

                    Assert.Equal({compositeIndex}, principalAlternateId.GetContainingIndexes())

                    Assert.Equal(2, MyPrincipalBase.GetKeys().Count())

                    Dim principalAlternateKey = MyPrincipalBase.GetKeys().First()
                    Assert.Same(PrincipalId, principalAlternateKey.Properties.Single())
                    Assert.False(principalAlternateKey.IsPrimaryKey())
                    Assert.Equal("AK_PrincipalBase_Id", principalAlternateKey.GetName())

                    Dim principalKey = MyPrincipalBase.GetKeys().Last()
                    Assert.Equal(
                        {RelationalAnnotationNames.Name},
                        principalKey.GetAnnotations().Select(Function(a) a.Name))
                    Assert.Equal({PrincipalId, principalAlternateId}, principalKey.Properties)
                    Assert.True(principalKey.IsPrimaryKey())
                    Assert.Equal("PK", principalKey.GetName())
                    Assert.Null(principalKey(SqlServerAnnotationNames.Clustered))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() principalKey.IsClustered()).Message)

                    Assert.Equal({principalAlternateKey, principalKey}, PrincipalId.GetContainingKeys())

                    Dim referenceOwnedNavigation = MyPrincipalBase.GetNavigations().Single()
                    Assert.Equal(
                        {CoreAnnotationNames.EagerLoaded},
                        referenceOwnedNavigation.GetAnnotations().Select(Function(a) a.Name))
                    Assert.Equal(NameOf(PrincipalBase.Owned), referenceOwnedNavigation.Name)
                    Assert.False(referenceOwnedNavigation.IsCollection)
                    Assert.True(referenceOwnedNavigation.IsEagerLoaded)
                    Assert.False(referenceOwnedNavigation.IsOnDependent)
                    Assert.Equal(GetType(OwnedType), referenceOwnedNavigation.ClrType)
                    Assert.Equal("_ownedField", referenceOwnedNavigation.FieldInfo.Name)
                    Assert.Equal(NameOf(PrincipalBase.Owned), referenceOwnedNavigation.PropertyInfo.Name)
                    Assert.Null(referenceOwnedNavigation.Inverse)
                    Assert.Equal(MyPrincipalBase, referenceOwnedNavigation.DeclaringEntityType)
                    Assert.Equal(PropertyAccessMode.Field, referenceOwnedNavigation.GetPropertyAccessMode())
                    Assert.Null(referenceOwnedNavigation(CoreAnnotationNames.PropertyAccessMode))

                    Dim referenceOwnedType = referenceOwnedNavigation.TargetEntityType
                    Assert.Equal(GetType(PrincipalBase).FullName & ".Owned#OwnedType", referenceOwnedType.Name)
                    Assert.Equal(GetType(OwnedType), referenceOwnedType.ClrType)
                    Assert.True(referenceOwnedType.HasSharedClrType)
                    Assert.False(referenceOwnedType.IsPropertyBag)
                    Assert.True(referenceOwnedType.IsOwned())
                    Assert.Null(referenceOwnedType.BaseType)
                    Assert.False(referenceOwnedType.IsMemoryOptimized())
                    Assert.IsType(Of ConstructorBinding)(referenceOwnedType.ConstructorBinding)
                    Assert.Null(referenceOwnedType.FindIndexerPropertyInfo())
                    Assert.Equal(ChangeTrackingStrategy.ChangingAndChangedNotificationsWithOriginalValues, referenceOwnedType.GetChangeTrackingStrategy())
                    Assert.Null(referenceOwnedType.GetQueryFilter())
                    Assert.Null(referenceOwnedType(CoreAnnotationNames.PropertyAccessMode))
                    Assert.Null(referenceOwnedType(CoreAnnotationNames.NavigationAccessMode))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() referenceOwnedType.GetPropertyAccessMode()).Message)
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() referenceOwnedType.GetNavigationAccessMode()).Message)

                    Dim principalTable = StoreObjectIdentifier.Create(referenceOwnedType, StoreObjectType.Table).Value

                    Dim ownedId = referenceOwnedType.FindProperty("PrincipalBaseId")
                    Assert.True(ownedId.IsPrimaryKey())
                    Assert.Equal(
                        SqlServerValueGenerationStrategy.IdentityColumn,
                        PrincipalId.GetValueGenerationStrategy(principalTable))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() PrincipalId.GetIdentityIncrement(principalTable)).Message)
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() PrincipalId.GetIdentitySeed(principalTable)).Message)

                    Dim detailsProperty = referenceOwnedType.FindProperty(NameOf(OwnedType.Details))
                    Assert.Null(detailsProperty(SqlServerAnnotationNames.Sparse))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() detailsProperty.IsSparse()).Message)
                    Assert.Null(detailsProperty(RelationalAnnotationNames.Collation))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() detailsProperty.GetCollation()).Message)

                    Dim ownedFragment = referenceOwnedType.GetMappingFragments().Single()
                    Assert.Equal(NameOf(OwnedType.Details), detailsProperty.GetColumnName(ownedFragment.StoreObject))
                    Assert.Null(detailsProperty.GetColumnName(principalTable))

                    Dim referenceOwnership = referenceOwnedNavigation.ForeignKey
                    Assert.Empty(referenceOwnership.GetAnnotations())
                    Assert.Same(referenceOwnership, referenceOwnedType.FindOwnership())
                    Assert.True(referenceOwnership.IsOwnership)
                    Assert.True(referenceOwnership.IsRequired)
                    Assert.True(referenceOwnership.IsRequiredDependent)
                    Assert.True(referenceOwnership.IsUnique)
                    Assert.Null(referenceOwnership.DependentToPrincipal)
                    Assert.Same(referenceOwnedNavigation, referenceOwnership.PrincipalToDependent)
                    Assert.Equal(DeleteBehavior.Cascade, referenceOwnership.DeleteBehavior)
                    Assert.Equal(2, referenceOwnership.Properties.Count())
                    Assert.Same(principalKey, referenceOwnership.PrincipalKey)

                    Dim ownedServiceProperty = referenceOwnedType.GetServiceProperties().Single()
                    Assert.Empty(ownedServiceProperty.GetAnnotations())
                    Assert.Equal(GetType(DbContext), ownedServiceProperty.ClrType)
                    Assert.Equal(GetType(DbContext), ownedServiceProperty.PropertyInfo.PropertyType)
                    Assert.Null(ownedServiceProperty.FieldInfo)
                    Assert.Same(referenceOwnedType, ownedServiceProperty.DeclaringEntityType)
                    Dim ownedServicePropertyBinding = ownedServiceProperty.ParameterBinding
                    Assert.IsType(Of ContextParameterBinding)(ownedServicePropertyBinding)
                    Assert.Equal(GetType(DbContext), ownedServicePropertyBinding.ServiceType)
                    Assert.Equal(ownedServiceProperty, ownedServicePropertyBinding.ConsumedProperties.Single())
                    Assert.Equal(PropertyAccessMode.PreferField, ownedServiceProperty.GetPropertyAccessMode())
                    Assert.Null(ownedServiceProperty(CoreAnnotationNames.PropertyAccessMode))

                    Dim principalDerived = Model.FindEntityType(GetType(PrincipalDerived(Of DependentBase(Of Byte?))))
                    Assert.Equal(MyPrincipalBase, principalDerived.BaseType)
                    Assert.Equal("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+" &
                        "PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                        principalDerived.Name)
                    Assert.False(principalDerived.IsOwned())
                    Assert.IsType(Of ConstructorBinding)(principalDerived.ConstructorBinding)
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, principalDerived.GetChangeTrackingStrategy())
                    Assert.Equal("PrincipalDerived<DependentBase<byte?>>", principalDerived.GetDiscriminatorValue())

                    Dim tptForeignKey = principalDerived.GetForeignKeys().Single()
                    Assert.False(tptForeignKey.IsOwnership)
                    Assert.True(tptForeignKey.IsRequired)
                    Assert.False(tptForeignKey.IsRequiredDependent)
                    Assert.True(tptForeignKey.IsUnique)
                    Assert.Null(tptForeignKey.DependentToPrincipal)
                    Assert.Null(tptForeignKey.PrincipalToDependent)
                    Assert.Equal(DeleteBehavior.Cascade, tptForeignKey.DeleteBehavior)
                    Assert.Equal(principalKey.Properties, tptForeignKey.Properties)
                    Assert.Same(principalKey, tptForeignKey.PrincipalKey)

                    Assert.Equal(2, principalDerived.GetDeclaredNavigations().Count())
                    Dim dependentNavigation = principalDerived.GetDeclaredNavigations().First()
                    Assert.Equal("Dependent", dependentNavigation.Name)
                    Assert.Equal("Dependent", dependentNavigation.PropertyInfo.Name)
                    Assert.Equal("_Dependent", dependentNavigation.FieldInfo.Name)
                    Assert.False(dependentNavigation.IsCollection)
                    Assert.True(dependentNavigation.IsEagerLoaded)
                    Assert.False(dependentNavigation.LazyLoadingEnabled)
                    Assert.False(dependentNavigation.IsOnDependent)
                    Assert.Equal(principalDerived, dependentNavigation.DeclaringEntityType)
                    Assert.Equal("Principal", dependentNavigation.Inverse.Name)

                    Dim ownedCollectionNavigation = principalDerived.GetDeclaredNavigations().Last()
                    Assert.Equal("ManyOwned", ownedCollectionNavigation.Name)
                    Assert.Null(ownedCollectionNavigation.PropertyInfo)
                    Assert.Equal("ManyOwned", ownedCollectionNavigation.FieldInfo.Name)
                    Assert.Equal(GetType(ICollection(Of OwnedType)), ownedCollectionNavigation.ClrType)
                    Assert.True(ownedCollectionNavigation.IsCollection)
                    Assert.True(ownedCollectionNavigation.IsEagerLoaded)
                    Assert.False(ownedCollectionNavigation.IsOnDependent)
                    Assert.Null(ownedCollectionNavigation.Inverse)
                    Assert.Equal(principalDerived, ownedCollectionNavigation.DeclaringEntityType)

                    Dim collectionOwnedType = ownedCollectionNavigation.TargetEntityType
                    Assert.Equal(principalDerived.Name & ".ManyOwned#OwnedType", collectionOwnedType.Name)
                    Assert.Equal(GetType(OwnedType), collectionOwnedType.ClrType)
                    Assert.True(collectionOwnedType.HasSharedClrType)
                    Assert.False(collectionOwnedType.IsPropertyBag)
                    Assert.True(collectionOwnedType.IsOwned())
                    Assert.True(collectionOwnedType.IsMemoryOptimized())
                    Assert.Null(collectionOwnedType(RelationalAnnotationNames.IsTableExcludedFromMigrations))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() collectionOwnedType.IsTableExcludedFromMigrations()).Message)
                    Assert.Null(collectionOwnedType.BaseType)
                    Assert.IsType(Of ConstructorBinding)(collectionOwnedType.ConstructorBinding)
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, collectionOwnedType.GetChangeTrackingStrategy())

                    Dim collectionOwnership = ownedCollectionNavigation.ForeignKey
                    Assert.Same(collectionOwnership, collectionOwnedType.FindOwnership())
                    Assert.True(collectionOwnership.IsOwnership)
                    Assert.True(collectionOwnership.IsRequired)
                    Assert.False(collectionOwnership.IsRequiredDependent)
                    Assert.False(collectionOwnership.IsUnique)
                    Assert.Null(collectionOwnership.DependentToPrincipal)
                    Assert.Same(ownedCollectionNavigation, collectionOwnership.PrincipalToDependent)
                    Assert.Equal(DeleteBehavior.Cascade, collectionOwnership.DeleteBehavior)
                    Assert.Equal(2, collectionOwnership.Properties.Count())

                    Dim derivedSkipNavigation = principalDerived.GetDeclaredSkipNavigations().Single()
                    Assert.Equal("Principals", derivedSkipNavigation.Name)
                    Assert.Equal("Principals", derivedSkipNavigation.PropertyInfo.Name)
                    Assert.Equal("_Principals", derivedSkipNavigation.FieldInfo.Name)
                    Assert.Equal(GetType(ICollection(Of PrincipalBase)), derivedSkipNavigation.ClrType)
                    Assert.True(derivedSkipNavigation.IsCollection)
                    Assert.True(derivedSkipNavigation.IsEagerLoaded)
                    Assert.False(derivedSkipNavigation.LazyLoadingEnabled)
                    Assert.False(derivedSkipNavigation.IsOnDependent)
                    Assert.Equal(principalDerived, derivedSkipNavigation.DeclaringEntityType)
                    Assert.Equal("Deriveds", derivedSkipNavigation.Inverse.Name)
                    Assert.Same(MyPrincipalBase.GetSkipNavigations().Single(), derivedSkipNavigation.Inverse)

                    Assert.Same(derivedSkipNavigation, derivedSkipNavigation.ForeignKey.GetReferencingSkipNavigations().Single())
                    Assert.Same(derivedSkipNavigation.Inverse, derivedSkipNavigation.Inverse.ForeignKey.GetReferencingSkipNavigations().Single())

                    Assert.Equal({derivedSkipNavigation.Inverse, derivedSkipNavigation}, principalDerived.GetSkipNavigations())

                    Dim joinType = derivedSkipNavigation.JoinEntityType

                    Assert.Equal("PrincipalBasePrincipalDerived<DependentBase<byte?>>", joinType.Name)
                    Assert.Equal(GetType(Dictionary(Of String, Object)), joinType.ClrType)
                    Assert.True(joinType.HasSharedClrType)
                    Assert.True(joinType.IsPropertyBag)
                    Assert.False(joinType.IsOwned())
                    Assert.Null(joinType.BaseType)
                    Assert.IsType(Of ConstructorBinding)(joinType.ConstructorBinding)
                    Assert.Equal("Item", joinType.FindIndexerPropertyInfo().Name)
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, joinType.GetChangeTrackingStrategy())
                    Assert.Null(joinType(RelationalAnnotationNames.Comment))
                    Assert.Equal(CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() joinType.GetComment()).Message)
                    Assert.Null(joinType.GetQueryFilter())

                    Dim rowid = joinType.GetProperties().Single(Function(p) Not p.IsForeignKey())
                    Assert.Equal(GetType(Byte()), rowid.ClrType)
                    Assert.True(rowid.IsIndexerProperty())
                    Assert.Same(joinType.FindIndexerPropertyInfo(), rowid.PropertyInfo)
                    Assert.Null(rowid.FieldInfo)
                    Assert.True(rowid.IsNullable)
                    Assert.False(rowid.IsShadowProperty())
                    Assert.True(rowid.IsConcurrencyToken)
                    Assert.Equal(ValueGenerated.OnAddOrUpdate, rowid.ValueGenerated)
                    Assert.Equal("rowid", rowid.GetColumnName())
                    Assert.Equal("rowversion", rowid.GetColumnType())
                    Assert.Null(rowid(RelationalAnnotationNames.Comment))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() rowid.GetComment()).Message)
                    Assert.Null(rowid(RelationalAnnotationNames.ColumnOrder))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() rowid.GetColumnOrder()).Message)
                    Assert.Null(rowid.GetValueConverter())
                    Assert.NotNull(rowid.GetValueComparer())
                    Assert.NotNull(rowid.GetKeyValueComparer())
                    Assert.Equal(SqlServerValueGenerationStrategy.None, rowid.GetValueGenerationStrategy())

                    Dim dependentForeignKey = dependentNavigation.ForeignKey
                    Assert.False(dependentForeignKey.IsOwnership)
                    Assert.True(dependentForeignKey.IsRequired)
                    Assert.False(dependentForeignKey.IsRequiredDependent)
                    Assert.True(dependentForeignKey.IsUnique)
                    Assert.Same(dependentNavigation.Inverse, dependentForeignKey.DependentToPrincipal)
                    Assert.Same(dependentNavigation, dependentForeignKey.PrincipalToDependent)
                    Assert.Equal(DeleteBehavior.ClientNoAction, dependentForeignKey.DeleteBehavior)
                    Assert.Equal({"PrincipalId", "PrincipalAlternateId"}, dependentForeignKey.Properties.Select(Function(p) p.Name))
                    Assert.Same(principalKey, dependentForeignKey.PrincipalKey)

                    Dim dependentBase = dependentNavigation.TargetEntityType

                    Assert.False(dependentBase.GetIsDiscriminatorMappingComplete())
                    Dim principalDiscriminator = dependentBase.FindDiscriminatorProperty()
                    Assert.IsType(Of DiscriminatorValueGenerator)(
                        principalDiscriminator.GetValueGeneratorFactory()(principalDiscriminator, dependentBase))
                    Assert.Equal(Enum1.One, dependentBase.GetDiscriminatorValue())

                    Dim dependentBaseForeignKey = dependentBase.GetForeignKeys().Single(Function(fk) fk IsNot dependentForeignKey)
                    Dim dependentForeignKeyProperty = dependentBaseForeignKey.Properties.Single()

                    Assert.Equal({dependentBaseForeignKey, dependentForeignKey}, dependentForeignKeyProperty.GetContainingForeignKeys())

                    Dim dependentDerived = dependentBase.GetDerivedTypes().Single()
                    Assert.Equal(Enum1.Two, dependentDerived.GetDiscriminatorValue())

                    Assert.Equal(2, dependentDerived.GetDeclaredProperties().Count())

                    Dim dependentData = dependentDerived.GetDeclaredProperties().First()
                    Assert.Equal(GetType(String), dependentData.ClrType)
                    Assert.Equal("Data", dependentData.Name)
                    Assert.Equal("Data", dependentData.PropertyInfo.Name)
                    Assert.Equal("_Data", dependentData.FieldInfo.Name)
                    Assert.True(dependentData.IsNullable)
                    Assert.False(dependentData.IsShadowProperty())
                    Assert.False(dependentData.IsConcurrencyToken)
                    Assert.Equal(ValueGenerated.Never, dependentData.ValueGenerated)
                    Assert.Equal("Data", dependentData.GetColumnName())
                    Assert.Equal("char(20)", dependentData.GetColumnType())
                    Assert.Equal(20, dependentData.GetMaxLength())
                    Assert.False(dependentData.IsUnicode())
                    Assert.True(dependentData.IsFixedLength())
                    Assert.Null(dependentData.GetPrecision())
                    Assert.Null(dependentData.GetScale())

                    Dim dependentMoney = dependentDerived.GetDeclaredProperties().Last()
                    Assert.Equal(GetType(Decimal), dependentMoney.ClrType)
                    Assert.Equal("Money", dependentMoney.Name)
                    Assert.Null(dependentMoney.PropertyInfo)
                    Assert.Null(dependentMoney.FieldInfo)
                    Assert.False(dependentMoney.IsNullable)
                    Assert.True(dependentMoney.IsShadowProperty())
                    Assert.False(dependentMoney.IsConcurrencyToken)
                    Assert.Equal(ValueGenerated.Never, dependentMoney.ValueGenerated)
                    Assert.Equal("Money", dependentMoney.GetColumnName())
                    Assert.Equal("decimal(9,3)", dependentMoney.GetColumnType())
                    Assert.Null(dependentMoney.GetMaxLength())
                    Assert.Null(dependentMoney.IsUnicode())
                    Assert.Null(dependentMoney.IsFixedLength())
                    Assert.Equal(9, dependentMoney.GetPrecision())
                    Assert.Equal(3, dependentMoney.GetScale())

                    Assert.Equal(
                        {
                            derivedSkipNavigation.ForeignKey,
                            tptForeignKey,
                            referenceOwnership,
                            collectionOwnership,
                            dependentForeignKey,
                            derivedSkipNavigation.Inverse.ForeignKey
                        },
                        principalKey.GetReferencingForeignKeys())

                    Assert.Equal(
                        {
                            dependentBaseForeignKey,
                            tptForeignKey,
                            referenceOwnership,
                            derivedSkipNavigation.Inverse.ForeignKey
                        },
                        MyPrincipalBase.GetReferencingForeignKeys())

                    Assert.Equal(
                        {
                            derivedSkipNavigation.ForeignKey,
                            collectionOwnership,
                            dependentForeignKey
                        },
                        principalDerived.GetDeclaredReferencingForeignKeys())

                    Assert.Equal(
                        {
                            dependentBase,
                            dependentDerived,
                            MyPrincipalBase,
                            referenceOwnedType,
                            principalDerived,
                            collectionOwnedType,
                            joinType
                        },
                        Model.GetEntityTypes())
                End Sub,
                GetType(SqlServerNetTopologySuiteDesignTimeServices))
        End Sub

        <ConditionalFact>
        Public Sub BigModel_with_JSON_columns()

            Dim BigContextWithJsonModel = <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.BigContextWithJson))>
    Public Partial Class BigContextWithJsonModel
        Inherits RuntimeModel

        Private Shared _Instance As BigContextWithJsonModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New BigContextWithJsonModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim BigContextWithJsonModelBuilder = <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Internal
Imports Microsoft.EntityFrameworkCore.Migrations

Namespace TestNamespace
    Public Partial Class BigContextWithJsonModel

        Private Sub Initialize()
            Dim dependentBase = DependentBaseEntityType.Create(Me)
            Dim principalBase = PrincipalBaseEntityType.Create(Me)
            Dim ownedType = OwnedTypeEntityType.Create(Me)
            Dim ownedType0 = OwnedType0EntityType.Create(Me)
            Dim principalBasePrincipalDerivedDependentBasebyte = PrincipalBasePrincipalDerivedDependentBasebyteEntityType.Create(Me)
            Dim dependentDerived = DependentDerivedEntityType.Create(Me, dependentBase)
            Dim principalDerived = PrincipalDerivedEntityType.Create(Me, principalBase)

            DependentBaseEntityType.CreateForeignKey1(dependentBase, principalBase)
            DependentBaseEntityType.CreateForeignKey2(dependentBase, principalDerived)
            OwnedTypeEntityType.CreateForeignKey1(ownedType, principalBase)
            OwnedType0EntityType.CreateForeignKey1(ownedType0, principalDerived)
            PrincipalBasePrincipalDerivedDependentBasebyteEntityType.CreateForeignKey1(principalBasePrincipalDerivedDependentBasebyte, principalDerived)
            PrincipalBasePrincipalDerivedDependentBasebyteEntityType.CreateForeignKey2(principalBasePrincipalDerivedDependentBasebyte, principalBase)

            PrincipalBaseEntityType.CreateSkipNavigation1(principalBase, principalDerived, principalBasePrincipalDerivedDependentBasebyte)
            PrincipalDerivedEntityType.CreateSkipNavigation1(principalDerived, principalBase, principalBasePrincipalDerivedDependentBasebyte)

            DependentBaseEntityType.CreateAnnotations(dependentBase)
            PrincipalBaseEntityType.CreateAnnotations(principalBase)
            OwnedTypeEntityType.CreateAnnotations(ownedType)
            OwnedType0EntityType.CreateAnnotations(ownedType0)
            PrincipalBasePrincipalDerivedDependentBasebyteEntityType.CreateAnnotations(principalBasePrincipalDerivedDependentBasebyte)
            DependentDerivedEntityType.CreateAnnotations(dependentDerived)
            PrincipalDerivedEntityType.CreateAnnotations(principalDerived)

            AddAnnotation("Relational:MaxIdentifierLength", 128)
            AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim dependentBase = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            dependentBase.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>", Nothing, relationalModel)
            Dim dataColumnBase As New ColumnBase(Of ColumnMappingBase)("Data", "char(20)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Data", dataColumnBase)
            Dim enumDiscriminatorColumnBase As New ColumnBase(Of ColumnMappingBase)("EnumDiscriminator", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("EnumDiscriminator", enumDiscriminatorColumnBase)
            Dim idColumnBase As New ColumnBase(Of ColumnMappingBase)("Id", "tinyint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Id", idColumnBase)
            Dim moneyColumnBase As New ColumnBase(Of ColumnMappingBase)("Money", "decimal(9,3)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Money", moneyColumnBase)
            Dim principalAlternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalAlternateId", "uniqueidentifier", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("PrincipalAlternateId", principalAlternateIdColumnBase)
            Dim principalIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalId", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("PrincipalId", principalIdColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase As New TableMappingBase(Of ColumnMappingBase)(dependentBase, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalAlternateId"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("PrincipalAlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalId"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("PrincipalId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("EnumDiscriminator"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("EnumDiscriminator"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)

            Dim tableMappings As New List(Of TableMapping)()
            dependentBase.SetRuntimeAnnotation("Relational:TableMappings", tableMappings)
            Dim dependentBasebyteTable As New Table("DependentBase<byte?>", Nothing, relationalModel)
            Dim principalIdColumn As New Column("PrincipalId", "bigint", dependentBasebyteTable)
            dependentBasebyteTable.Columns.Add("PrincipalId", principalIdColumn)
            Dim principalAlternateIdColumn As New Column("PrincipalAlternateId", "uniqueidentifier", dependentBasebyteTable)
            dependentBasebyteTable.Columns.Add("PrincipalAlternateId", principalAlternateIdColumn)
            Dim dataColumn As New Column("Data", "char(20)", dependentBasebyteTable) With {
                .IsNullable = True
            }
            dependentBasebyteTable.Columns.Add("Data", dataColumn)
            Dim enumDiscriminatorColumn As New Column("EnumDiscriminator", "int", dependentBasebyteTable)
            dependentBasebyteTable.Columns.Add("EnumDiscriminator", enumDiscriminatorColumn)
            Dim idColumn As New Column("Id", "tinyint", dependentBasebyteTable) With {
                .IsNullable = True
            }
            dependentBasebyteTable.Columns.Add("Id", idColumn)
            Dim moneyColumn As New Column("Money", "decimal(9,3)", dependentBasebyteTable) With {
                .IsNullable = True
            }
            dependentBasebyteTable.Columns.Add("Money", moneyColumn)
            Dim pK_DependentBasebyte As New UniqueConstraint("PK_DependentBase<byte?>", dependentBasebyteTable, {principalIdColumn, principalAlternateIdColumn})
            dependentBasebyteTable.PrimaryKey = pK_DependentBasebyte
            Dim pK_DependentBasebyteUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId", "PrincipalAlternateId"})
            pK_DependentBasebyte.MappedKeys.Add(pK_DependentBasebyteUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DependentBasebyteUc).Add(pK_DependentBasebyte)
            dependentBasebyteTable.UniqueConstraints.Add("PK_DependentBase<byte?>", pK_DependentBasebyte)
            Dim iX_DependentBasebyte_PrincipalId As New TableIndex(
            "IX_DependentBase<byte?>_PrincipalId", dependentBasebyteTable, {principalIdColumn}, True)
            Dim iX_DependentBasebyte_PrincipalIdIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId"})
            iX_DependentBasebyte_PrincipalId.MappedIndexes.Add(iX_DependentBasebyte_PrincipalIdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_DependentBasebyte_PrincipalIdIx).Add(iX_DependentBasebyte_PrincipalId)
            dependentBasebyteTable.Indexes.Add("IX_DependentBase<byte?>_PrincipalId", iX_DependentBasebyte_PrincipalId)
            relationalModel.Tables.Add(("DependentBase<byte?>", Nothing), dependentBasebyteTable)
            Dim dependentBasebyteTableMapping As New TableMapping(dependentBase, dependentBasebyteTable, True) With {
                .IsSharedTablePrincipal = True
            }
            dependentBasebyteTable.AddEntityTypeMapping(dependentBasebyteTableMapping, False)
            tableMappings.Add(dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalAlternateId"), dependentBase.FindProperty("PrincipalAlternateId"), dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalId"), dependentBase.FindProperty("PrincipalId"), dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("EnumDiscriminator"), dependentBase.FindProperty("EnumDiscriminator"), dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Id"), dependentBase.FindProperty("Id"), dependentBasebyteTableMapping)

            Dim dependentDerived = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentDerived<byte?>")

            Dim defaultTableMappings0 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            dependentDerived.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings0)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0 As New TableMappingBase(Of ColumnMappingBase)(dependentDerived, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0, False)
            defaultTableMappings0.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalAlternateId"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("PrincipalAlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalId"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("PrincipalId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Data"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("Data"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("EnumDiscriminator"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("EnumDiscriminator"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Money"), ColumnBase(Of ColumnMappingBase)), dependentDerived.FindProperty("Money"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase0)

            Dim tableMappings0 As New List(Of TableMapping)()
            dependentDerived.SetRuntimeAnnotation("Relational:TableMappings", tableMappings0)
            Dim dependentBasebyteTableMapping0 As New TableMapping(dependentDerived, dependentBasebyteTable, True) With {
                .IsSharedTablePrincipal = False
            }
            dependentBasebyteTable.AddEntityTypeMapping(dependentBasebyteTableMapping0, False)
            tableMappings0.Add(dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalAlternateId"), dependentDerived.FindProperty("PrincipalAlternateId"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalId"), dependentDerived.FindProperty("PrincipalId"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Data"), dependentDerived.FindProperty("Data"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("EnumDiscriminator"), dependentDerived.FindProperty("EnumDiscriminator"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Id"), dependentDerived.FindProperty("Id"), dependentBasebyteTableMapping0)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Money"), dependentDerived.FindProperty("Money"), dependentBasebyteTableMapping0)

            Dim principalBase = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase")

            Dim defaultTableMappings1 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalBase.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings1)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase", Nothing, relationalModel)
            Dim alternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("AlternateId", "uniqueidentifier", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("AlternateId", alternateIdColumnBase)
            Dim discriminatorColumnBase As New ColumnBase(Of ColumnMappingBase)("Discriminator", "nvarchar(55)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("Discriminator", discriminatorColumnBase)
            Dim idColumnBase0 As New ColumnBase(Of ColumnMappingBase)("Id", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("Id", idColumnBase0)
            Dim pointColumnBase As New ColumnBase(Of ColumnMappingBase)("Point", "geometry", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("Point", pointColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase As New TableMappingBase(Of ColumnMappingBase)(principalBase, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase, False)
            defaultTableMappings1.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("AlternateId"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("AlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Discriminator"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("Discriminator"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Point"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("Point"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)

            Dim tableMappings1 As New List(Of TableMapping)()
            principalBase.SetRuntimeAnnotation("Relational:TableMappings", tableMappings1)
            Dim principalBaseTable As New Table("PrincipalBase", Nothing, relationalModel)
            Dim idColumn0 As New Column("Id", "bigint", principalBaseTable)
            principalBaseTable.Columns.Add("Id", idColumn0)
            Dim alternateIdColumn As New Column("AlternateId", "uniqueidentifier", principalBaseTable)
            principalBaseTable.Columns.Add("AlternateId", alternateIdColumn)
            Dim discriminatorColumn As New Column("Discriminator", "nvarchar(55)", principalBaseTable)
            principalBaseTable.Columns.Add("Discriminator", discriminatorColumn)
            Dim manyOwnedColumn As New JsonColumn("ManyOwned", "nvarchar(max)", principalBaseTable) With {
                .IsNullable = True
            }
            principalBaseTable.Columns.Add("ManyOwned", manyOwnedColumn)
            Dim ownedColumn As New JsonColumn("Owned", "nvarchar(max)", principalBaseTable)
            principalBaseTable.Columns.Add("Owned", ownedColumn)
            Dim pointColumn As New Column("Point", "geometry", principalBaseTable) With {
                .IsNullable = True
            }
            principalBaseTable.Columns.Add("Point", pointColumn)
            Dim aK_PrincipalBase_Id As New UniqueConstraint("AK_PrincipalBase_Id", principalBaseTable, {idColumn0})
            Dim aK_PrincipalBase_IdUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id"})
            aK_PrincipalBase_Id.MappedKeys.Add(aK_PrincipalBase_IdUc)
            RelationalModel.GetOrCreateUniqueConstraints(aK_PrincipalBase_IdUc).Add(aK_PrincipalBase_Id)
            principalBaseTable.UniqueConstraints.Add("AK_PrincipalBase_Id", aK_PrincipalBase_Id)
            Dim pK As New UniqueConstraint("PK", principalBaseTable, {idColumn0, alternateIdColumn})
            principalBaseTable.PrimaryKey = pK
            Dim pKUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id", "AlternateId"})
            pK.MappedKeys.Add(pKUc)
            RelationalModel.GetOrCreateUniqueConstraints(pKUc).Add(pK)
            principalBaseTable.UniqueConstraints.Add("PK", pK)
            Dim iX_PrincipalBase_AlternateId_Id As New TableIndex(
            "IX_PrincipalBase_AlternateId_Id", principalBaseTable, {alternateIdColumn, idColumn0}, False)
            Dim iX_PrincipalBase_AlternateId_IdIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"AlternateId", "Id"})
            iX_PrincipalBase_AlternateId_Id.MappedIndexes.Add(iX_PrincipalBase_AlternateId_IdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_PrincipalBase_AlternateId_IdIx).Add(iX_PrincipalBase_AlternateId_Id)
            principalBaseTable.Indexes.Add("IX_PrincipalBase_AlternateId_Id", iX_PrincipalBase_AlternateId_Id)
            relationalModel.Tables.Add(("PrincipalBase", Nothing), principalBaseTable)
            Dim principalBaseTableMapping As New TableMapping(principalBase, principalBaseTable, True) With {
                .IsSharedTablePrincipal = True
            }
            principalBaseTable.AddEntityTypeMapping(principalBaseTableMapping, False)
            tableMappings1.Add(principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("AlternateId"), principalBase.FindProperty("AlternateId"), principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Id"), principalBase.FindProperty("Id"), principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Discriminator"), principalBase.FindProperty("Discriminator"), principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Point"), principalBase.FindProperty("Point"), principalBaseTableMapping)

            Dim ownedType = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType")

            Dim defaultTableMappings2 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            ownedType.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings2)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType", Nothing, relationalModel)
            Dim ownedColumnBase As New JsonColumnBase("Owned", "nvarchar(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.Columns.Add("Owned", ownedColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase As New TableMappingBase(Of ColumnMappingBase)(ownedType, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase, False)
            defaultTableMappings2.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseOwnedOwnedTypeMappingBase)

            Dim tableMappings2 As New List(Of TableMapping)()
            ownedType.SetRuntimeAnnotation("Relational:TableMappings", tableMappings2)
            Dim principalBaseTableMapping0 As New TableMapping(ownedType, principalBaseTable, True) With {
                .IsSharedTablePrincipal = False
            }
            principalBaseTable.AddEntityTypeMapping(principalBaseTableMapping0, False)
            tableMappings2.Add(principalBaseTableMapping0)
            principalBaseTable.AddRowInternalForeignKey(ownedType, RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType",
                {"PrincipalBaseId", "PrincipalBaseAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id", "AlternateId"}))

            Dim principalDerived = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>")

            Dim defaultTableMappings3 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalDerived.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings3)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0 As New TableMappingBase(Of ColumnMappingBase)(principalDerived, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0, False)
            defaultTableMappings3.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("AlternateId"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("AlternateId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Discriminator"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("Discriminator"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Point"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("Point"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase0)

            Dim tableMappings3 As New List(Of TableMapping)()
            principalDerived.SetRuntimeAnnotation("Relational:TableMappings", tableMappings3)
            Dim principalBaseTableMapping1 As New TableMapping(principalDerived, principalBaseTable, True) With {
                .IsSharedTablePrincipal = False
            }
            principalBaseTable.AddEntityTypeMapping(principalBaseTableMapping1, False)
            tableMappings3.Add(principalBaseTableMapping1)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("AlternateId"), principalDerived.FindProperty("AlternateId"), principalBaseTableMapping1)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Id"), principalDerived.FindProperty("Id"), principalBaseTableMapping1)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Discriminator"), principalDerived.FindProperty("Discriminator"), principalBaseTableMapping1)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Point"), principalDerived.FindProperty("Point"), principalBaseTableMapping1)

            Dim ownedType0 = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType")

            Dim defaultTableMappings4 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            ownedType0.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings4)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType", Nothing, relationalModel)
            Dim manyOwnedColumnBase As New JsonColumnBase("ManyOwned", "nvarchar(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.Columns.Add("ManyOwned", manyOwnedColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase As New TableMappingBase(Of ColumnMappingBase)(ownedType0, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase, False)
            defaultTableMappings4.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteManyOwnedOwnedTypeMappingBase)

            Dim tableMappings4 As New List(Of TableMapping)()
            ownedType0.SetRuntimeAnnotation("Relational:TableMappings", tableMappings4)
            Dim principalBaseTableMapping2 As New TableMapping(ownedType0, principalBaseTable, True) With {
                .IsSharedTablePrincipal = False
            }
            principalBaseTable.AddEntityTypeMapping(principalBaseTableMapping2, True)
            tableMappings4.Add(principalBaseTableMapping2)
            principalBaseTable.AddRowInternalForeignKey(ownedType0, RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType",
                {"PrincipalDerivedId", "PrincipalDerivedAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id", "AlternateId"}))

            Dim principalBasePrincipalDerivedDependentBasebyte = FindEntityType("PrincipalBasePrincipalDerived<DependentBase<byte?>>")

            Dim defaultTableMappings5 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalBasePrincipalDerivedDependentBasebyte.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings5)
            Dim principalBasePrincipalDerivedDependentBasebyteTableBase As New TableBase("PrincipalBasePrincipalDerived<DependentBase<byte?>>", Nothing, relationalModel)
            Dim derivedsAlternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("DerivedsAlternateId", "uniqueidentifier", principalBasePrincipalDerivedDependentBasebyteTableBase)
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("DerivedsAlternateId", derivedsAlternateIdColumnBase)
            Dim derivedsIdColumnBase As New ColumnBase(Of ColumnMappingBase)("DerivedsId", "bigint", principalBasePrincipalDerivedDependentBasebyteTableBase)
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("DerivedsId", derivedsIdColumnBase)
            Dim principalsAlternateIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalsAlternateId", "uniqueidentifier", principalBasePrincipalDerivedDependentBasebyteTableBase)
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("PrincipalsAlternateId", principalsAlternateIdColumnBase)
            Dim principalsIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalsId", "bigint", principalBasePrincipalDerivedDependentBasebyteTableBase)
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("PrincipalsId", principalsIdColumnBase)
            Dim rowidColumnBase As New ColumnBase(Of ColumnMappingBase)("rowid", "rowversion", principalBasePrincipalDerivedDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            principalBasePrincipalDerivedDependentBasebyteTableBase.Columns.Add("rowid", rowidColumnBase)
            relationalModel.DefaultTables.Add("PrincipalBasePrincipalDerived<DependentBase<byte?>>", principalBasePrincipalDerivedDependentBasebyteTableBase)
            Dim principalBasePrincipalDerivedDependentBasebyteMappingBase As New TableMappingBase(Of ColumnMappingBase)(principalBasePrincipalDerivedDependentBasebyte, principalBasePrincipalDerivedDependentBasebyteTableBase, True)
            principalBasePrincipalDerivedDependentBasebyteTableBase.AddEntityTypeMapping(principalBasePrincipalDerivedDependentBasebyteMappingBase, False)
            defaultTableMappings5.Add(principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("DerivedsAlternateId"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("DerivedsAlternateId"), principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("DerivedsId"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("DerivedsId"), principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("PrincipalsAlternateId"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("PrincipalsAlternateId"), principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("PrincipalsId"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("PrincipalsId"), principalBasePrincipalDerivedDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(principalBasePrincipalDerivedDependentBasebyteTableBase.FindColumn("rowid"), ColumnBase(Of ColumnMappingBase)), principalBasePrincipalDerivedDependentBasebyte.FindProperty("rowid"), principalBasePrincipalDerivedDependentBasebyteMappingBase)

            Dim tableMappings5 As New List(Of TableMapping)()
            principalBasePrincipalDerivedDependentBasebyte.SetRuntimeAnnotation("Relational:TableMappings", tableMappings5)
            Dim principalBasePrincipalDerivedDependentBasebyteTable As New Table("PrincipalBasePrincipalDerived<DependentBase<byte?>>", Nothing, relationalModel)
            Dim derivedsIdColumn As New Column("DerivedsId", "bigint", principalBasePrincipalDerivedDependentBasebyteTable)
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("DerivedsId", derivedsIdColumn)
            Dim derivedsAlternateIdColumn As New Column("DerivedsAlternateId", "uniqueidentifier", principalBasePrincipalDerivedDependentBasebyteTable)
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("DerivedsAlternateId", derivedsAlternateIdColumn)
            Dim principalsIdColumn As New Column("PrincipalsId", "bigint", principalBasePrincipalDerivedDependentBasebyteTable)
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("PrincipalsId", principalsIdColumn)
            Dim principalsAlternateIdColumn As New Column("PrincipalsAlternateId", "uniqueidentifier", principalBasePrincipalDerivedDependentBasebyteTable)
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("PrincipalsAlternateId", principalsAlternateIdColumn)
            Dim rowidColumn As New Column("rowid", "rowversion", principalBasePrincipalDerivedDependentBasebyteTable) With {
                .IsNullable = True
            }
            principalBasePrincipalDerivedDependentBasebyteTable.Columns.Add("rowid", rowidColumn)
            Dim pK_PrincipalBasePrincipalDerivedDependentBasebyte As New UniqueConstraint("PK_PrincipalBasePrincipalDerived<DependentBase<byte?>>", principalBasePrincipalDerivedDependentBasebyteTable, {derivedsIdColumn, derivedsAlternateIdColumn, principalsIdColumn, principalsAlternateIdColumn})
            principalBasePrincipalDerivedDependentBasebyteTable.PrimaryKey = pK_PrincipalBasePrincipalDerivedDependentBasebyte
            Dim pK_PrincipalBasePrincipalDerivedDependentBasebyteUc = RelationalModel.GetKey(Me,
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                {"DerivedsId", "DerivedsAlternateId", "PrincipalsId", "PrincipalsAlternateId"})
            pK_PrincipalBasePrincipalDerivedDependentBasebyte.MappedKeys.Add(pK_PrincipalBasePrincipalDerivedDependentBasebyteUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_PrincipalBasePrincipalDerivedDependentBasebyteUc).Add(pK_PrincipalBasePrincipalDerivedDependentBasebyte)
            principalBasePrincipalDerivedDependentBasebyteTable.UniqueConstraints.Add("PK_PrincipalBasePrincipalDerived<DependentBase<byte?>>", pK_PrincipalBasePrincipalDerivedDependentBasebyte)
            Dim iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateId As New TableIndex(
            "IX_PrincipalBasePrincipalDerived<DependentBase<byte?>>_PrincipalsId_PrincipalsAlternateId", principalBasePrincipalDerivedDependentBasebyteTable, {principalsIdColumn, principalsAlternateIdColumn}, False)
            Dim iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateIdIx = RelationalModel.GetIndex(Me,
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                {"PrincipalsId", "PrincipalsAlternateId"})
            iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateId.MappedIndexes.Add(iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateIdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateIdIx).Add(iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateId)
            principalBasePrincipalDerivedDependentBasebyteTable.Indexes.Add("IX_PrincipalBasePrincipalDerived<DependentBase<byte?>>_PrincipalsId_PrincipalsAlternateId", iX_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalsId_PrincipalsAlternateId)
            relationalModel.Tables.Add(("PrincipalBasePrincipalDerived<DependentBase<byte?>>", Nothing), principalBasePrincipalDerivedDependentBasebyteTable)
            Dim principalBasePrincipalDerivedDependentBasebyteTableMapping As New TableMapping(principalBasePrincipalDerivedDependentBasebyte, principalBasePrincipalDerivedDependentBasebyteTable, True)
            principalBasePrincipalDerivedDependentBasebyteTable.AddEntityTypeMapping(principalBasePrincipalDerivedDependentBasebyteTableMapping, False)
            tableMappings5.Add(principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("DerivedsAlternateId"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("DerivedsAlternateId"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("DerivedsId"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("DerivedsId"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("PrincipalsAlternateId"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("PrincipalsAlternateId"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("PrincipalsId"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("PrincipalsId"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(principalBasePrincipalDerivedDependentBasebyteTable.FindColumn("rowid"), principalBasePrincipalDerivedDependentBasebyte.FindProperty("rowid"), principalBasePrincipalDerivedDependentBasebyteTableMapping)
            Dim fK_DependentBasebyte_PrincipalBase_PrincipalId As New ForeignKeyConstraint(
                "FK_DependentBase<byte?>_PrincipalBase_PrincipalId", dependentBasebyteTable, principalBaseTable,
                {principalIdColumn},
                principalBaseTable.FindUniqueConstraint("AK_PrincipalBase_Id"), ReferentialAction.Cascade)
            Dim fK_DependentBasebyte_PrincipalBase_PrincipalIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id"})
            fK_DependentBasebyte_PrincipalBase_PrincipalId.MappedForeignKeys.Add(fK_DependentBasebyte_PrincipalBase_PrincipalIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_DependentBasebyte_PrincipalBase_PrincipalIdFk).Add(fK_DependentBasebyte_PrincipalBase_PrincipalId)
            dependentBasebyteTable.ForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalBase_PrincipalId)
            principalBaseTable.ReferencingForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalBase_PrincipalId)
            Dim fK_DependentBasebyte_PrincipalBase_PrincipalId_PrincipalAlternateId As New ForeignKeyConstraint(
                "FK_DependentBase<byte?>_PrincipalBase_PrincipalId_PrincipalAlternateId", dependentBasebyteTable, principalBaseTable,
                {principalIdColumn, principalAlternateIdColumn},
                principalBaseTable.FindUniqueConstraint("PK"), ReferentialAction.NoAction)
            Dim fK_DependentBasebyte_PrincipalBase_PrincipalId_PrincipalAlternateIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId", "PrincipalAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id", "AlternateId"})
            fK_DependentBasebyte_PrincipalBase_PrincipalId_PrincipalAlternateId.MappedForeignKeys.Add(fK_DependentBasebyte_PrincipalBase_PrincipalId_PrincipalAlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_DependentBasebyte_PrincipalBase_PrincipalId_PrincipalAlternateIdFk).Add(fK_DependentBasebyte_PrincipalBase_PrincipalId_PrincipalAlternateId)
            dependentBasebyteTable.ForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalBase_PrincipalId_PrincipalAlternateId)
            principalBaseTable.ReferencingForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalBase_PrincipalId_PrincipalAlternateId)
            Dim fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_DerivedsId_DerivedsAlternateId As New ForeignKeyConstraint(
                "FK_PrincipalBasePrincipalDerived<DependentBase<byte?>>_PrincipalBase_DerivedsId_DerivedsAlternateId", principalBasePrincipalDerivedDependentBasebyteTable, principalBaseTable,
                {derivedsIdColumn, derivedsAlternateIdColumn},
                principalBaseTable.FindUniqueConstraint("PK"), ReferentialAction.Cascade)
            Dim fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_DerivedsId_DerivedsAlternateIdFk = RelationalModel.GetForeignKey(Me,
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                {"DerivedsId", "DerivedsAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id", "AlternateId"})
            fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_DerivedsId_DerivedsAlternateId.MappedForeignKeys.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_DerivedsId_DerivedsAlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_DerivedsId_DerivedsAlternateIdFk).Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_DerivedsId_DerivedsAlternateId)
            principalBasePrincipalDerivedDependentBasebyteTable.ForeignKeyConstraints.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_DerivedsId_DerivedsAlternateId)
            principalBaseTable.ReferencingForeignKeyConstraints.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_DerivedsId_DerivedsAlternateId)
            Dim fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId As New ForeignKeyConstraint(
                "FK_PrincipalBasePrincipalDerived<DependentBase<byte?>>_PrincipalBase_PrincipalsId_PrincipalsAlternateId", principalBasePrincipalDerivedDependentBasebyteTable, principalBaseTable,
                {principalsIdColumn, principalsAlternateIdColumn},
                principalBaseTable.FindUniqueConstraint("PK"), ReferentialAction.NoAction)
            Dim fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateIdFk = RelationalModel.GetForeignKey(Me,
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                {"PrincipalsId", "PrincipalsAlternateId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id", "AlternateId"})
            fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId.MappedForeignKeys.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateIdFk).Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId)
            principalBasePrincipalDerivedDependentBasebyteTable.ForeignKeyConstraints.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId)
            principalBaseTable.ReferencingForeignKeyConstraints.Add(fK_PrincipalBasePrincipalDerivedDependentBasebyte_PrincipalBase_PrincipalsId_PrincipalsAlternateId)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value

            Dim DependentBaseEntityType = <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Migrations.Design
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.ValueGeneration

Namespace TestNamespace
    Friend Partial Class DependentBaseEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)),
                baseEntityType,
                discriminatorProperty:="EnumDiscriminator",
                discriminatorValue:=VisualBasicMigrationsGeneratorTests.Enum1.One)

            Dim principalId = entityType.AddProperty(
                "PrincipalId",
                GetType(Long),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalAlternateId = entityType.AddProperty(
                "PrincipalAlternateId",
                GetType(Guid),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim enumDiscriminator = entityType.AddProperty(
                "EnumDiscriminator",
                GetType(VisualBasicMigrationsGeneratorTests.Enum1),
                afterSaveBehavior:=PropertySaveBehavior.Throw,
                valueGeneratorFactory:=AddressOf New DiscriminatorValueGeneratorFactory().Create)
            enumDiscriminator.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Byte?),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetProperty("Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetField("_Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {principalId, principalAlternateId})
            entityType.SetPrimaryKey(key)

            Dim index = entityType.AddIndex(
                {principalId},
                unique:=True)

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                unique:=True,
                required:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Function CreateForeignKey2(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalId"), declaringEntityType.FindProperty("PrincipalAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.ClientNoAction,
                unique:=True,
                required:=True)

            Dim principal = declaringEntityType.AddNavigation("Principal",
                runtimeForeignKey,
                onDependent:=True,
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetProperty("Principal", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetField("_Principal", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim dependent = principalEntityType.AddNavigation("Dependent",
                runtimeForeignKey,
                onDependent:=False,
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetProperty("Dependent", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetField("_Dependent", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                eagerLoaded:=True,
                lazyLoadingEnabled:=False)

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("DiscriminatorMappingComplete", False)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:MappingStrategy", "TPH")
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "DependentBase<byte?>")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim PrincipalBaseEntityType = <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Storage.ValueConversion
Imports Microsoft.EntityFrameworkCore.ValueGeneration
Imports NetTopologySuite.Geometries

Namespace TestNamespace
    Friend Partial Class PrincipalBaseEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase),
                baseEntityType,
                discriminatorProperty:="Discriminator",
                discriminatorValue:="PrincipalBase")

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Long?),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetProperty("Id", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("_Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim alternateId = entityType.AddProperty(
                "AlternateId",
                GetType(Guid),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("AlternateId", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                propertyAccessMode:=PropertyAccessMode.FieldDuringConstruction,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            alternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim discriminator = entityType.AddProperty(
                "Discriminator",
                GetType(String),
                afterSaveBehavior:=PropertySaveBehavior.Throw,
                maxLength:=55,
                valueGeneratorFactory:=AddressOf New DiscriminatorValueGeneratorFactory().Create)
            discriminator.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim point = entityType.AddProperty(
                "Point",
                GetType(Point),
                nullable:=True,
                valueGenerated:=ValueGenerated.OnAdd,
                valueConverter:=New CastingConverter(Of Point, Point)(),
                valueComparer:=New VisualBasicRuntimeModelCodeGeneratorTest.CustomValueComparer(Of Point)(),
                providerValueComparer:=New VisualBasicRuntimeModelCodeGeneratorTest.CustomValueComparer(Of Point)())
            point.AddAnnotation("Relational:ColumnType", "geometry")
            point.AddAnnotation("Relational:DefaultValue", CType(New NetTopologySuite.IO.WKTReader().Read("SRID=0;POINT Z(0 0 0)"), NetTopologySuite.Geometries.Point))
            point.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {id})

            Dim key0 = entityType.AddKey(
                {id, alternateId})
            entityType.SetPrimaryKey(key0)
            key0.AddAnnotation("Relational:Name", "PK")

            Dim index = entityType.AddIndex(
                {alternateId, id})

            Return entityType
        End Function

        Public Shared Function CreateSkipNavigation1(declaringEntityType As RuntimeEntityType, targetEntityType As RuntimeEntityType, joinEntityType As RuntimeEntityType) As RuntimeSkipNavigation
            Dim skipNavigation = declaringEntityType.AddSkipNavigation(
                "Deriveds",
                targetEntityType,
                joinEntityType.FindForeignKey(
                    {joinEntityType.FindProperty("PrincipalsId"), joinEntityType.FindProperty("PrincipalsAlternateId")},
                    declaringEntityType.FindKey({declaringEntityType.FindProperty("Id"), declaringEntityType.FindProperty("AlternateId")}),
                    declaringEntityType),
                True,
                False,
                GetType(ICollection(Of VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetProperty("Deriveds", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("_Deriveds", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim inverse = targetEntityType.FindSkipNavigation("Principals")
            If inverse IsNot Nothing Then
                skipNavigation.Inverse = inverse
                inverse.Inverse = skipNavigation
            End If

            Return skipNavigation
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:MappingStrategy", "TPH")
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBase")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim OwnedTypeEntityType = <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class OwnedTypeEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase.Owned#OwnedType",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType),
                baseEntityType,
                sharedClrType:=True,
                changeTrackingStrategy:=ChangeTrackingStrategy.ChangingAndChangedNotificationsWithOriginalValues)

            Dim principalBaseId = entityType.AddProperty(
                "PrincipalBaseId",
                GetType(Long),
                propertyAccessMode:=PropertyAccessMode.Field,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalBaseId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalBaseAlternateId = entityType.AddProperty(
                "PrincipalBaseAlternateId",
                GetType(Guid),
                propertyAccessMode:=PropertyAccessMode.Field,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalBaseAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim details = entityType.AddProperty(
                "Details",
                GetType(String),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Details", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetField("_Details", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                propertyAccessMode:=PropertyAccessMode.Field,
                nullable:=True)
            details.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim number = entityType.AddProperty(
                "Number",
                GetType(Integer),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Number", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetField("_Number", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                propertyAccessMode:=PropertyAccessMode.Field)
            number.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim context = entityType.AddServiceProperty(
                "Context",
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Context", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                serviceType:=GetType(Microsoft.EntityFrameworkCore.DbContext))

            Dim key = entityType.AddKey(
                {principalBaseId, principalBaseAlternateId})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalBaseId"), declaringEntityType.FindProperty("PrincipalBaseAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                unique:=True,
                required:=True,
                requiredDependent:=True,
                ownership:=True)

            Dim owned = principalEntityType.AddNavigation("Owned",
                runtimeForeignKey,
                onDependent:=False,
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetProperty("Owned", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("_ownedField", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                propertyAccessMode:=PropertyAccessMode.Field,
                eagerLoaded:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:ContainerColumnName", "Owned")
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBase")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim OwnedType0EntityType = <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class OwnedType0EntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>.ManyOwned#OwnedType",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType),
                baseEntityType,
                sharedClrType:=True)

            Dim principalDerivedId = entityType.AddProperty(
                "PrincipalDerivedId",
                GetType(Long),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalDerivedId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalDerivedAlternateId = entityType.AddProperty(
                "PrincipalDerivedAlternateId",
                GetType(Guid),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalDerivedAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Integer),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)

            Dim details = entityType.AddProperty(
                "Details",
                GetType(String),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Details", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetField("_Details", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            details.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim number = entityType.AddProperty(
                "Number",
                GetType(Integer),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Number", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetField("_Number", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))
            number.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim context = entityType.AddServiceProperty(
                "Context",
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.OwnedType).GetProperty("Context", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                serviceType:=GetType(Microsoft.EntityFrameworkCore.DbContext))

            Dim key = entityType.AddKey(
                {principalDerivedId, principalDerivedAlternateId, id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalDerivedId"), declaringEntityType.FindProperty("PrincipalDerivedAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                required:=True,
                ownership:=True)

            Dim manyOwned = principalEntityType.AddNavigation("ManyOwned",
                runtimeForeignKey,
                onDependent:=False,
                GetType(ICollection(Of VisualBasicRuntimeModelCodeGeneratorTest.OwnedType)),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetField("ManyOwned", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                eagerLoaded:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:ContainerColumnName", "ManyOwned")
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBase")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim PrincipalBasePrincipalDerivedDependentBasebyteEntityType = <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class PrincipalBasePrincipalDerivedDependentBasebyteEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "PrincipalBasePrincipalDerived<DependentBase<byte?>>",
                GetType(Dictionary(Of String, Object)),
                baseEntityType,
                sharedClrType:=True,
                indexerPropertyInfo:=RuntimeEntityType.FindIndexerProperty(GetType(Dictionary(Of String, Object))),
                propertyBag:=True)

            Dim derivedsId = entityType.AddProperty(
                "DerivedsId",
                GetType(Long),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            derivedsId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim derivedsAlternateId = entityType.AddProperty(
                "DerivedsAlternateId",
                GetType(Guid),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            derivedsAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalsId = entityType.AddProperty(
                "PrincipalsId",
                GetType(Long),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalsId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalsAlternateId = entityType.AddProperty(
                "PrincipalsAlternateId",
                GetType(Guid),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            principalsAlternateId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim rowid = entityType.AddProperty(
                "rowid",
                GetType(Byte()),
                propertyInfo:=entityType.FindIndexerPropertyInfo(),
                nullable:=True,
                concurrencyToken:=True,
                valueGenerated:=ValueGenerated.OnAddOrUpdate,
                beforeSaveBehavior:=PropertySaveBehavior.Ignore,
                afterSaveBehavior:=PropertySaveBehavior.Ignore)
            rowid.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {derivedsId, derivedsAlternateId, principalsId, principalsAlternateId})
            entityType.SetPrimaryKey(key)

            Dim index = entityType.AddIndex(
                {principalsId, principalsAlternateId})

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("DerivedsId"), declaringEntityType.FindProperty("DerivedsAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.Cascade,
                required:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Function CreateForeignKey2(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalsId"), declaringEntityType.FindProperty("PrincipalsAlternateId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id"), principalEntityType.FindProperty("AlternateId")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.ClientCascade,
                required:=True)

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBasePrincipalDerived<DependentBase<byte?>>")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim DependentDerivedEntityType = <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Migrations.Design
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class DependentDerivedEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentDerived<byte?>",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentDerived(Of Byte?)),
                baseEntityType,
                discriminatorProperty:="EnumDiscriminator",
                discriminatorValue:=VisualBasicMigrationsGeneratorTests.Enum1.Two)

            Dim data = entityType.AddProperty(
                "Data",
                GetType(String),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentDerived(Of Byte?)).GetProperty("Data", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentDerived(Of Byte?)).GetField("_Data", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True,
                maxLength:=20,
                unicode:=False)
            data.AddAnnotation("Relational:IsFixedLength", True)
            data.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim money = entityType.AddProperty(
                "Money",
                GetType(Decimal),
                precision:=9,
                scale:=3)
            money.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "DependentBase<byte?>")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim PrincipalDerivedEntityType = <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class PrincipalDerivedEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))),
                baseEntityType,
                discriminatorProperty:="Discriminator",
                discriminatorValue:="PrincipalDerived<DependentBase<byte?>>")

            Return entityType
        End Function

        Public Shared Function CreateSkipNavigation1(declaringEntityType As RuntimeEntityType, targetEntityType As RuntimeEntityType, joinEntityType As RuntimeEntityType) As RuntimeSkipNavigation
            Dim skipNavigation = declaringEntityType.AddSkipNavigation(
                "Principals",
                targetEntityType,
                joinEntityType.FindForeignKey(
                    {joinEntityType.FindProperty("DerivedsId"), joinEntityType.FindProperty("DerivedsAlternateId")},
                    declaringEntityType.FindKey({declaringEntityType.FindProperty("Id"), declaringEntityType.FindProperty("AlternateId")}),
                    declaringEntityType),
                True,
                False,
                GetType(ICollection(Of VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetProperty("Principals", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetField("_Principals", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                eagerLoaded:=True,
                lazyLoadingEnabled:=False)

            Dim inverse = targetEntityType.FindSkipNavigation("Deriveds")
            If inverse IsNot Nothing Then
                skipNavigation.Inverse = inverse
                inverse.Inverse = skipNavigation
            End If

            Return skipNavigation
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBase")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New BigContextWithJson(),
                CreateCompiledModelCodeGenerationOptions(),
                Sub(code)
                    Assert.
                        Collection(code,
                        Sub(c) AssertFileContents("BigContextWithJsonModel.vb", BigContextWithJsonModel, c),
                        Sub(c) AssertFileContents("BigContextWithJsonModelBuilder.vb", BigContextWithJsonModelBuilder, c),
                        Sub(c) AssertFileContents("DependentBaseEntityType.vb", DependentBaseEntityType, c),
                        Sub(c) AssertFileContents("PrincipalBaseEntityType.vb", PrincipalBaseEntityType, c),
                        Sub(c) AssertFileContents("OwnedTypeEntityType.vb", OwnedTypeEntityType, c),
                        Sub(c) AssertFileContents("OwnedType0EntityType.vb", OwnedType0EntityType, c),
                        Sub(c) AssertFileContents("PrincipalBasePrincipalDerivedDependentBasebyteEntityType.vb", PrincipalBasePrincipalDerivedDependentBasebyteEntityType, c),
                        Sub(c) AssertFileContents("DependentDerivedEntityType.vb", DependentDerivedEntityType, c),
                        Sub(c) AssertFileContents("PrincipalDerivedEntityType.vb", PrincipalDerivedEntityType, c))
                End Sub,
                Sub(Model)
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() Model.GetCollation()).Message)
                    Assert.Equal(
                        {RelationalAnnotationNames.MaxIdentifierLength, SqlServerAnnotationNames.ValueGenerationStrategy},
                        Model.GetAnnotations().Select(Function(a) a.Name))
                    Assert.Equal(SqlServerValueGenerationStrategy.IdentityColumn, Model.GetValueGenerationStrategy())
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() Model.GetPropertyAccessMode()).Message)
                    Assert.Null(Model(SqlServerAnnotationNames.IdentitySeed))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() Model.GetIdentitySeed()).Message)
                    Assert.Null(Model(SqlServerAnnotationNames.IdentityIncrement))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() Model.GetIdentityIncrement()).Message)

                    Assert.Null(Model.FindEntityType(GetType(AbstractBase)))
                    Dim principalBaseET = Model.FindEntityType(GetType(PrincipalBase))
                    Assert.Equal(GetType(PrincipalBase).FullName, principalBaseET.Name)
                    Assert.False(principalBaseET.HasSharedClrType)
                    Assert.False(principalBaseET.IsPropertyBag)
                    Assert.False(principalBaseET.IsOwned())
                    Assert.Null(principalBaseET.BaseType)
                    Assert.IsType(Of ConstructorBinding)(principalBaseET.ConstructorBinding)
                    Assert.Null(principalBaseET.FindIndexerPropertyInfo())
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, principalBaseET.GetChangeTrackingStrategy())
                    Assert.Null(principalBaseET.GetQueryFilter())
                    Assert.Equal("PrincipalBase", principalBaseET.GetTableName())
                    Assert.Null(principalBaseET.GetSchema())
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() principalBaseET.GetSeedData()).Message)

                    Dim principalId = principalBaseET.FindProperty(NameOf(PrincipalBase.Id))
                    Assert.Equal(
                        {SqlServerAnnotationNames.ValueGenerationStrategy},
                        principalId.GetAnnotations().Select(Function(a) a.Name))
                    Assert.Equal(GetType(Long?), principalId.ClrType)
                    Assert.Equal(GetType(Long?), principalId.PropertyInfo.PropertyType)
                    Assert.Equal(GetType(Long?), principalId.FieldInfo.FieldType)
                    Assert.False(principalId.IsNullable)
                    Assert.Equal(ValueGenerated.Never, principalId.ValueGenerated)
                    Assert.Equal(PropertySaveBehavior.Throw, principalId.GetAfterSaveBehavior())
                    Assert.Equal(PropertySaveBehavior.Save, principalId.GetBeforeSaveBehavior())
                    Assert.Null(principalId(CoreAnnotationNames.BeforeSaveBehavior))
                    Assert.Null(principalId(CoreAnnotationNames.AfterSaveBehavior))
                    Assert.Equal("Id", principalId.GetColumnName())
                    Assert.Equal("bigint", principalId.GetColumnType())
                    Assert.Null(principalId.GetValueConverter())
                    Assert.NotNull(principalId.GetValueComparer())
                    Assert.NotNull(principalId.GetKeyValueComparer())
                    Assert.Equal(SqlServerValueGenerationStrategy.None, principalId.GetValueGenerationStrategy())
                    Assert.Null(principalId(SqlServerAnnotationNames.IdentitySeed))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() principalId.GetIdentitySeed()).Message)
                    Assert.Null(principalId(SqlServerAnnotationNames.IdentityIncrement))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() principalId.GetIdentityIncrement()).Message)

                    Dim pointProperty = principalBaseET.FindProperty("Point")
                    Assert.Equal(GetType(Point), pointProperty.ClrType)
                    Assert.True(pointProperty.IsNullable)
                    Assert.Equal(ValueGenerated.OnAdd, pointProperty.ValueGenerated)
                    Assert.Equal("Point", pointProperty.GetColumnName())
                    Assert.Equal("geometry", pointProperty.GetColumnType())
                    Assert.Equal(0, DirectCast(pointProperty.GetDefaultValue(), Point).SRID)
                    Assert.IsType(Of CastingConverter(Of Point, Point))(pointProperty.GetValueConverter())
                    Assert.IsType(Of CustomValueComparer(Of Point))(pointProperty.GetValueComparer())
                    Assert.IsType(Of CustomValueComparer(Of Point))(pointProperty.GetKeyValueComparer())
                    Assert.IsType(Of CustomValueComparer(Of Point))(pointProperty.GetProviderValueComparer())
                    Assert.Equal(SqlServerValueGenerationStrategy.None, pointProperty.GetValueGenerationStrategy())
                    Assert.Null(pointProperty(CoreAnnotationNames.PropertyAccessMode))

                    Dim discriminatorProperty = principalBaseET.FindDiscriminatorProperty()
                    Assert.Equal("Discriminator", discriminatorProperty.Name)
                    Assert.Equal(GetType(String), discriminatorProperty.ClrType)

                    Dim principalAlternateId = principalBaseET.FindProperty(NameOf(PrincipalBase.AlternateId))
                    Dim compositeIndex = principalBaseET.GetIndexes().Single()
                    Assert.Equal(PropertyAccessMode.FieldDuringConstruction, principalAlternateId.GetPropertyAccessMode())
                    Assert.Empty(compositeIndex.GetAnnotations())
                    Assert.Equal({principalAlternateId, principalId}, compositeIndex.Properties)
                    Assert.False(compositeIndex.IsUnique)
                    Assert.Null(compositeIndex.Name)
                    Assert.Equal("IX_PrincipalBase_AlternateId_Id", compositeIndex.GetDatabaseName())

                    Assert.Equal({compositeIndex}, principalAlternateId.GetContainingIndexes())

                    Assert.Equal(2, principalBaseET.GetKeys().Count())

                    Dim principalAlternateKey = principalBaseET.GetKeys().First()
                    Assert.Same(principalId, principalAlternateKey.Properties.Single())
                    Assert.False(principalAlternateKey.IsPrimaryKey())
                    Assert.Equal("AK_PrincipalBase_Id", principalAlternateKey.GetName())

                    Dim principalKey = principalBaseET.GetKeys().Last()
                    Assert.Equal(
                        {RelationalAnnotationNames.Name},
                        principalKey.GetAnnotations().Select(Function(a) a.Name))
                    Assert.Equal({principalId, principalAlternateId}, principalKey.Properties)
                    Assert.True(principalKey.IsPrimaryKey())
                    Assert.Equal("PK", principalKey.GetName())
                    Assert.Null(principalKey(SqlServerAnnotationNames.Clustered))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() principalKey.IsClustered()).Message)

                    Assert.Equal({principalAlternateKey, principalKey}, principalId.GetContainingKeys())

                    Dim referenceOwnedNavigation = principalBaseET.GetNavigations().Single()
                    Assert.Equal(
                         {CoreAnnotationNames.EagerLoaded},
                        referenceOwnedNavigation.GetAnnotations().Select(Function(a) a.Name))
                    Assert.Equal(NameOf(PrincipalBase.Owned), referenceOwnedNavigation.Name)
                    Assert.False(referenceOwnedNavigation.IsCollection)
                    Assert.True(referenceOwnedNavigation.IsEagerLoaded)
                    Assert.False(referenceOwnedNavigation.IsOnDependent)
                    Assert.Equal(GetType(OwnedType), referenceOwnedNavigation.ClrType)
                    Assert.Equal("_ownedField", referenceOwnedNavigation.FieldInfo.Name)
                    Assert.Equal(NameOf(PrincipalBase.Owned), referenceOwnedNavigation.PropertyInfo.Name)
                    Assert.Null(referenceOwnedNavigation.Inverse)
                    Assert.Equal(principalBaseET, referenceOwnedNavigation.DeclaringEntityType)
                    Assert.Equal(PropertyAccessMode.Field, referenceOwnedNavigation.GetPropertyAccessMode())
                    Assert.Null(referenceOwnedNavigation(CoreAnnotationNames.PropertyAccessMode))

                    Dim referenceOwnedType = referenceOwnedNavigation.TargetEntityType
                    Assert.Equal(GetType(PrincipalBase).FullName & ".Owned#OwnedType", referenceOwnedType.Name)
                    Assert.Equal(GetType(OwnedType), referenceOwnedType.ClrType)
                    Assert.True(referenceOwnedType.HasSharedClrType)
                    Assert.False(referenceOwnedType.IsPropertyBag)
                    Assert.True(referenceOwnedType.IsOwned())
                    Assert.Null(referenceOwnedType.BaseType)
                    Assert.False(referenceOwnedType.IsMemoryOptimized())
                    Assert.IsType(Of ConstructorBinding)(referenceOwnedType.ConstructorBinding)
                    Assert.Null(referenceOwnedType.FindIndexerPropertyInfo())
                    Assert.Equal(
                        ChangeTrackingStrategy.ChangingAndChangedNotificationsWithOriginalValues,
                        referenceOwnedType.GetChangeTrackingStrategy())
                    Assert.Null(referenceOwnedType.GetQueryFilter())
                    Assert.Null(referenceOwnedType(CoreAnnotationNames.PropertyAccessMode))
                    Assert.Null(referenceOwnedType(CoreAnnotationNames.NavigationAccessMode))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() referenceOwnedType.GetPropertyAccessMode()).Message)
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() referenceOwnedType.GetNavigationAccessMode()).Message)

                    Dim principalTable = StoreObjectIdentifier.Create(referenceOwnedType, StoreObjectType.Table).Value

                    Dim ownedId = referenceOwnedType.FindProperty("PrincipalBaseId")
                    Assert.True(ownedId.IsPrimaryKey())
                    Assert.Equal(
                        SqlServerValueGenerationStrategy.None,
                        principalId.GetValueGenerationStrategy(principalTable))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() principalId.GetIdentityIncrement(principalTable)).Message)
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() principalId.GetIdentitySeed(principalTable)).Message)

                    Dim detailsProperty = referenceOwnedType.FindProperty(NameOf(OwnedType.Details))
                    Assert.Null(detailsProperty(SqlServerAnnotationNames.Sparse))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() detailsProperty.IsSparse()).Message)
                    Assert.Null(detailsProperty(RelationalAnnotationNames.Collation))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() detailsProperty.GetCollation()).Message)

                    Assert.Null(detailsProperty.GetColumnName(principalTable))

                    Dim referenceOwnership = referenceOwnedNavigation.ForeignKey
                    Assert.Empty(referenceOwnership.GetAnnotations())
                    Assert.Same(referenceOwnership, referenceOwnedType.FindOwnership())
                    Assert.True(referenceOwnership.IsOwnership)
                    Assert.True(referenceOwnership.IsRequired)
                    Assert.True(referenceOwnership.IsRequiredDependent)
                    Assert.True(referenceOwnership.IsUnique)
                    Assert.Null(referenceOwnership.DependentToPrincipal)
                    Assert.Same(referenceOwnedNavigation, referenceOwnership.PrincipalToDependent)
                    Assert.Equal(DeleteBehavior.Cascade, referenceOwnership.DeleteBehavior)
                    Assert.Equal(2, referenceOwnership.Properties.Count())
                    Assert.Same(principalKey, referenceOwnership.PrincipalKey)

                    Dim ownedServiceProperty = referenceOwnedType.GetServiceProperties().Single()
                    Assert.Empty(ownedServiceProperty.GetAnnotations())
                    Assert.Equal(GetType(DbContext), ownedServiceProperty.ClrType)
                    Assert.Equal(GetType(DbContext), ownedServiceProperty.PropertyInfo.PropertyType)
                    Assert.Null(ownedServiceProperty.FieldInfo)
                    Assert.Same(referenceOwnedType, ownedServiceProperty.DeclaringEntityType)
                    Dim ownedServicePropertyBinding = ownedServiceProperty.ParameterBinding
                    Assert.IsType(Of ContextParameterBinding)(ownedServicePropertyBinding)
                    Assert.Equal(GetType(DbContext), ownedServicePropertyBinding.ServiceType)
                    Assert.Equal(ownedServiceProperty, ownedServicePropertyBinding.ConsumedProperties.Single())
                    Assert.Equal(PropertyAccessMode.PreferField, ownedServiceProperty.GetPropertyAccessMode())
                    Assert.Null(ownedServiceProperty(CoreAnnotationNames.PropertyAccessMode))

                    Dim principalDerived = Model.FindEntityType(GetType(PrincipalDerived(Of DependentBase(Of Byte?))))
                    Assert.Equal(principalBaseET, principalDerived.BaseType)
                    Assert.Equal(
                        "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+" &
                        "PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                        principalDerived.Name)
                    Assert.False(principalDerived.IsOwned())
                    Assert.IsType(Of ConstructorBinding)(principalDerived.ConstructorBinding)
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, principalDerived.GetChangeTrackingStrategy())
                    Assert.Equal("PrincipalDerived<DependentBase<byte?>>", principalDerived.GetDiscriminatorValue())

                    Assert.Equal(2, principalDerived.GetDeclaredNavigations().Count())
                    Dim dependentNavigation = principalDerived.GetDeclaredNavigations().First()
                    Assert.Equal("Dependent", dependentNavigation.Name)
                    Assert.Equal("Dependent", dependentNavigation.PropertyInfo.Name)
                    Assert.Equal("_Dependent", dependentNavigation.FieldInfo.Name)
                    Assert.False(dependentNavigation.IsCollection)
                    Assert.True(dependentNavigation.IsEagerLoaded)
                    Assert.False(dependentNavigation.LazyLoadingEnabled)
                    Assert.False(dependentNavigation.IsOnDependent)
                    Assert.Equal(principalDerived, dependentNavigation.DeclaringEntityType)
                    Assert.Equal("Principal", dependentNavigation.Inverse.Name)

                    Dim ownedCollectionNavigation = principalDerived.GetDeclaredNavigations().Last()
                    Assert.Equal("ManyOwned", ownedCollectionNavigation.Name)
                    Assert.Null(ownedCollectionNavigation.PropertyInfo)
                    Assert.Equal("ManyOwned", ownedCollectionNavigation.FieldInfo.Name)
                    Assert.Equal(GetType(ICollection(Of OwnedType)), ownedCollectionNavigation.ClrType)
                    Assert.True(ownedCollectionNavigation.IsCollection)
                    Assert.True(ownedCollectionNavigation.IsEagerLoaded)
                    Assert.False(ownedCollectionNavigation.IsOnDependent)
                    Assert.Null(ownedCollectionNavigation.Inverse)
                    Assert.Equal(principalDerived, ownedCollectionNavigation.DeclaringEntityType)

                    Dim collectionOwnedType = ownedCollectionNavigation.TargetEntityType
                    Assert.Equal(principalDerived.Name & ".ManyOwned#OwnedType", collectionOwnedType.Name)
                    Assert.Equal(GetType(OwnedType), collectionOwnedType.ClrType)
                    Assert.True(collectionOwnedType.HasSharedClrType)
                    Assert.False(collectionOwnedType.IsPropertyBag)
                    Assert.True(collectionOwnedType.IsOwned())
                    Assert.False(collectionOwnedType.IsMemoryOptimized())
                    Assert.Null(collectionOwnedType(RelationalAnnotationNames.IsTableExcludedFromMigrations))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() collectionOwnedType.IsTableExcludedFromMigrations()).Message)
                    Assert.Null(collectionOwnedType.BaseType)
                    Assert.IsType(Of ConstructorBinding)(collectionOwnedType.ConstructorBinding)
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, collectionOwnedType.GetChangeTrackingStrategy())

                    Dim collectionOwnership = ownedCollectionNavigation.ForeignKey
                    Assert.Same(collectionOwnership, collectionOwnedType.FindOwnership())
                    Assert.True(collectionOwnership.IsOwnership)
                    Assert.True(collectionOwnership.IsRequired)
                    Assert.False(collectionOwnership.IsRequiredDependent)
                    Assert.False(collectionOwnership.IsUnique)
                    Assert.Null(collectionOwnership.DependentToPrincipal)
                    Assert.Same(ownedCollectionNavigation, collectionOwnership.PrincipalToDependent)
                    Assert.Equal(DeleteBehavior.Cascade, collectionOwnership.DeleteBehavior)
                    Assert.Equal(2, collectionOwnership.Properties.Count())

                    Dim derivedSkipNavigation = principalDerived.GetDeclaredSkipNavigations().Single()
                    Assert.Equal("Principals", derivedSkipNavigation.Name)
                    Assert.Equal("Principals", derivedSkipNavigation.PropertyInfo.Name)
                    Assert.Equal("_Principals", derivedSkipNavigation.FieldInfo.Name)
                    Assert.Equal(GetType(ICollection(Of PrincipalBase)), derivedSkipNavigation.ClrType)
                    Assert.True(derivedSkipNavigation.IsCollection)
                    Assert.True(derivedSkipNavigation.IsEagerLoaded)
                    Assert.False(derivedSkipNavigation.LazyLoadingEnabled)
                    Assert.False(derivedSkipNavigation.IsOnDependent)
                    Assert.Equal(principalDerived, derivedSkipNavigation.DeclaringEntityType)
                    Assert.Equal("Deriveds", derivedSkipNavigation.Inverse.Name)
                    Assert.Same(principalBaseET.GetSkipNavigations().Single(), derivedSkipNavigation.Inverse)

                    Assert.Same(derivedSkipNavigation, derivedSkipNavigation.ForeignKey.GetReferencingSkipNavigations().Single())
                    Assert.Same(
                        derivedSkipNavigation.Inverse, derivedSkipNavigation.Inverse.ForeignKey.GetReferencingSkipNavigations().Single())

                    Assert.Equal({derivedSkipNavigation.Inverse, derivedSkipNavigation}, principalDerived.GetSkipNavigations())

                    Dim joinType = derivedSkipNavigation.JoinEntityType

                    Assert.Equal("PrincipalBasePrincipalDerived<DependentBase<byte?>>", joinType.Name)
                    Assert.Equal(GetType(Dictionary(Of String, Object)), joinType.ClrType)
                    Assert.True(joinType.HasSharedClrType)
                    Assert.True(joinType.IsPropertyBag)
                    Assert.False(joinType.IsOwned())
                    Assert.Null(joinType.BaseType)
                    Assert.IsType(Of ConstructorBinding)(joinType.ConstructorBinding)
                    Assert.Equal("Item", joinType.FindIndexerPropertyInfo().Name)
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, joinType.GetChangeTrackingStrategy())
                    Assert.Null(joinType(RelationalAnnotationNames.Comment))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() joinType.GetComment()).Message)
                    Assert.Null(joinType.GetQueryFilter())

                    Dim rowid = joinType.GetProperties().Single(Function(p) Not p.IsForeignKey())
                    Assert.Equal(GetType(Byte()), rowid.ClrType)
                    Assert.True(rowid.IsIndexerProperty())
                    Assert.Same(joinType.FindIndexerPropertyInfo(), rowid.PropertyInfo)
                    Assert.Null(rowid.FieldInfo)
                    Assert.True(rowid.IsNullable)
                    Assert.False(rowid.IsShadowProperty())
                    Assert.True(rowid.IsConcurrencyToken)
                    Assert.Equal(ValueGenerated.OnAddOrUpdate, rowid.ValueGenerated)
                    Assert.Equal("rowid", rowid.GetColumnName())
                    Assert.Equal("rowversion", rowid.GetColumnType())
                    Assert.Null(rowid(RelationalAnnotationNames.Comment))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() rowid.GetComment()).Message)
                    Assert.Null(rowid(RelationalAnnotationNames.ColumnOrder))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() rowid.GetColumnOrder()).Message)
                    Assert.Null(rowid.GetValueConverter())
                    Assert.NotNull(rowid.GetValueComparer())
                    Assert.NotNull(rowid.GetKeyValueComparer())
                    Assert.Equal(SqlServerValueGenerationStrategy.None, rowid.GetValueGenerationStrategy())

                    Dim dependentForeignKey = dependentNavigation.ForeignKey
                    Assert.False(dependentForeignKey.IsOwnership)
                    Assert.True(dependentForeignKey.IsRequired)
                    Assert.False(dependentForeignKey.IsRequiredDependent)
                    Assert.True(dependentForeignKey.IsUnique)
                    Assert.Same(dependentNavigation.Inverse, dependentForeignKey.DependentToPrincipal)
                    Assert.Same(dependentNavigation, dependentForeignKey.PrincipalToDependent)
                    Assert.Equal(DeleteBehavior.ClientNoAction, dependentForeignKey.DeleteBehavior)
                    Assert.Equal({"PrincipalId", "PrincipalAlternateId"}, dependentForeignKey.Properties.Select(Function(p) p.Name))
                    Assert.Same(principalKey, dependentForeignKey.PrincipalKey)

                    Dim dependentBase = dependentNavigation.TargetEntityType

                    Assert.False(dependentBase.GetIsDiscriminatorMappingComplete())
                    Dim principalDiscriminator = dependentBase.FindDiscriminatorProperty()
                    Assert.IsType(Of DiscriminatorValueGenerator)(
                        principalDiscriminator.GetValueGeneratorFactory()(principalDiscriminator, dependentBase))
                    Assert.Equal(Enum1.One, dependentBase.GetDiscriminatorValue())

                    Dim dependentBaseForeignKey = dependentBase.GetForeignKeys().Single(Function(fk) fk IsNot dependentForeignKey)
                    Dim dependentForeignKeyProperty = dependentBaseForeignKey.Properties.Single()

                    Assert.Equal(
                         {dependentBaseForeignKey, dependentForeignKey}, dependentForeignKeyProperty.GetContainingForeignKeys())

                    Dim dependentDerived = dependentBase.GetDerivedTypes().Single()
                    Assert.Equal(Enum1.Two, dependentDerived.GetDiscriminatorValue())

                    Assert.Equal(2, dependentDerived.GetDeclaredProperties().Count())

                    Dim dependentData = dependentDerived.GetDeclaredProperties().First()
                    Assert.Equal(GetType(String), dependentData.ClrType)
                    Assert.Equal("Data", dependentData.Name)
                    Assert.Equal("Data", dependentData.PropertyInfo.Name)
                    Assert.Equal("_Data", dependentData.FieldInfo.Name)
                    Assert.True(dependentData.IsNullable)
                    Assert.False(dependentData.IsShadowProperty())
                    Assert.False(dependentData.IsConcurrencyToken)
                    Assert.Equal(ValueGenerated.Never, dependentData.ValueGenerated)
                    Assert.Equal("Data", dependentData.GetColumnName())
                    Assert.Equal("char(20)", dependentData.GetColumnType())
                    Assert.Equal(20, dependentData.GetMaxLength())
                    Assert.False(dependentData.IsUnicode())
                    Assert.True(dependentData.IsFixedLength())
                    Assert.Null(dependentData.GetPrecision())
                    Assert.Null(dependentData.GetScale())

                    Dim dependentMoney = dependentDerived.GetDeclaredProperties().Last()
                    Assert.Equal(GetType(Decimal), dependentMoney.ClrType)
                    Assert.Equal("Money", dependentMoney.Name)
                    Assert.Null(dependentMoney.PropertyInfo)
                    Assert.Null(dependentMoney.FieldInfo)
                    Assert.False(dependentMoney.IsNullable)
                    Assert.True(dependentMoney.IsShadowProperty())
                    Assert.False(dependentMoney.IsConcurrencyToken)
                    Assert.Equal(ValueGenerated.Never, dependentMoney.ValueGenerated)
                    Assert.Equal("Money", dependentMoney.GetColumnName())
                    Assert.Equal("decimal(9,3)", dependentMoney.GetColumnType())
                    Assert.Null(dependentMoney.GetMaxLength())
                    Assert.Null(dependentMoney.IsUnicode())
                    Assert.Null(dependentMoney.IsFixedLength())
                    Assert.Equal(9, dependentMoney.GetPrecision())
                    Assert.Equal(3, dependentMoney.GetScale())

                    Assert.Equal(
                        {
                            derivedSkipNavigation.ForeignKey,
                            referenceOwnership,
                            collectionOwnership,
                            dependentForeignKey,
                            derivedSkipNavigation.Inverse.ForeignKey
                        },
                        principalKey.GetReferencingForeignKeys())

                    Assert.Equal(
                         {dependentBaseForeignKey, referenceOwnership, derivedSkipNavigation.Inverse.ForeignKey},
                        principalBaseET.GetReferencingForeignKeys())

                    Assert.Equal(
                         {derivedSkipNavigation.ForeignKey, collectionOwnership, dependentForeignKey},
                        principalDerived.GetDeclaredReferencingForeignKeys())

                    Assert.Equal(
                        {
                            dependentBase,
                            dependentDerived,
                            principalBaseET,
                            referenceOwnedType,
                            principalDerived,
                            collectionOwnedType,
                            joinType
                        },
                        Model.GetEntityTypes())
                End Sub,
                GetType(SqlServerNetTopologySuiteDesignTimeServices))
        End Sub

        Public Class BigContextWithJson
            Inherits BigContext

            Public Sub New()
                MyBase.New(jsonColumns:=True)
            End Sub
        End Class

        Public Class BigContext
            Inherits SqlServerContextBase

            Private ReadOnly _jsonColumns As Boolean

            Public Sub New(Optional jsonColumns As Boolean = False)
                _jsonColumns = jsonColumns
            End Sub

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.
                    UseCollation("Latin1_General_CS_AS").
                    UseIdentityColumns(3, 2)

                modelBuilder.Entity(Of PrincipalBase)(
                    Sub(eb)
                        If Not _jsonColumns Then
                            eb.Property(Function(e) e.Id).
                            UseIdentityColumn(2, 3).
                            Metadata.
                            SetColumnName("DerivedId", StoreObjectIdentifier.
                            Table("PrincipalDerived"))
                        End If

                        eb.Property(Function(e) e.AlternateId).
                            UsePropertyAccessMode(PropertyAccessMode.FieldDuringConstruction)

                        eb.Property(Of Point)("Point").
                            HasColumnType("geometry").
                            HasDefaultValue(NtsGeometryServices.Instance.CreateGeometryFactory(srid:=0).
                            CreatePoint(New CoordinateZM(0, 0, 0, 0))).
                            HasConversion(Of CastingConverter(Of Point, Point), CustomValueComparer(Of Point), CustomValueComparer(Of Point))()

                        eb.HasIndex(Function(e) New With {e.AlternateId, e.Id})

                        eb.HasKey(Function(e) New With {e.Id, e.AlternateId}).HasName("PK").
                                                                              IsClustered()

                        eb.HasAlternateKey(Function(e) e.Id)

                        eb.OwnsOne(
                            Function(e) e.Owned,
                            Sub(ob)
                                ob.HasChangeTrackingStrategy(ChangeTrackingStrategy.ChangingAndChangedNotificationsWithOriginalValues)
                                ob.UsePropertyAccessMode(PropertyAccessMode.Field)
                                ob.Property(Function(e) e.Details).
                                    IsSparse().
                                    UseCollation("Latin1_General_CI_AI")

                                If _jsonColumns Then
                                    ob.ToJson()
                                Else
                                    ob.ToTable("PrincipalBase", "mySchema",
                                    Sub(t) t.Property("PrincipalBaseId").UseIdentityColumn(2, 3))

                                    ob.SplitToTable("Details", Sub(s) s.Property(Function(e) e.Details))

                                    ob.HasData(New With {
                                        .Number = 10,
                                        .PrincipalBaseId = 1L,
                                        .PrincipalBaseAlternateId = New Guid()
                                    })
                                End If
                            End Sub)

                        eb.Navigation(Function(e) e.Owned).
                           IsRequired().
                           HasField("_ownedField").
                           UsePropertyAccessMode(PropertyAccessMode.Field)

                        If Not _jsonColumns Then
                            eb.HasData(New PrincipalBase With {.Id = 1, .AlternateId = New Guid()})

                            eb.ToTable("PrincipalBase", "mySchema")
                        End If
                    End Sub)

                modelBuilder.Entity(Of PrincipalDerived(Of DependentBase(Of Byte?)))(
                    Sub(eb)
                        eb.HasOne(Function(e) e.Dependent).
                           WithOne(Function(e) e.Principal).
                           HasForeignKey(Of DependentBase(Of Byte?))().
                           OnDelete(DeleteBehavior.ClientNoAction)

                        eb.Navigation(Function(e) e.Dependent).AutoInclude().EnableLazyLoading(False)

                        eb.OwnsMany(GetType(OwnedType).FullName, "ManyOwned",
                                    Sub(ob)
                                        If _jsonColumns Then
                                            ob.ToJson()
                                        Else
                                            ob.ToTable("ManyOwned", Sub(t) t.IsMemoryOptimized().ExcludeFromMigrations())
                                        End If
                                    End Sub)

                        eb.HasMany(Function(e) e.Principals).
                           WithMany(Function(e) DirectCast(e.Deriveds, ICollection(Of PrincipalDerived(Of DependentBase(Of Byte?))))).
                           UsingEntity(
                            Sub(jb)
                                jb.ToTable(Function(tb) tb.HasComment("Join table"))
                                jb.Property(Of Byte())("rowid").
                                   IsRowVersion().
                                   HasComment("RowVersion").
                                   HasColumnOrder(1)
                            End Sub)

                        eb.Navigation(Function(e) e.Principals).AutoInclude().EnableLazyLoading(False)

                        If Not _jsonColumns Then
                            eb.ToTable("PrincipalDerived")
                        End If
                    End Sub)

                modelBuilder.Entity(Of DependentBase(Of Byte?))(
                    Sub(eb)
                        eb.Property(Of Byte?)("Id")

                        eb.HasKey({"PrincipalId", "PrincipalAlternateId"})

                        eb.HasOne(Of PrincipalBase)().
                           WithOne().
                           HasForeignKey(Of DependentBase(Of Byte?))("PrincipalId").
                           HasPrincipalKey(Of PrincipalBase)(Function(e) e.Id)

                        eb.HasDiscriminator(Of Enum1)("EnumDiscriminator").
                           HasValue(Enum1.One).
                           HasValue(Of DependentDerived(Of Byte?))(Enum1.Two).
                           IsComplete(False)
                    End Sub)

                modelBuilder.Entity(Of DependentDerived(Of Byte?))(
                    Sub(eb)
                        eb.Property(Of String)("Data").
                            HasMaxLength(20).
                            IsFixedLength().
                            IsUnicode(False)

                        eb.Property(Of Decimal)("Money").
                            HasPrecision(9, 3)
                    End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub TPC_model()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.TpcContext))>
    Public Partial Class TpcContextModel
        Inherits RuntimeModel

        Private Shared _Instance As TpcContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New TpcContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Internal
Imports Microsoft.EntityFrameworkCore.Migrations

Namespace TestNamespace
    Public Partial Class TpcContextModel

        Private Sub Initialize()
            Dim dependentBase = DependentBaseEntityType.Create(Me)
            Dim principalBase = PrincipalBaseEntityType.Create(Me)
            Dim principalDerived = PrincipalDerivedEntityType.Create(Me, principalBase)

            DependentBaseEntityType.CreateForeignKey1(dependentBase, principalDerived)
            PrincipalBaseEntityType.CreateForeignKey1(principalBase, principalBase)
            PrincipalBaseEntityType.CreateForeignKey2(principalBase, principalDerived)

            DependentBaseEntityType.CreateAnnotations(dependentBase)
            PrincipalBaseEntityType.CreateAnnotations(principalBase)
            PrincipalDerivedEntityType.CreateAnnotations(principalDerived)

            Dim sequences As New SortedDictionary(Of (String, String), ISequence)()
            Dim principalBaseSequence As New RuntimeSequence(
                "PrincipalBaseSequence",
                Me,
                GetType(Long),
                schema:="TPC",
                modelSchemaIsNull:=True)

            sequences(("PrincipalBaseSequence", Nothing)) = principalBaseSequence

            AddAnnotation("Relational:Sequences", sequences)
            AddAnnotation("Relational:DefaultSchema", "TPC")
            AddAnnotation("Relational:MaxIdentifierLength", 128)
            AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim dependentBase = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            dependentBase.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>", Nothing, relationalModel)
            Dim idColumnBase As New ColumnBase(Of ColumnMappingBase)("Id", "tinyint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Id", idColumnBase)
            Dim principalIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalId", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("PrincipalId", principalIdColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase As New TableMappingBase(Of ColumnMappingBase)(dependentBase, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalId"), ColumnBase(Of ColumnMappingBase)), dependentBase.FindProperty("PrincipalId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)

            Dim tableMappings As New List(Of TableMapping)()
            dependentBase.SetRuntimeAnnotation("Relational:TableMappings", tableMappings)
            Dim dependentBasebyteTable As New Table("DependentBase<byte?>", "TPC", relationalModel)
            Dim idColumn As New Column("Id", "tinyint", dependentBasebyteTable)
            dependentBasebyteTable.Columns.Add("Id", idColumn)
            Dim principalIdColumn As New Column("PrincipalId", "bigint", dependentBasebyteTable) With {
                .IsNullable = True
            }
            dependentBasebyteTable.Columns.Add("PrincipalId", principalIdColumn)
            Dim pK_DependentBasebyte As New UniqueConstraint("PK_DependentBase<byte?>", dependentBasebyteTable, {idColumn})
            dependentBasebyteTable.PrimaryKey = pK_DependentBasebyte
            Dim pK_DependentBasebyteUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"Id"})
            pK_DependentBasebyte.MappedKeys.Add(pK_DependentBasebyteUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DependentBasebyteUc).Add(pK_DependentBasebyte)
            dependentBasebyteTable.UniqueConstraints.Add("PK_DependentBase<byte?>", pK_DependentBasebyte)
            Dim iX_DependentBasebyte_PrincipalId As New TableIndex(
            "IX_DependentBase<byte?>_PrincipalId", dependentBasebyteTable, {principalIdColumn}, True)
            Dim iX_DependentBasebyte_PrincipalIdIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId"})
            iX_DependentBasebyte_PrincipalId.MappedIndexes.Add(iX_DependentBasebyte_PrincipalIdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_DependentBasebyte_PrincipalIdIx).Add(iX_DependentBasebyte_PrincipalId)
            dependentBasebyteTable.Indexes.Add("IX_DependentBase<byte?>_PrincipalId", iX_DependentBasebyte_PrincipalId)
            relationalModel.Tables.Add(("DependentBase<byte?>", "TPC"), dependentBasebyteTable)
            Dim dependentBasebyteTableMapping As New TableMapping(dependentBase, dependentBasebyteTable, True)
            dependentBasebyteTable.AddEntityTypeMapping(dependentBasebyteTableMapping, False)
            tableMappings.Add(dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("Id"), dependentBase.FindProperty("Id"), dependentBasebyteTableMapping)
            RelationalModel.CreateColumnMapping(dependentBasebyteTable.FindColumn("PrincipalId"), dependentBase.FindProperty("PrincipalId"), dependentBasebyteTableMapping)

            Dim principalBase = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase")

            Dim defaultTableMappings0 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalBase.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings0)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase", Nothing, relationalModel)
            Dim idColumnBase0 As New ColumnBase(Of ColumnMappingBase)("Id", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("Id", idColumnBase0)
            Dim principalBaseIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalBaseId", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("PrincipalBaseId", principalBaseIdColumnBase)
            Dim principalDerivedDependentBasebyteIdColumnBase As New ColumnBase(Of ColumnMappingBase)("PrincipalDerived<DependentBase<byte?>>Id", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.Columns.Add("PrincipalDerived<DependentBase<byte?>>Id", principalDerivedDependentBasebyteIdColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase As New TableMappingBase(Of ColumnMappingBase)(principalBase, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase, False)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase, False)
            defaultTableMappings0.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("PrincipalBaseId"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("PrincipalBaseId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseTableBase.FindColumn("PrincipalDerived<DependentBase<byte?>>Id"), ColumnBase(Of ColumnMappingBase)), principalBase.FindProperty("PrincipalDerivedId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalBaseMappingBase)

            Dim tableMappings0 As New List(Of TableMapping)()
            principalBase.SetRuntimeAnnotation("Relational:TableMappings", tableMappings0)
            Dim principalBaseTable As New Table("PrincipalBase", "TPC", relationalModel)
            Dim idColumn0 As New Column("Id", "bigint", principalBaseTable)
            principalBaseTable.Columns.Add("Id", idColumn0)
            Dim principalBaseIdColumn As New Column("PrincipalBaseId", "bigint", principalBaseTable) With {
                .IsNullable = True
            }
            principalBaseTable.Columns.Add("PrincipalBaseId", principalBaseIdColumn)
            Dim principalDerivedDependentBasebyteIdColumn As New Column("PrincipalDerived<DependentBase<byte?>>Id", "bigint", principalBaseTable) With {
                .IsNullable = True
            }
            principalBaseTable.Columns.Add("PrincipalDerived<DependentBase<byte?>>Id", principalDerivedDependentBasebyteIdColumn)
            Dim pK_PrincipalBase As New UniqueConstraint("PK_PrincipalBase", principalBaseTable, {idColumn0})
            principalBaseTable.PrimaryKey = pK_PrincipalBase
            Dim pK_PrincipalBaseUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id"})
            pK_PrincipalBase.MappedKeys.Add(pK_PrincipalBaseUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_PrincipalBaseUc).Add(pK_PrincipalBase)
            principalBaseTable.UniqueConstraints.Add("PK_PrincipalBase", pK_PrincipalBase)
            Dim iX_PrincipalBase_PrincipalDerivedDependentBasebyteId As New TableIndex(
            "IX_PrincipalBase_PrincipalDerived<DependentBase<byte?>>Id", principalBaseTable, {principalDerivedDependentBasebyteIdColumn}, False)
            Dim iX_PrincipalBase_PrincipalDerivedDependentBasebyteIdIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"PrincipalDerivedId"})
            iX_PrincipalBase_PrincipalDerivedDependentBasebyteId.MappedIndexes.Add(iX_PrincipalBase_PrincipalDerivedDependentBasebyteIdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_PrincipalBase_PrincipalDerivedDependentBasebyteIdIx).Add(iX_PrincipalBase_PrincipalDerivedDependentBasebyteId)
            principalBaseTable.Indexes.Add("IX_PrincipalBase_PrincipalDerived<DependentBase<byte?>>Id", iX_PrincipalBase_PrincipalDerivedDependentBasebyteId)
            Dim pIX As New TableIndex(
            "PIX", principalBaseTable, {principalBaseIdColumn}, True)
            Dim pIXIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                "PrincipalIndex")
            pIX.MappedIndexes.Add(pIXIx)
            RelationalModel.GetOrCreateTableIndexes(pIXIx).Add(pIX)
            principalBaseTable.Indexes.Add("PIX", pIX)
            relationalModel.Tables.Add(("PrincipalBase", "TPC"), principalBaseTable)
            Dim principalBaseTableMapping As New TableMapping(principalBase, principalBaseTable, False)
            principalBaseTable.AddEntityTypeMapping(principalBaseTableMapping, False)
            tableMappings0.Add(principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("Id"), principalBase.FindProperty("Id"), principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("PrincipalBaseId"), principalBase.FindProperty("PrincipalBaseId"), principalBaseTableMapping)
            RelationalModel.CreateColumnMapping(principalBaseTable.FindColumn("PrincipalDerived<DependentBase<byte?>>Id"), principalBase.FindProperty("PrincipalDerivedId"), principalBaseTableMapping)

            Dim viewMappings As New List(Of ViewMapping)()
            principalBase.SetRuntimeAnnotation("Relational:ViewMappings", viewMappings)
            Dim principalBaseViewView As New View("PrincipalBaseView", "TPC", relationalModel)
            Dim idViewColumn As New ViewColumn("Id", "bigint", principalBaseViewView)
            principalBaseViewView.Columns.Add("Id", idViewColumn)
            Dim principalBaseIdViewColumn As New ViewColumn("PrincipalBaseId", "bigint", principalBaseViewView) With {
                .IsNullable = True
            }
            principalBaseViewView.Columns.Add("PrincipalBaseId", principalBaseIdViewColumn)
            Dim principalDerivedIdViewColumn As New ViewColumn("PrincipalDerivedId", "bigint", principalBaseViewView) With {
                .IsNullable = True
            }
            principalBaseViewView.Columns.Add("PrincipalDerivedId", principalDerivedIdViewColumn)
            relationalModel.Views.Add(("PrincipalBaseView", "TPC"), principalBaseViewView)
            Dim principalBaseViewViewMapping As New ViewMapping(principalBase, principalBaseViewView, False)
            principalBaseViewView.AddEntityTypeMapping(principalBaseViewViewMapping, False)
            viewMappings.Add(principalBaseViewViewMapping)
            RelationalModel.CreateViewColumnMapping(principalBaseViewView.FindColumn("Id"), principalBase.FindProperty("Id"), principalBaseViewViewMapping)
            RelationalModel.CreateViewColumnMapping(principalBaseViewView.FindColumn("PrincipalBaseId"), principalBase.FindProperty("PrincipalBaseId"), principalBaseViewViewMapping)
            RelationalModel.CreateViewColumnMapping(principalBaseViewView.FindColumn("PrincipalDerivedId"), principalBase.FindProperty("PrincipalDerivedId"), principalBaseViewViewMapping)

            Dim deleteSprocMappings As New List(Of StoredProcedureMapping)()
            principalBase.SetRuntimeAnnotation("Relational:DeleteStoredProcedureMappings", deleteSprocMappings)
            Dim principalBase_DeleteStoreSproc As New StoreStoredProcedure("PrincipalBase_Delete", "TPC", relationalModel)
            principalBase_DeleteStoreSproc.ReturnValue = New StoreStoredProcedureReturnValue("", "int", principalBase_DeleteStoreSproc)
            Dim id_OriginalParameter As New StoreStoredProcedureParameter("Id_Original", "bigint", 0, principalBase_DeleteStoreSproc, System.Data.ParameterDirection.Input)
            principalBase_DeleteStoreSproc.AddParameter(id_OriginalParameter)
            principalBase_DeleteStoreSproc.AddStoredProcedure(DirectCast(principalBase.GetDeleteStoredProcedure(), IRuntimeStoredProcedure))
            relationalModel.StoredProcedures.Add(("PrincipalBase_Delete", "TPC"), principalBase_DeleteStoreSproc)
            Dim principalBase_DeleteDSproc = DirectCast(principalBase.GetDeleteStoredProcedure(), IRuntimeStoredProcedure)
            Dim principalBase_DeleteSprocMapping As New StoredProcedureMapping(principalBase, principalBase_DeleteStoreSproc, DirectCast(principalBase.GetDeleteStoredProcedure(), IRuntimeStoredProcedure), principalBaseTableMapping, False)
            principalBase_DeleteStoreSproc.AddEntityTypeMapping(principalBase_DeleteSprocMapping, False)
            deleteSprocMappings.Add(principalBase_DeleteSprocMapping)
            principalBaseTableMapping.DeleteStoredProcedureMapping = principalBase_DeleteSprocMapping
            RelationalModel.CreateStoredProcedureParameterMapping(id_OriginalParameter, principalBase_DeleteDSproc.FindParameter("Id_Original"), principalBase.FindProperty("Id"), principalBase_DeleteSprocMapping)

            Dim insertSprocMappings As New List(Of StoredProcedureMapping)()
            principalBase.SetRuntimeAnnotation("Relational:InsertStoredProcedureMappings", insertSprocMappings)
            Dim principalBase_InsertStoreSproc As New StoreStoredProcedure("PrincipalBase_Insert", "TPC", relationalModel)
            Dim principalBaseIdParameter As New StoreStoredProcedureParameter("PrincipalBaseId", "bigint", 0, principalBase_InsertStoreSproc, System.Data.ParameterDirection.Input) With {
                .IsNullable = True
            }
            principalBase_InsertStoreSproc.AddParameter(principalBaseIdParameter)
            Dim principalDerivedIdParameter As New StoreStoredProcedureParameter("PrincipalDerivedId", "bigint", 1, principalBase_InsertStoreSproc, System.Data.ParameterDirection.Input) With {
                .IsNullable = True
            }
            principalBase_InsertStoreSproc.AddParameter(principalDerivedIdParameter)
            Dim baseIdParameter As New StoreStoredProcedureParameter("BaseId", "bigint", 2, principalBase_InsertStoreSproc, System.Data.ParameterDirection.Output)
            principalBase_InsertStoreSproc.AddParameter(baseIdParameter)
            principalBase_InsertStoreSproc.AddStoredProcedure(DirectCast(principalBase.GetInsertStoredProcedure(), IRuntimeStoredProcedure))
            relationalModel.StoredProcedures.Add(("PrincipalBase_Insert", "TPC"), principalBase_InsertStoreSproc)
            Dim principalBase_InsertISproc = DirectCast(principalBase.GetInsertStoredProcedure(), IRuntimeStoredProcedure)
            Dim principalBase_InsertSprocMapping As New StoredProcedureMapping(principalBase, principalBase_InsertStoreSproc, DirectCast(principalBase.GetInsertStoredProcedure(), IRuntimeStoredProcedure), principalBaseTableMapping, False)
            principalBase_InsertStoreSproc.AddEntityTypeMapping(principalBase_InsertSprocMapping, False)
            insertSprocMappings.Add(principalBase_InsertSprocMapping)
            principalBaseTableMapping.InsertStoredProcedureMapping = principalBase_InsertSprocMapping
            RelationalModel.CreateStoredProcedureParameterMapping(baseIdParameter, principalBase_InsertISproc.FindParameter("BaseId"), principalBase.FindProperty("Id"), principalBase_InsertSprocMapping)
            RelationalModel.CreateStoredProcedureParameterMapping(principalBaseIdParameter, principalBase_InsertISproc.FindParameter("PrincipalBaseId"), principalBase.FindProperty("PrincipalBaseId"), principalBase_InsertSprocMapping)
            RelationalModel.CreateStoredProcedureParameterMapping(principalDerivedIdParameter, principalBase_InsertISproc.FindParameter("PrincipalDerivedId"), principalBase.FindProperty("PrincipalDerivedId"), principalBase_InsertSprocMapping)

            Dim updateSprocMappings As New List(Of StoredProcedureMapping)()
            principalBase.SetRuntimeAnnotation("Relational:UpdateStoredProcedureMappings", updateSprocMappings)
            Dim principalBase_UpdateStoreSproc As New StoreStoredProcedure("PrincipalBase_Update", "TPC", relationalModel)
            Dim principalBaseIdParameter0 As New StoreStoredProcedureParameter("PrincipalBaseId", "bigint", 0, principalBase_UpdateStoreSproc, System.Data.ParameterDirection.Input) With {
                .IsNullable = True
            }
            principalBase_UpdateStoreSproc.AddParameter(principalBaseIdParameter0)
            Dim principalDerivedIdParameter0 As New StoreStoredProcedureParameter("PrincipalDerivedId", "bigint", 1, principalBase_UpdateStoreSproc, System.Data.ParameterDirection.Input) With {
                .IsNullable = True
            }
            principalBase_UpdateStoreSproc.AddParameter(principalDerivedIdParameter0)
            Dim id_OriginalParameter0 As New StoreStoredProcedureParameter("Id_Original", "bigint", 2, principalBase_UpdateStoreSproc, System.Data.ParameterDirection.Input)
            principalBase_UpdateStoreSproc.AddParameter(id_OriginalParameter0)
            principalBase_UpdateStoreSproc.AddStoredProcedure(DirectCast(principalBase.GetUpdateStoredProcedure(), IRuntimeStoredProcedure))
            relationalModel.StoredProcedures.Add(("PrincipalBase_Update", "TPC"), principalBase_UpdateStoreSproc)
            Dim principalBase_UpdateUSproc = DirectCast(principalBase.GetUpdateStoredProcedure(), IRuntimeStoredProcedure)
            Dim principalBase_UpdateSprocMapping As New StoredProcedureMapping(principalBase, principalBase_UpdateStoreSproc, DirectCast(principalBase.GetUpdateStoredProcedure(), IRuntimeStoredProcedure), principalBaseTableMapping, False)
            principalBase_UpdateStoreSproc.AddEntityTypeMapping(principalBase_UpdateSprocMapping, False)
            updateSprocMappings.Add(principalBase_UpdateSprocMapping)
            principalBaseTableMapping.UpdateStoredProcedureMapping = principalBase_UpdateSprocMapping
            RelationalModel.CreateStoredProcedureParameterMapping(id_OriginalParameter0, principalBase_UpdateUSproc.FindParameter("Id_Original"), principalBase.FindProperty("Id"), principalBase_UpdateSprocMapping)
            RelationalModel.CreateStoredProcedureParameterMapping(principalBaseIdParameter0, principalBase_UpdateUSproc.FindParameter("PrincipalBaseId"), principalBase.FindProperty("PrincipalBaseId"), principalBase_UpdateSprocMapping)
            RelationalModel.CreateStoredProcedureParameterMapping(principalDerivedIdParameter0, principalBase_UpdateUSproc.FindParameter("PrincipalDerivedId"), principalBase.FindProperty("PrincipalDerivedId"), principalBase_UpdateSprocMapping)

            Dim principalDerived = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>")

            Dim defaultTableMappings1 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            principalDerived.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings1)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>", Nothing, relationalModel)
            Dim idColumnBase1 As New ColumnBase(Of ColumnMappingBase)("Id", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("Id", idColumnBase1)
            Dim principalBaseIdColumnBase0 As New ColumnBase(Of ColumnMappingBase)("PrincipalBaseId", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("PrincipalBaseId", principalBaseIdColumnBase0)
            Dim principalDerivedDependentBasebyteIdColumnBase0 As New ColumnBase(Of ColumnMappingBase)("PrincipalDerived<DependentBase<byte?>>Id", "bigint", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.Columns.Add("PrincipalDerived<DependentBase<byte?>>Id", principalDerivedDependentBasebyteIdColumnBase0)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase As New TableMappingBase(Of ColumnMappingBase)(principalDerived, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase, False)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase, False)
            defaultTableMappings1.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalBaseId"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("PrincipalBaseId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteTableBase.FindColumn("PrincipalDerived<DependentBase<byte?>>Id"), ColumnBase(Of ColumnMappingBase)), principalDerived.FindProperty("PrincipalDerivedId"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestPrincipalDerivedEntityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDependentBasebyteMappingBase)

            Dim tableMappings1 As New List(Of TableMapping)()
            principalDerived.SetRuntimeAnnotation("Relational:TableMappings", tableMappings1)
            Dim principalDerivedTable As New Table("PrincipalDerived", "TPC", relationalModel)
            Dim idColumn1 As New Column("Id", "bigint", principalDerivedTable)
            principalDerivedTable.Columns.Add("Id", idColumn1)
            Dim principalBaseIdColumn0 As New Column("PrincipalBaseId", "bigint", principalDerivedTable) With {
                .IsNullable = True
            }
            principalDerivedTable.Columns.Add("PrincipalBaseId", principalBaseIdColumn0)
            Dim principalDerivedDependentBasebyteIdColumn0 As New Column("PrincipalDerived<DependentBase<byte?>>Id", "bigint", principalDerivedTable) With {
                .IsNullable = True
            }
            principalDerivedTable.Columns.Add("PrincipalDerived<DependentBase<byte?>>Id", principalDerivedDependentBasebyteIdColumn0)
            Dim pK_PrincipalDerived As New UniqueConstraint("PK_PrincipalDerived", principalDerivedTable, {idColumn1})
            principalDerivedTable.PrimaryKey = pK_PrincipalDerived
            Dim pK_PrincipalDerivedUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"Id"})
            pK_PrincipalDerived.MappedKeys.Add(pK_PrincipalDerivedUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_PrincipalDerivedUc).Add(pK_PrincipalDerived)
            principalDerivedTable.UniqueConstraints.Add("PK_PrincipalDerived", pK_PrincipalDerived)
            Dim iX_PrincipalDerived_PrincipalDerivedDependentBasebyteId As New TableIndex(
            "IX_PrincipalDerived_PrincipalDerived<DependentBase<byte?>>Id", principalDerivedTable, {principalDerivedDependentBasebyteIdColumn0}, False)
            Dim iX_PrincipalDerived_PrincipalDerivedDependentBasebyteIdIx = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"PrincipalDerivedId"})
            iX_PrincipalDerived_PrincipalDerivedDependentBasebyteId.MappedIndexes.Add(iX_PrincipalDerived_PrincipalDerivedDependentBasebyteIdIx)
            RelationalModel.GetOrCreateTableIndexes(iX_PrincipalDerived_PrincipalDerivedDependentBasebyteIdIx).Add(iX_PrincipalDerived_PrincipalDerivedDependentBasebyteId)
            principalDerivedTable.Indexes.Add("IX_PrincipalDerived_PrincipalDerived<DependentBase<byte?>>Id", iX_PrincipalDerived_PrincipalDerivedDependentBasebyteId)
            Dim pIX0 As New TableIndex(
            "PIX", principalDerivedTable, {principalBaseIdColumn0}, True)
            Dim pIX0Ix = RelationalModel.GetIndex(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                "PrincipalIndex")
            pIX0.MappedIndexes.Add(pIX0Ix)
            RelationalModel.GetOrCreateTableIndexes(pIX0Ix).Add(pIX0)
            principalDerivedTable.Indexes.Add("PIX", pIX0)
            relationalModel.Tables.Add(("PrincipalDerived", "TPC"), principalDerivedTable)
            Dim principalDerivedTableMapping As New TableMapping(principalDerived, principalDerivedTable, False)
            principalDerivedTable.AddEntityTypeMapping(principalDerivedTableMapping, False)
            tableMappings1.Add(principalDerivedTableMapping)
            RelationalModel.CreateColumnMapping(principalDerivedTable.FindColumn("Id"), principalDerived.FindProperty("Id"), principalDerivedTableMapping)
            RelationalModel.CreateColumnMapping(principalDerivedTable.FindColumn("PrincipalBaseId"), principalDerived.FindProperty("PrincipalBaseId"), principalDerivedTableMapping)
            RelationalModel.CreateColumnMapping(principalDerivedTable.FindColumn("PrincipalDerived<DependentBase<byte?>>Id"), principalDerived.FindProperty("PrincipalDerivedId"), principalDerivedTableMapping)

            Dim viewMappings0 As New List(Of ViewMapping)()
            principalDerived.SetRuntimeAnnotation("Relational:ViewMappings", viewMappings0)
            Dim principalDerivedViewView As New View("PrincipalDerivedView", "TPC", relationalModel)
            Dim idViewColumn0 As New ViewColumn("Id", "bigint", principalDerivedViewView)
            principalDerivedViewView.Columns.Add("Id", idViewColumn0)
            Dim principalBaseIdViewColumn0 As New ViewColumn("PrincipalBaseId", "bigint", principalDerivedViewView) With {
                .IsNullable = True
            }
            principalDerivedViewView.Columns.Add("PrincipalBaseId", principalBaseIdViewColumn0)
            Dim principalDerivedIdViewColumn0 As New ViewColumn("PrincipalDerivedId", "bigint", principalDerivedViewView) With {
                .IsNullable = True
            }
            principalDerivedViewView.Columns.Add("PrincipalDerivedId", principalDerivedIdViewColumn0)
            relationalModel.Views.Add(("PrincipalDerivedView", "TPC"), principalDerivedViewView)
            Dim principalDerivedViewViewMapping As New ViewMapping(principalDerived, principalDerivedViewView, False)
            principalDerivedViewView.AddEntityTypeMapping(principalDerivedViewViewMapping, False)
            viewMappings0.Add(principalDerivedViewViewMapping)
            RelationalModel.CreateViewColumnMapping(principalDerivedViewView.FindColumn("Id"), principalDerived.FindProperty("Id"), principalDerivedViewViewMapping)
            RelationalModel.CreateViewColumnMapping(principalDerivedViewView.FindColumn("PrincipalBaseId"), principalDerived.FindProperty("PrincipalBaseId"), principalDerivedViewViewMapping)
            RelationalModel.CreateViewColumnMapping(principalDerivedViewView.FindColumn("PrincipalDerivedId"), principalDerived.FindProperty("PrincipalDerivedId"), principalDerivedViewViewMapping)

            Dim deleteSprocMappings0 As New List(Of StoredProcedureMapping)()
            principalDerived.SetRuntimeAnnotation("Relational:DeleteStoredProcedureMappings", deleteSprocMappings0)
            Dim derived_DeleteStoreSproc As New StoreStoredProcedure("Derived_Delete", "TPC", relationalModel)
            Dim id_OriginalParameter1 As New StoreStoredProcedureParameter("Id_Original", "bigint", 0, derived_DeleteStoreSproc, System.Data.ParameterDirection.Input)
            derived_DeleteStoreSproc.AddParameter(id_OriginalParameter1)
            derived_DeleteStoreSproc.AddStoredProcedure(DirectCast(principalDerived.GetDeleteStoredProcedure(), IRuntimeStoredProcedure))
            relationalModel.StoredProcedures.Add(("Derived_Delete", "TPC"), derived_DeleteStoreSproc)
            Dim derived_DeleteDSproc = DirectCast(principalDerived.GetDeleteStoredProcedure(), IRuntimeStoredProcedure)
            Dim derived_DeleteSprocMapping As New StoredProcedureMapping(principalDerived, derived_DeleteStoreSproc, DirectCast(principalDerived.GetDeleteStoredProcedure(), IRuntimeStoredProcedure), principalDerivedTableMapping, False)
            derived_DeleteStoreSproc.AddEntityTypeMapping(derived_DeleteSprocMapping, False)
            deleteSprocMappings0.Add(derived_DeleteSprocMapping)
            principalDerivedTableMapping.DeleteStoredProcedureMapping = derived_DeleteSprocMapping
            RelationalModel.CreateStoredProcedureParameterMapping(id_OriginalParameter1, derived_DeleteDSproc.FindParameter("Id_Original"), principalDerived.FindProperty("Id"), derived_DeleteSprocMapping)

            Dim insertSprocMappings0 As New List(Of StoredProcedureMapping)()
            principalDerived.SetRuntimeAnnotation("Relational:InsertStoredProcedureMappings", insertSprocMappings0)
            Dim derived_InsertStoreSproc As New StoreStoredProcedure("Derived_Insert", "TPC", relationalModel)
            Dim principalBaseIdParameter1 As New StoreStoredProcedureParameter("PrincipalBaseId", "bigint", 0, derived_InsertStoreSproc, System.Data.ParameterDirection.Input) With {
                .IsNullable = True
            }
            derived_InsertStoreSproc.AddParameter(principalBaseIdParameter1)
            Dim principalDerivedIdParameter1 As New StoreStoredProcedureParameter("PrincipalDerivedId", "bigint", 1, derived_InsertStoreSproc, System.Data.ParameterDirection.Input) With {
                .IsNullable = True
            }
            derived_InsertStoreSproc.AddParameter(principalDerivedIdParameter1)
            Dim derivedIdFunctionColumn As New StoreStoredProcedureResultColumn("DerivedId", "bigint", 0, derived_InsertStoreSproc)
            derived_InsertStoreSproc.AddResultColumn(derivedIdFunctionColumn)
            derived_InsertStoreSproc.AddStoredProcedure(DirectCast(principalDerived.GetInsertStoredProcedure(), IRuntimeStoredProcedure))
            relationalModel.StoredProcedures.Add(("Derived_Insert", "TPC"), derived_InsertStoreSproc)
            Dim derived_InsertISproc = DirectCast(principalDerived.GetInsertStoredProcedure(), IRuntimeStoredProcedure)
            Dim derived_InsertSprocMapping As New StoredProcedureMapping(principalDerived, derived_InsertStoreSproc, DirectCast(principalDerived.GetInsertStoredProcedure(), IRuntimeStoredProcedure), principalDerivedTableMapping, False)
            derived_InsertStoreSproc.AddEntityTypeMapping(derived_InsertSprocMapping, False)
            insertSprocMappings0.Add(derived_InsertSprocMapping)
            principalDerivedTableMapping.InsertStoredProcedureMapping = derived_InsertSprocMapping
            RelationalModel.CreateStoredProcedureParameterMapping(principalBaseIdParameter1, derived_InsertISproc.FindParameter("PrincipalBaseId"), principalDerived.FindProperty("PrincipalBaseId"), derived_InsertSprocMapping)
            RelationalModel.CreateStoredProcedureParameterMapping(principalDerivedIdParameter1, derived_InsertISproc.FindParameter("PrincipalDerivedId"), principalDerived.FindProperty("PrincipalDerivedId"), derived_InsertSprocMapping)
            RelationalModel.CreateStoredProcedureResultColumnMapping(derivedIdFunctionColumn, derived_InsertISproc.FindResultColumn("DerivedId"), principalDerived.FindProperty("Id"), derived_InsertSprocMapping)

            Dim updateSprocMappings0 As New List(Of StoredProcedureMapping)()
            principalDerived.SetRuntimeAnnotation("Relational:UpdateStoredProcedureMappings", updateSprocMappings0)
            Dim derived_UpdateStoreSproc As New StoreStoredProcedure("Derived_Update", "Derived", relationalModel)
            Dim principalBaseIdParameter2 As New StoreStoredProcedureParameter("PrincipalBaseId", "bigint", 0, derived_UpdateStoreSproc, System.Data.ParameterDirection.Input) With {
                .IsNullable = True
            }
            derived_UpdateStoreSproc.AddParameter(principalBaseIdParameter2)
            Dim principalDerivedIdParameter2 As New StoreStoredProcedureParameter("PrincipalDerivedId", "bigint", 1, derived_UpdateStoreSproc, System.Data.ParameterDirection.Input) With {
                .IsNullable = True
            }
            derived_UpdateStoreSproc.AddParameter(principalDerivedIdParameter2)
            Dim id_OriginalParameter2 As New StoreStoredProcedureParameter("Id_Original", "bigint", 2, derived_UpdateStoreSproc, System.Data.ParameterDirection.Input)
            derived_UpdateStoreSproc.AddParameter(id_OriginalParameter2)
            derived_UpdateStoreSproc.AddStoredProcedure(DirectCast(principalDerived.GetUpdateStoredProcedure(), IRuntimeStoredProcedure))
            relationalModel.StoredProcedures.Add(("Derived_Update", "Derived"), derived_UpdateStoreSproc)
            Dim derived_UpdateUSproc = DirectCast(principalDerived.GetUpdateStoredProcedure(), IRuntimeStoredProcedure)
            Dim derived_UpdateSprocMapping As New StoredProcedureMapping(principalDerived, derived_UpdateStoreSproc, DirectCast(principalDerived.GetUpdateStoredProcedure(), IRuntimeStoredProcedure), principalDerivedTableMapping, False)
            derived_UpdateStoreSproc.AddEntityTypeMapping(derived_UpdateSprocMapping, False)
            updateSprocMappings0.Add(derived_UpdateSprocMapping)
            principalDerivedTableMapping.UpdateStoredProcedureMapping = derived_UpdateSprocMapping
            RelationalModel.CreateStoredProcedureParameterMapping(id_OriginalParameter2, derived_UpdateUSproc.FindParameter("Id_Original"), principalDerived.FindProperty("Id"), derived_UpdateSprocMapping)
            RelationalModel.CreateStoredProcedureParameterMapping(principalBaseIdParameter2, derived_UpdateUSproc.FindParameter("PrincipalBaseId"), principalDerived.FindProperty("PrincipalBaseId"), derived_UpdateSprocMapping)
            RelationalModel.CreateStoredProcedureParameterMapping(principalDerivedIdParameter2, derived_UpdateUSproc.FindParameter("PrincipalDerivedId"), principalDerived.FindProperty("PrincipalDerivedId"), derived_UpdateSprocMapping)
            Dim fK_DependentBasebyte_PrincipalDerived_PrincipalId As New ForeignKeyConstraint(
                "FK_DependentBase<byte?>_PrincipalDerived_PrincipalId", dependentBasebyteTable, principalDerivedTable,
                {principalIdColumn},
                principalDerivedTable.FindUniqueConstraint("PK_PrincipalDerived"), ReferentialAction.NoAction)
            Dim fK_DependentBasebyte_PrincipalDerived_PrincipalIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                {"PrincipalId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id"})
            fK_DependentBasebyte_PrincipalDerived_PrincipalId.MappedForeignKeys.Add(fK_DependentBasebyte_PrincipalDerived_PrincipalIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_DependentBasebyte_PrincipalDerived_PrincipalIdFk).Add(fK_DependentBasebyte_PrincipalDerived_PrincipalId)
            dependentBasebyteTable.ForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalDerived_PrincipalId)
            principalDerivedTable.ReferencingForeignKeyConstraints.Add(fK_DependentBasebyte_PrincipalDerived_PrincipalId)
            Dim fK_PrincipalBase_PrincipalDerived_PrincipalDerivedDependentBasebyteId As New ForeignKeyConstraint(
                "FK_PrincipalBase_PrincipalDerived_PrincipalDerived<DependentBase<byte?>>Id", principalBaseTable, principalDerivedTable,
                {principalDerivedDependentBasebyteIdColumn},
                principalDerivedTable.FindUniqueConstraint("PK_PrincipalDerived"), ReferentialAction.NoAction)
            Dim fK_PrincipalBase_PrincipalDerived_PrincipalDerivedDependentBasebyteIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"PrincipalDerivedId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id"})
            fK_PrincipalBase_PrincipalDerived_PrincipalDerivedDependentBasebyteId.MappedForeignKeys.Add(fK_PrincipalBase_PrincipalDerived_PrincipalDerivedDependentBasebyteIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_PrincipalBase_PrincipalDerived_PrincipalDerivedDependentBasebyteIdFk).Add(fK_PrincipalBase_PrincipalDerived_PrincipalDerivedDependentBasebyteId)
            principalBaseTable.ForeignKeyConstraints.Add(fK_PrincipalBase_PrincipalDerived_PrincipalDerivedDependentBasebyteId)
            principalDerivedTable.ReferencingForeignKeyConstraints.Add(fK_PrincipalBase_PrincipalDerived_PrincipalDerivedDependentBasebyteId)
            Dim fK_PrincipalDerived_PrincipalDerived_PrincipalDerivedDependentBasebyteId As New ForeignKeyConstraint(
                "FK_PrincipalDerived_PrincipalDerived_PrincipalDerived<DependentBase<byte?>>Id", principalDerivedTable, principalDerivedTable,
                {principalDerivedDependentBasebyteIdColumn0},
                principalDerivedTable.FindUniqueConstraint("PK_PrincipalDerived"), ReferentialAction.NoAction)
            Dim fK_PrincipalDerived_PrincipalDerived_PrincipalDerivedDependentBasebyteIdFk = RelationalModel.GetForeignKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                {"PrincipalDerivedId"},
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                {"Id"})
            fK_PrincipalDerived_PrincipalDerived_PrincipalDerivedDependentBasebyteId.MappedForeignKeys.Add(fK_PrincipalDerived_PrincipalDerived_PrincipalDerivedDependentBasebyteIdFk)
            RelationalModel.GetOrCreateForeignKeyConstraints(fK_PrincipalDerived_PrincipalDerived_PrincipalDerivedDependentBasebyteIdFk).Add(fK_PrincipalDerived_PrincipalDerived_PrincipalDerivedDependentBasebyteId)
            principalDerivedTable.ForeignKeyConstraints.Add(fK_PrincipalDerived_PrincipalDerived_PrincipalDerivedDependentBasebyteId)
            principalDerivedTable.ReferencingForeignKeyConstraints.Add(fK_PrincipalDerived_PrincipalDerived_PrincipalDerivedDependentBasebyteId)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value

            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class DependentBaseEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Byte?),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetProperty("Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetField("_Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalId = entityType.AddProperty(
                "PrincipalId",
                GetType(Long?),
                nullable:=True)
            principalId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Dim index = entityType.AddIndex(
                {principalId},
                unique:=True)

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id")}),
                principalEntityType,
                deleteBehavior:=DeleteBehavior.ClientCascade,
                unique:=True,
                requiredDependent:=True)

            Dim principal = declaringEntityType.AddNavigation("Principal",
                runtimeForeignKey,
                onDependent:=True,
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetProperty("Principal", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)).GetField("_Principal", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Dim dependent = principalEntityType.AddNavigation("Dependent",
                runtimeForeignKey,
                onDependent:=False,
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetProperty("Dependent", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetField("_Dependent", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", "TPC")
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "DependentBase<byte?>")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class PrincipalBaseEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalBase",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase),
                baseEntityType,
                discriminatorValue:="PrincipalBase")

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Long?),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetProperty("Id", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("_Id", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)

            Dim [overrides] As New StoreObjectDictionary(Of RuntimeRelationalPropertyOverrides)()
            Dim idDerived_Insert As New RuntimeRelationalPropertyOverrides(
                id,
                StoreObjectIdentifier.InsertStoredProcedure("Derived_Insert", "TPC"),
                True,
                "DerivedId")
            [overrides].GetType().GetMethod("Add").Invoke([overrides], {StoreObjectIdentifier.InsertStoredProcedure("Derived_Insert", "TPC"), idDerived_Insert})
            Dim idPrincipalBaseView As New RuntimeRelationalPropertyOverrides(
                id,
                StoreObjectIdentifier.View("PrincipalBaseView", "TPC"),
                False,
                Nothing)
            idPrincipalBaseView.AddAnnotation("foo", "bar2")
            [overrides].GetType().GetMethod("Add").Invoke([overrides], {StoreObjectIdentifier.View("PrincipalBaseView", "TPC"), idPrincipalBaseView})
            id.AddAnnotation("Relational:RelationalOverrides", [overrides])

            id.AddAnnotation("Relational:DefaultValueSql", "NEXT VALUE FOR [TPC].[PrincipalBaseSequence]")
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.Sequence)

            Dim principalBaseId = entityType.AddProperty(
                "PrincipalBaseId",
                GetType(Long?),
                nullable:=True)
            principalBaseId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim principalDerivedId = entityType.AddProperty(
                "PrincipalDerivedId",
                GetType(Long?),
                nullable:=True)
            principalDerivedId.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Dim index = entityType.AddIndex(
                {principalDerivedId})

            Dim principalIndex = entityType.AddIndex(
                {principalBaseId},
                name:="PrincipalIndex",
                unique:=True)
            principalIndex.AddAnnotation("Relational:Name", "PIX")

            Return entityType
        End Function

        Public Shared Function CreateForeignKey1(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalBaseId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id")}),
                principalEntityType)

            Dim deriveds = principalEntityType.AddNavigation("Deriveds",
                runtimeForeignKey,
                onDependent:=False,
                GetType(ICollection(Of VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetProperty("Deriveds", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase).GetField("_Deriveds", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Return runtimeForeignKey
        End Function

        Public Shared Function CreateForeignKey2(declaringEntityType As RuntimeEntityType, principalEntityType As RuntimeEntityType) As RuntimeForeignKey
            Dim runtimeForeignKey = declaringEntityType.AddForeignKey({declaringEntityType.FindProperty("PrincipalDerivedId")},
                principalEntityType.FindKey({principalEntityType.FindProperty("Id")}),
                principalEntityType)

            Dim principals = principalEntityType.AddNavigation("Principals",
                runtimeForeignKey,
                onDependent:=False,
                GetType(ICollection(Of VisualBasicRuntimeModelCodeGeneratorTest.PrincipalBase)),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetProperty("Principals", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))).GetField("_Principals", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly))

            Return runtimeForeignKey
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            Dim insertSproc As New RuntimeStoredProcedure(
                entityType,
                "PrincipalBase_Insert",
                "TPC",
                False)

            Dim principalBaseId = insertSproc.AddParameter(
                "PrincipalBaseId", System.Data.ParameterDirection.Input, False, "PrincipalBaseId", False)
            Dim principalDerivedId = insertSproc.AddParameter(
                "PrincipalDerivedId", System.Data.ParameterDirection.Input, False, "PrincipalDerivedId", False)
            Dim id = insertSproc.AddParameter(
                "BaseId", System.Data.ParameterDirection.Output, False, "Id", False)
            id.AddAnnotation("foo", "bar")
            insertSproc.AddAnnotation("foo", "bar1")
            entityType.AddAnnotation("Relational:InsertStoredProcedure", insertSproc)

            Dim deleteSproc As New RuntimeStoredProcedure(
                entityType,
                "PrincipalBase_Delete",
                "TPC",
                True)

            Dim id0 = deleteSproc.AddParameter(
                "Id_Original", System.Data.ParameterDirection.Input, False, "Id", True)
            entityType.AddAnnotation("Relational:DeleteStoredProcedure", deleteSproc)

            Dim updateSproc As New RuntimeStoredProcedure(
                entityType,
                "PrincipalBase_Update",
                "TPC",
                False)

            Dim principalBaseId0 = updateSproc.AddParameter(
                "PrincipalBaseId", System.Data.ParameterDirection.Input, False, "PrincipalBaseId", False)
            Dim principalDerivedId0 = updateSproc.AddParameter(
                "PrincipalDerivedId", System.Data.ParameterDirection.Input, False, "PrincipalDerivedId", False)
            Dim id1 = updateSproc.AddParameter(
                "Id_Original", System.Data.ParameterDirection.Input, False, "Id", True)
            entityType.AddAnnotation("Relational:UpdateStoredProcedure", updateSproc)

            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:MappingStrategy", "TPC")
            entityType.AddAnnotation("Relational:Schema", "TPC")
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalBase")
            entityType.AddAnnotation("Relational:ViewDefinitionSql", Nothing)
            entityType.AddAnnotation("Relational:ViewName", "PrincipalBaseView")
            entityType.AddAnnotation("Relational:ViewSchema", "TPC")

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Dim e3 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class PrincipalDerivedEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+PrincipalDerived<EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DependentBase<byte?>>",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.PrincipalDerived(Of VisualBasicRuntimeModelCodeGeneratorTest.DependentBase(Of Byte?))),
                baseEntityType,
                discriminatorValue:="PrincipalDerived<DependentBase<byte?>>")

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            Dim insertSproc As New RuntimeStoredProcedure(
                entityType,
                "Derived_Insert",
                "TPC",
                False)

            Dim principalBaseId = insertSproc.AddParameter(
                "PrincipalBaseId", System.Data.ParameterDirection.Input, False, "PrincipalBaseId", False)
            Dim principalDerivedId = insertSproc.AddParameter(
                "PrincipalDerivedId", System.Data.ParameterDirection.Input, False, "PrincipalDerivedId", False)
            Dim derivedId = insertSproc.AddResultColumn(
                "DerivedId", False, "Id")
            derivedId.AddAnnotation("foo", "bar3")
            entityType.AddAnnotation("Relational:InsertStoredProcedure", insertSproc)

            Dim deleteSproc As New RuntimeStoredProcedure(
                entityType,
                "Derived_Delete",
                "TPC",
                False)

            Dim id = deleteSproc.AddParameter(
                "Id_Original", System.Data.ParameterDirection.Input, False, "Id", True)
            entityType.AddAnnotation("Relational:DeleteStoredProcedure", deleteSproc)

            Dim updateSproc As New RuntimeStoredProcedure(
                entityType,
                "Derived_Update",
                "Derived",
                False)

            Dim principalBaseId0 = updateSproc.AddParameter(
                "PrincipalBaseId", System.Data.ParameterDirection.Input, False, "PrincipalBaseId", False)
            Dim principalDerivedId0 = updateSproc.AddParameter(
                "PrincipalDerivedId", System.Data.ParameterDirection.Input, False, "PrincipalDerivedId", False)
            Dim id0 = updateSproc.AddParameter(
                "Id_Original", System.Data.ParameterDirection.Input, False, "Id", True)
            entityType.AddAnnotation("Relational:UpdateStoredProcedure", updateSproc)

            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", "TPC")
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "PrincipalDerived")
            entityType.AddAnnotation("Relational:ViewDefinitionSql", Nothing)
            entityType.AddAnnotation("Relational:ViewName", "PrincipalDerivedView")
            entityType.AddAnnotation("Relational:ViewSchema", "TPC")

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New TpcContext(),
                CreateCompiledModelCodeGenerationOptions(),
                Sub(code)
                    Assert.Collection(
                        code,
                        Sub(c) AssertFileContents("TpcContextModel.vb", rm1, c),
                        Sub(c) AssertFileContents("TpcContextModelBuilder.vb", rm2, c),
                        Sub(c) AssertFileContents("DependentBaseEntityType.vb", e1, c),
                        Sub(c) AssertFileContents("PrincipalBaseEntityType.vb", e2, c),
                        Sub(c) AssertFileContents("PrincipalDerivedEntityType.vb", e3, c))
                End Sub,
                Sub(Model)
                    Assert.Equal("TPC", Model.GetDefaultSchema())
                    Assert.Null(Model(SqlServerAnnotationNames.MaxDatabaseSize))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() Model.GetDatabaseMaxSize()).Message)
                    Assert.Null(Model(SqlServerAnnotationNames.PerformanceLevelSql))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() Model.GetPerformanceLevelSql()).Message)
                    Assert.Null(Model(SqlServerAnnotationNames.ServiceTierSql))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() Model.GetServiceTierSql()).Message)

                    Dim PrincipalBase = Model.FindEntityType(GetType(PrincipalBase))
                    Dim id = PrincipalBase.FindProperty("Id")

                    Assert.Equal("Id", id.GetColumnName())
                    Assert.Equal("PrincipalBase", PrincipalBase.GetTableName())
                    Assert.Equal("TPC", PrincipalBase.GetSchema())
                    Assert.Equal("Id", id.GetColumnName(StoreObjectIdentifier.Create(PrincipalBase, StoreObjectType.Table).Value))
                    Assert.Null(id.FindOverrides(StoreObjectIdentifier.Create(PrincipalBase, StoreObjectType.Table).Value))

                    Assert.Equal("PrincipalBaseView", PrincipalBase.GetViewName())
                    Assert.Equal("TPC", PrincipalBase.GetViewSchema())
                    Assert.Equal("Id", id.GetColumnName(StoreObjectIdentifier.Create(PrincipalBase, StoreObjectType.View).Value))
                    Assert.Equal(
                        "bar2",
                        id.FindOverrides(StoreObjectIdentifier.Create(PrincipalBase, StoreObjectType.View).Value)("foo"))

                    Dim principalBaseId = PrincipalBase.FindProperty("PrincipalBaseId")

                    Dim alternateIndex = PrincipalBase.GetIndexes().Last()
                    Assert.Same(principalBaseId, alternateIndex.Properties.Single())
                    Assert.True(alternateIndex.IsUnique)
                    Assert.Equal("PrincipalIndex", alternateIndex.Name)
                    Assert.Equal("PIX", alternateIndex.GetDatabaseName())
                    Assert.Null(alternateIndex(RelationalAnnotationNames.Filter))
                    Assert.Null(alternateIndex.GetFilter())
                    Assert.Null(alternateIndex(SqlServerAnnotationNames.Clustered))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() alternateIndex.IsClustered()).Message)
                    Assert.Null(alternateIndex(SqlServerAnnotationNames.CreatedOnline))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() alternateIndex.IsCreatedOnline()).Message)
                    Assert.Null(alternateIndex(SqlServerAnnotationNames.FillFactor))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() alternateIndex.GetFillFactor()).Message)
                    Assert.Null(alternateIndex(SqlServerAnnotationNames.Include))
                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Function() alternateIndex.GetIncludeProperties()).Message)

                    Assert.Equal({alternateIndex}, principalBaseId.GetContainingIndexes())

                    Dim insertSproc = PrincipalBase.GetInsertStoredProcedure()
                    Assert.Equal("PrincipalBase_Insert", insertSproc.Name)
                    Assert.Equal("TPC", insertSproc.Schema)
                    Assert.Equal(
                        {"PrincipalBaseId", "PrincipalDerivedId", "Id"}, insertSproc.Parameters.Select(Function(p) p.PropertyName))
                    Assert.Empty(insertSproc.ResultColumns)
                    Assert.False(insertSproc.IsRowsAffectedReturned)
                    Assert.Equal("bar1", insertSproc("foo"))
                    Assert.Same(PrincipalBase, insertSproc.EntityType)
                    Assert.Equal("BaseId", insertSproc.Parameters.Last().Name)
                    Assert.Equal("bar", insertSproc.Parameters.Last()("foo"))
                    Assert.Null(id.FindOverrides(StoreObjectIdentifier.Create(PrincipalBase, StoreObjectType.InsertStoredProcedure).Value))

                    Dim updateSproc = PrincipalBase.GetUpdateStoredProcedure()
                    Assert.Equal("PrincipalBase_Update", updateSproc.Name)
                    Assert.Equal("TPC", updateSproc.Schema)
                    Assert.Equal(
                        {"PrincipalBaseId", "PrincipalDerivedId", "Id"}, updateSproc.Parameters.Select(Function(p) p.PropertyName))
                    Assert.Empty(updateSproc.ResultColumns)
                    Assert.False(updateSproc.IsRowsAffectedReturned)
                    Assert.Empty(updateSproc.GetAnnotations())
                    Assert.Same(PrincipalBase, updateSproc.EntityType)
                    Assert.Equal("Id_Original", updateSproc.Parameters.Last().Name)
                    Assert.Null(id.FindOverrides(StoreObjectIdentifier.Create(PrincipalBase, StoreObjectType.UpdateStoredProcedure).Value))

                    Dim deleteSproc = PrincipalBase.GetDeleteStoredProcedure()
                    Assert.Equal("PrincipalBase_Delete", deleteSproc.Name)
                    Assert.Equal("TPC", deleteSproc.Schema)
                    Assert.Equal({"Id_Original"}, deleteSproc.Parameters.Select(Function(p) p.Name))
                    Assert.Empty(deleteSproc.ResultColumns)
                    Assert.True(deleteSproc.IsRowsAffectedReturned)
                    Assert.Same(PrincipalBase, deleteSproc.EntityType)
                    Assert.Equal("Id_Original", deleteSproc.Parameters.Last().Name)
                    Assert.Null(id.FindOverrides(StoreObjectIdentifier.Create(PrincipalBase, StoreObjectType.DeleteStoredProcedure).Value))

                    Assert.Equal("PrincipalBase", PrincipalBase.GetDiscriminatorValue())
                    Assert.Null(PrincipalBase.FindDiscriminatorProperty())
                    Assert.Equal("TPC", PrincipalBase.GetMappingStrategy())

                    Dim selfRefNavigation = PrincipalBase.GetDeclaredNavigations().Last()
                    Assert.Equal("Deriveds", selfRefNavigation.Name)
                    Assert.True(selfRefNavigation.IsCollection)
                    Assert.False(selfRefNavigation.IsOnDependent)
                    Assert.Equal(PrincipalBase, selfRefNavigation.TargetEntityType)
                    Assert.Null(selfRefNavigation.Inverse)

                    Dim PrincipalDerived = Model.FindEntityType(GetType(PrincipalDerived(Of DependentBase(Of Byte?))))
                    Assert.Equal(PrincipalBase, PrincipalDerived.BaseType)

                    Assert.Equal("PrincipalDerived", PrincipalDerived.GetTableName())
                    Assert.Equal("TPC", PrincipalDerived.GetSchema())
                    Assert.Equal("PrincipalDerivedView", PrincipalDerived.GetViewName())
                    Assert.Equal("TPC", PrincipalBase.GetViewSchema())

                    insertSproc = PrincipalDerived.GetInsertStoredProcedure()
                    Assert.Equal("Derived_Insert", insertSproc.Name)
                    Assert.Equal("TPC", insertSproc.Schema)
                    Assert.Equal({"PrincipalBaseId", "PrincipalDerivedId"}, insertSproc.Parameters.Select(Function(p) p.PropertyName))
                    Assert.Equal({"Id"}, insertSproc.ResultColumns.Select(Function(p) p.PropertyName))
                    Assert.Null(insertSproc("foo"))
                    Assert.Same(PrincipalDerived, insertSproc.EntityType)
                    Assert.Equal("DerivedId", insertSproc.ResultColumns.Last().Name)
                    Assert.Equal(
                        "DerivedId",
                        id.GetColumnName(StoreObjectIdentifier.Create(PrincipalDerived, StoreObjectType.InsertStoredProcedure).Value))
                    Assert.Equal("bar3", insertSproc.ResultColumns.Last()("foo"))
                    Assert.Null(
                        id.FindOverrides(
                            StoreObjectIdentifier.Create(PrincipalDerived, StoreObjectType.InsertStoredProcedure).Value)("foo"))

                    updateSproc = PrincipalDerived.GetUpdateStoredProcedure()
                    Assert.Equal("Derived_Update", updateSproc.Name)
                    Assert.Equal("Derived", updateSproc.Schema)
                    Assert.Equal(
                        {"PrincipalBaseId", "PrincipalDerivedId", "Id"}, updateSproc.Parameters.Select(Function(p) p.PropertyName))
                    Assert.Empty(updateSproc.ResultColumns)
                    Assert.Empty(updateSproc.GetAnnotations())
                    Assert.Same(PrincipalDerived, updateSproc.EntityType)
                    Assert.Equal("Id_Original", updateSproc.Parameters.Last().Name)
                    Assert.Null(
                        id.FindOverrides(StoreObjectIdentifier.Create(PrincipalDerived, StoreObjectType.UpdateStoredProcedure).Value))

                    deleteSproc = PrincipalDerived.GetDeleteStoredProcedure()
                    Assert.Equal("Derived_Delete", deleteSproc.Name)
                    Assert.Equal("TPC", deleteSproc.Schema)
                    Assert.Equal({"Id"}, deleteSproc.Parameters.Select(Function(p) p.PropertyName))
                    Assert.Empty(deleteSproc.ResultColumns)
                    Assert.Same(PrincipalDerived, deleteSproc.EntityType)
                    Assert.Equal("Id_Original", deleteSproc.Parameters.Last().Name)
                    Assert.Null(
                        id.FindOverrides(StoreObjectIdentifier.Create(PrincipalDerived, StoreObjectType.DeleteStoredProcedure).Value))

                    Assert.Equal("PrincipalDerived<DependentBase<byte?>>", PrincipalDerived.GetDiscriminatorValue())
                    Assert.Null(PrincipalDerived.FindDiscriminatorProperty())
                    Assert.Equal("TPC", PrincipalDerived.GetMappingStrategy())

                    Assert.Equal(2, PrincipalDerived.GetDeclaredNavigations().Count())
                    Dim derivedNavigation = PrincipalDerived.GetDeclaredNavigations().Last()
                    Assert.Equal("Principals", derivedNavigation.Name)
                    Assert.True(derivedNavigation.IsCollection)
                    Assert.False(derivedNavigation.IsOnDependent)
                    Assert.Equal(PrincipalBase, derivedNavigation.TargetEntityType)
                    Assert.Null(derivedNavigation.Inverse)

                    Dim dependentNavigation = PrincipalDerived.GetDeclaredNavigations().First()
                    Assert.Equal("Dependent", dependentNavigation.Name)
                    Assert.Equal("Dependent", dependentNavigation.PropertyInfo.Name)
                    Assert.Equal("_Dependent", dependentNavigation.FieldInfo.Name)
                    Assert.False(dependentNavigation.IsCollection)
                    Assert.False(dependentNavigation.IsEagerLoaded)
                    Assert.True(dependentNavigation.LazyLoadingEnabled)
                    Assert.False(dependentNavigation.IsOnDependent)
                    Assert.Equal(PrincipalDerived, dependentNavigation.DeclaringEntityType)
                    Assert.Equal("Principal", dependentNavigation.Inverse.Name)

                    Dim dependentForeignKey = dependentNavigation.ForeignKey
                    Assert.False(dependentForeignKey.IsOwnership)
                    Assert.False(dependentForeignKey.IsRequired)
                    Assert.True(dependentForeignKey.IsRequiredDependent)
                    Assert.True(dependentForeignKey.IsUnique)
                    Assert.Same(PrincipalDerived, dependentForeignKey.PrincipalEntityType)
                    Assert.Same(dependentNavigation.Inverse, dependentForeignKey.DependentToPrincipal)
                    Assert.Same(dependentNavigation, dependentForeignKey.PrincipalToDependent)
                    Assert.Equal(DeleteBehavior.ClientCascade, dependentForeignKey.DeleteBehavior)
                    Assert.Equal({"PrincipalId"}, dependentForeignKey.Properties.Select(Function(p) p.Name))

                    Dim DependentBase = dependentNavigation.TargetEntityType

                    Assert.True(DependentBase.GetIsDiscriminatorMappingComplete())
                    Assert.Null(DependentBase.FindDiscriminatorProperty())

                    Assert.Same(dependentForeignKey, DependentBase.GetForeignKeys().Single())

                    Assert.Equal(
                        {
                            DependentBase,
                            PrincipalBase,
                            PrincipalDerived
                        },
                        Model.GetEntityTypes())

                    Dim principalBaseSequence = Model.FindSequence("PrincipalBaseSequence")
                    Assert.Equal("TPC", principalBaseSequence.Schema)
                End Sub,
                GetType(SqlServerNetTopologySuiteDesignTimeServices))
        End Sub

        Public Class TpcContext
            Inherits SqlServerContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.HasDefaultSchema("TPC").
                    HasDatabaseMaxSize("20TB").
                    HasPerformanceLevel("High").
                    HasServiceTier("AB")

                modelBuilder.Entity(Of PrincipalBase)(
                    Sub(eb)
                        eb.Ignore(Function(e) e.Owned)

                        eb.UseTpcMappingStrategy()

                        eb.ToTable("PrincipalBase")
                        eb.ToView("PrincipalBaseView", Sub(tb) tb.Property(Function(e) e.Id).HasAnnotation("foo", "bar2"))

                        eb.InsertUsingStoredProcedure(Sub(s) s.
                            HasParameter("PrincipalBaseId").
                            HasParameter("PrincipalDerivedId").
                            HasParameter(Function(p) p.Id, Function(pb) pb.HasName("BaseId").IsOutput().HasAnnotation("foo", "bar")).
                            HasAnnotation("foo", "bar1"))
                        eb.UpdateUsingStoredProcedure(Sub(s) s.
                            HasParameter("PrincipalBaseId").
                            HasParameter("PrincipalDerivedId").
                            HasOriginalValueParameter(Function(p) p.Id))
                        eb.DeleteUsingStoredProcedure(Sub(s) s.
                            HasRowsAffectedReturnValue().
                            HasOriginalValueParameter(Function(p) p.Id))

                        eb.HasIndex({"PrincipalBaseId"}, "PrincipalIndex").
                            IsUnique().
                            HasDatabaseName("PIX").
                            IsClustered().
                            HasFilter("AlternateId <> NULL").
                            IsCreatedOnline().
                            HasFillFactor(40).
                            IncludeProperties(Function(e) e.Id)
                    End Sub)

                modelBuilder.Entity(Of PrincipalDerived(Of DependentBase(Of Byte?)))(
                    Sub(eb)
                        eb.HasOne(Function(e) e.Dependent).WithOne(Function(e) e.Principal).
                            HasForeignKey(Of DependentBase(Of Byte?))().
                            OnDelete(DeleteBehavior.ClientCascade)

                        eb.Navigation(Function(e) e.Dependent).IsRequired()

                        eb.ToTable("PrincipalDerived")
                        eb.ToView("PrincipalDerivedView")

                        eb.InsertUsingStoredProcedure("Derived_Insert", Sub(s) s.
                            HasParameter("PrincipalBaseId").
                            HasParameter("PrincipalDerivedId").
                            HasResultColumn(Function(p) p.Id, Function(pb) pb.HasName("DerivedId").HasAnnotation("foo", "bar3")))
                        eb.UpdateUsingStoredProcedure("Derived_Update", "Derived", Sub(s) s.
                            HasParameter("PrincipalBaseId").
                            HasParameter("PrincipalDerivedId").
                            HasOriginalValueParameter(Function(p) p.Id))
                        eb.DeleteUsingStoredProcedure("Derived_Delete", Sub(s) s.
                            HasOriginalValueParameter(Function(p) p.Id))
                    End Sub)

                modelBuilder.Entity(Of DependentBase(Of Byte?))(
                    Sub(eb)
                        eb.Property(Of Byte?)("Id")
                    End Sub)
            End Sub
        End Class

        Public Class CustomValueComparer(Of T)
            Inherits ValueComparer(Of T)

            Public Sub New()
                MyBase.New(False)
            End Sub
        End Class

        Public MustInherit Class AbstractBase
            Public Property Id As Integer
        End Class

        Public Class PrincipalBase
            Inherits AbstractBase

            Public Shadows Property Id As Long?
            Public AlternateId As Guid

            Private _ownedField As OwnedType
            Public Property Owned As OwnedType
                Get
                    Return _ownedField
                End Get
                Set
                    _ownedField = Value
                End Set
            End Property

            Public Property Deriveds As ICollection(Of PrincipalBase)
        End Class

        Public Class PrincipalDerived(Of TDependent)
            Inherits PrincipalBase

            Public Property Dependent As TDependent
            Protected ManyOwned As ICollection(Of OwnedType)
            Public Property Principals As ICollection(Of PrincipalBase)
        End Class

        Public Class DependentBase(Of TKey)
            Inherits AbstractBase

            Public Sub New(id As TKey)
                id = id
            End Sub

            Private Shadows ReadOnly Property Id As TKey
            Public Property Principal As PrincipalDerived(Of DependentBase(Of TKey))
        End Class

        Public Class DependentDerived(Of TKey)
            Inherits DependentBase(Of TKey)

            Public Sub New(Id As TKey)
                MyBase.New(Id)
            End Sub

            Private Property Data As String
        End Class

        Public Class OwnedType
            Implements INotifyPropertyChanged, INotifyPropertyChanging

            Private _context As Microsoft.EntityFrameworkCore.DbContext

            Public Sub New(context As Microsoft.EntityFrameworkCore.DbContext)
                Me.Context = context
            End Sub

            Public Property Context As Microsoft.EntityFrameworkCore.DbContext
                Get
                    Return _context
                End Get
                Set
                    RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs("Context"))
                    _context = Value
                    RaiseEvent PropertyChanging(Me, New PropertyChangingEventArgs("Context"))
                End Set
            End Property

            Public Property Number As Integer
            Public Property Details As String

            Public Event PropertyChanged As PropertyChangedEventHandler Implements INotifyPropertyChanged.PropertyChanged
            Public Event PropertyChanging As PropertyChangingEventHandler Implements INotifyPropertyChanging.PropertyChanging

        End Class

        <ConditionalFact>
        Public Sub DbFunctions()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.DbFunctionContext))>
    Public Partial Class DbFunctionContextModel
        Inherits RuntimeModel

        Private Shared _Instance As DbFunctionContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New DbFunctionContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports System.Linq
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Internal

Namespace TestNamespace
    Public Partial Class DbFunctionContextModel

        Private Sub Initialize()
            Dim data = DataEntityType.Create(Me)
            Dim [object] = ObjectEntityType.Create(Me)

            DataEntityType.CreateAnnotations(data)
            ObjectEntityType.CreateAnnotations([object])

            Dim type = Me.AddTypeMappingConfiguration(
                GetType(String),
                maxLength:=256)
            type.AddAnnotation("Relational:IsFixedLength", True)

            Dim functions As New SortedDictionary(Of String, IDbFunction)()
            Dim getCount As New RuntimeDbFunction(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetCount(System.Guid?,string)",
                Me,
                GetType(Integer),
                "CustomerOrderCount",
                schema:="dbf",
                storeType:="int",
                methodInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DbFunctionContext).GetMethod(
                    "GetCount",
                    BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly,
                    Nothing,
                    {GetType(Guid?), GetType(String)},
                    Nothing),
                scalar:=True)

            Dim id = getCount.AddParameter(
                "id",
                GetType(Guid?),
                True,
                "uniqueidentifier")
            id.AddAnnotation("MyAnnotation", {1L})

            Dim condition = getCount.AddParameter(
                "condition",
                GetType(String),
                False,
                "nchar(256)")

            functions("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetCount(System.Guid?,string)") = getCount

            Dim getData As New RuntimeDbFunction(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetData()",
                Me,
                GetType(IQueryable(Of VisualBasicRuntimeModelCodeGeneratorTest.Data)),
                "GetAllData",
                schema:="dbo",
                methodInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DbFunctionContext).GetMethod(
                    "GetData",
                    BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly,
                    Nothing,
                    {},
                    Nothing))

            functions("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetData()") = getData

            Dim getData0 As New RuntimeDbFunction(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetData(int)",
                Me,
                GetType(IQueryable(Of VisualBasicRuntimeModelCodeGeneratorTest.Data)),
                "GetData",
                schema:="dbo",
                methodInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DbFunctionContext).GetMethod(
                    "GetData",
                    BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly,
                    Nothing,
                    {GetType(Integer)},
                    Nothing))

            Dim id0 = getData0.AddParameter(
                "id",
                GetType(Integer),
                False,
                "int")

            functions("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetData(int)") = getData0

            Dim isDateShared As New RuntimeDbFunction(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.IsDateShared(string)",
                Me,
                GetType(Boolean),
                "IsDate",
                storeType:="bit",
                methodInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.DbFunctionContext).GetMethod(
                    "IsDateShared",
                    BindingFlags.Public Or BindingFlags.Static Or BindingFlags.DeclaredOnly,
                    Nothing,
                    {GetType(String)},
                    Nothing),
                scalar:=True,
                nullable:=True,
                builtIn:=True)

            Dim aDate = isDateShared.AddParameter(
                "aDate",
                GetType(String),
                False,
                "nchar(256)")

            isDateShared.AddAnnotation("MyGuid", New Guid("00000000-0000-0000-0000-000000000000"))
            functions("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.IsDateShared(string)") = isDateShared

            Dim getBlobs As New RuntimeDbFunction(
                "GetBlobs()",
                Me,
                GetType(IQueryable(Of Object)),
                "GetBlobs",
                schema:="dbo")

            functions("GetBlobs()") = getBlobs

            AddAnnotation("Relational:DbFunctions", functions)
            AddAnnotation("Relational:MaxIdentifierLength", 128)
            AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim data = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            data.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", Nothing, relationalModel)
            Dim blobColumnBase As New ColumnBase(Of ColumnMappingBase)("Blob", "varbinary(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Blob", blobColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase As New TableMappingBase(Of ColumnMappingBase)(data, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Blob"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Blob"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)

            Dim functionMappings As New List(Of FunctionMapping)()
            data.SetRuntimeAnnotation("Relational:FunctionMappings", functionMappings)
            Dim getAllData = DirectCast(Me.FindDbFunction("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetData()"), IRuntimeDbFunction)
            Dim getAllDataFunction As New StoreFunction(getAllData, relationalModel)
            Dim blobFunctionColumn As New FunctionColumn("Blob", "varbinary(max)", getAllDataFunction) With {
                .IsNullable = True
            }
            getAllDataFunction.Columns.Add("Blob", blobFunctionColumn)
            relationalModel.Functions.Add(
                ("GetAllData", "dbo", New String() {}),
                getAllDataFunction)
            Dim getAllDataFunctionMapping As New FunctionMapping(data, getAllDataFunction, getAllData, True)
            getAllDataFunction.AddEntityTypeMapping(getAllDataFunctionMapping, False)
            functionMappings.Add(getAllDataFunctionMapping)
            getAllDataFunctionMapping.IsDefaultFunctionMapping = True
            RelationalModel.CreateFunctionColumnMapping(getAllDataFunction.FindColumn("Blob"), data.FindProperty("Blob"), getAllDataFunctionMapping)
            Dim getData = DirectCast(Me.FindDbFunction("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetData(int)"), IRuntimeDbFunction)
            Dim getDataFunction As New StoreFunction(getData, relationalModel)
            Dim idFunctionParameter = getDataFunction.FindParameter("id")
            Dim blobFunctionColumn0 As New FunctionColumn("Blob", "varbinary(max)", getDataFunction) With {
                .IsNullable = True
            }
            getDataFunction.Columns.Add("Blob", blobFunctionColumn0)
            relationalModel.Functions.Add(
                ("GetData", "dbo", {"int"}),
                getDataFunction)
            Dim getDataFunctionMapping As New FunctionMapping(data, getDataFunction, getData, True)
            getDataFunction.AddEntityTypeMapping(getDataFunctionMapping, False)
            functionMappings.Add(getDataFunctionMapping)
            RelationalModel.CreateFunctionColumnMapping(getDataFunction.FindColumn("Blob"), data.FindProperty("Blob"), getDataFunctionMapping)

            Dim [object] = FindEntityType("object")

            Dim defaultTableMappings0 As New List(Of TableMappingBase(Of ColumnMappingBase))()
            [object].SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings0)
            Dim objectTableBase As New TableBase("object", Nothing, relationalModel)
            relationalModel.DefaultTables.Add("object", objectTableBase)
            Dim objectMappingBase As New TableMappingBase(Of ColumnMappingBase)([object], objectTableBase, True)
            objectTableBase.AddEntityTypeMapping(objectMappingBase, False)
            defaultTableMappings0.Add(objectMappingBase)

            Dim functionMappings0 As New List(Of FunctionMapping)()
            [object].SetRuntimeAnnotation("Relational:FunctionMappings", functionMappings0)
            Dim getBlobs = DirectCast(Me.FindDbFunction("GetBlobs()"), IRuntimeDbFunction)
            Dim getBlobsFunction As New StoreFunction(getBlobs, relationalModel)
            relationalModel.Functions.Add(
                ("GetBlobs", "dbo", New String() {}),
                getBlobsFunction)
            Dim getBlobsFunctionMapping As New FunctionMapping([object], getBlobsFunction, getBlobs, True)
            getBlobsFunction.AddEntityTypeMapping(getBlobsFunctionMapping, False)
            functionMappings0.Add(getBlobsFunctionMapping)
            getBlobsFunctionMapping.IsDefaultFunctionMapping = True
            Dim customerOrderCount = DirectCast(Me.FindDbFunction("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetCount(System.Guid?,string)"), IRuntimeDbFunction)
            Dim customerOrderCountFunction As New StoreFunction(customerOrderCount, relationalModel)
            Dim idFunctionParameter0 = customerOrderCountFunction.FindParameter("id")
            Dim conditionFunctionParameter = customerOrderCountFunction.FindParameter("condition")
            relationalModel.Functions.Add(
                ("CustomerOrderCount", "dbf", {"uniqueidentifier", "nchar(256)"}),
                customerOrderCountFunction)
            Dim isDate = DirectCast(Me.FindDbFunction("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.IsDateShared(string)"), IRuntimeDbFunction)
            Dim isDateFunction As New StoreFunction(isDate, relationalModel)
            Dim aDateFunctionParameter = isDateFunction.FindParameter("aDate")
            relationalModel.Functions.Add(
                ("IsDate", Nothing, {"nchar(256)"}),
                isDateFunction)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value

            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class DataEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data),
                baseEntityType)

            Dim blob = entityType.AddProperty(
                "Blob",
                GetType(Byte()),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetProperty("Blob", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetField("_Blob", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            blob.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+DbFunctionContext.GetData()")
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", Nothing)
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value
            Dim e2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class ObjectEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "object",
                GetType(Object),
                baseEntityType)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", "GetBlobs()")
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", Nothing)
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New DbFunctionContext(),
                CreateCompiledModelCodeGenerationOptions(),
                Sub(code)
                    Assert.Collection(
                        code,
                        Sub(c) AssertFileContents("DbFunctionContextModel.vb", rm1, c),
                        Sub(c) AssertFileContents("DbFunctionContextModelBuilder.vb", rm2, c),
                        Sub(c) AssertFileContents("DataEntityType.vb", e1, c),
                        Sub(c) AssertFileContents("ObjectEntityType.vb", e2, c))
                End Sub,
                Sub(model)
                    Assert.Equal(5, model.GetDbFunctions().Count())

                    Dim getCount = model.FindDbFunction(GetType(DbFunctionContext).GetMethod("GetCount", BindingFlags.NonPublic Or BindingFlags.Instance))
                    Assert.Equal("CustomerOrderCount", getCount.Name)
                    Assert.Same(model, getCount.Model)
                    Assert.Same(model, (DirectCast(getCount, IReadOnlyDbFunction)).Model)
                    Assert.Equal(GetType(DbFunctionContext).FullName & ".GetCount(System.Guid?,string)", getCount.ModelName)
                    Assert.Equal("dbf", getCount.Schema)
                    Assert.False(getCount.IsNullable)
                    Assert.True(getCount.IsScalar)
                    Assert.False(getCount.IsBuiltIn)
                    Assert.False(getCount.IsAggregate)
                    Assert.Null(getCount.Translation)
                    Assert.Equal("int", getCount.TypeMapping?.StoreType)
                    Assert.Equal(GetType(Integer), getCount.ReturnType)
                    Assert.Equal("GetCount", getCount.MethodInfo.Name)
                    Assert.Empty(getCount.GetAnnotations())
                    Assert.Empty(getCount.GetRuntimeAnnotations())
                    Assert.Equal("CustomerOrderCount", getCount.StoreFunction.Name)
                    Assert.False(getCount.StoreFunction.IsShared)
                    Assert.NotNull(getCount.ToString())
                    Assert.Equal(getCount.Parameters, DirectCast(getCount, IReadOnlyDbFunction).Parameters)
                    Assert.Equal(2, getCount.Parameters.Count)

                    Dim getCountParameter1 = getCount.Parameters(0)
                    Assert.Same(getCount, getCountParameter1.Function)
                    Assert.Same(getCount, DirectCast(getCountParameter1, IReadOnlyDbFunctionParameter).Function)
                    Assert.Equal("id", getCountParameter1.Name)
                    Assert.Equal("uniqueidentifier", getCountParameter1.StoreType)
                    Assert.Equal("uniqueidentifier", DirectCast(getCountParameter1, IReadOnlyDbFunctionParameter).StoreType)
                    Assert.True(getCountParameter1.PropagatesNullability)
                    Assert.Equal(GetType(Guid?), getCountParameter1.ClrType)
                    Assert.Equal("uniqueidentifier", getCountParameter1.TypeMapping.StoreType)
                    Assert.Single(getCountParameter1.GetAnnotations())
                    Assert.Equal({1L}, getCountParameter1("MyAnnotation"))
                    Assert.Equal("id", getCountParameter1.StoreFunctionParameter.Name)
                    Assert.Equal("uniqueidentifier", getCountParameter1.StoreFunctionParameter.StoreType)
                    Assert.NotNull(getCountParameter1.ToString())

                    Dim getCountParameter2 = getCount.Parameters(1)
                    Assert.Same(getCount, getCountParameter2.Function)
                    Assert.Equal("condition", getCountParameter2.Name)
                    Assert.Equal("nchar(256)", getCountParameter2.StoreType)
                    Assert.False(getCountParameter2.PropagatesNullability)
                    Assert.Equal(GetType(String), getCountParameter2.ClrType)
                    Assert.Equal("nchar(256)", getCountParameter2.TypeMapping.StoreType)
                    Assert.Equal("condition", getCountParameter2.StoreFunctionParameter.Name)
                    Assert.Equal("nchar(256)", getCountParameter2.StoreFunctionParameter.StoreType)
                    Assert.NotNull(getCountParameter2.ToString())

                    Dim isDate = model.FindDbFunction(GetType(DbFunctionContext).GetMethod("IsDateShared"))
                    Assert.Equal("IsDate", isDate.Name)
                    Assert.Null(isDate.Schema)
                    Assert.Equal(GetType(DbFunctionContext).FullName & ".IsDateShared(string)", isDate.ModelName)
                    Assert.True(isDate.IsNullable)
                    Assert.True(isDate.IsScalar)
                    Assert.True(isDate.IsBuiltIn)
                    Assert.False(isDate.IsAggregate)
                    Assert.Null(isDate.Translation)
                    Assert.Equal(GetType(Boolean), isDate.ReturnType)
                    Assert.Equal("IsDateShared", isDate.MethodInfo.Name)
                    Assert.Single(isDate.GetAnnotations())
                    Assert.Equal(New Guid(), isDate("MyGuid"))
                    Assert.Empty(isDate.GetRuntimeAnnotations())
                    Assert.Equal("bit", isDate.StoreFunction.ReturnType)
                    Assert.Empty(isDate.StoreFunction.EntityTypeMappings)
                    Assert.Single(isDate.Parameters)

                    Dim isDateParameter = isDate.Parameters(0)
                    Assert.Same(isDate, isDateParameter.Function)
                    Assert.Equal("aDate", isDateParameter.Name)
                    Assert.Equal("nchar(256)", isDateParameter.StoreType)
                    Assert.False(isDateParameter.PropagatesNullability)
                    Assert.Equal(GetType(String), isDateParameter.ClrType)
                    Assert.Equal("nchar(256)", isDateParameter.TypeMapping.StoreType)
                    Assert.Equal("aDate", isDateParameter.StoreFunctionParameter.Name)
                    Assert.Equal("nchar(256)", isDateParameter.StoreFunctionParameter.StoreType)

                    Dim getData = model.FindDbFunction(
                                    GetType(DbFunctionContext).GetMethod("GetData", {GetType(Integer)}))

                    Assert.Equal("GetData", getData.Name)
                    Assert.Equal("dbo", getData.Schema)
                    Assert.Equal(GetType(DbFunctionContext).FullName & ".GetData(int)", getData.ModelName)
                    Assert.False(getData.IsNullable)
                    Assert.False(getData.IsScalar)
                    Assert.False(getData.IsBuiltIn)
                    Assert.False(getData.IsAggregate)
                    Assert.Null(getData.Translation)
                    Assert.Equal(GetType(IQueryable(Of Data)), getData.ReturnType)
                    Assert.Equal("GetData", getData.MethodInfo.Name)
                    Assert.Empty(getData.GetAnnotations())
                    Assert.Empty(getData.GetRuntimeAnnotations())
                    Assert.Null(getData.TypeMapping?.StoreType)
                    Assert.Null(getData.StoreFunction.ReturnType)
                    Assert.Equal(GetType(Data), getData.StoreFunction.EntityTypeMappings.Single().EntityType.ClrType)
                    Assert.Single(getData.Parameters)

                    Dim getDataParameter = getData.Parameters(0)
                    Assert.Same(getData, getDataParameter.Function)
                    Assert.Equal("id", getDataParameter.Name)
                    Assert.Equal("int", getDataParameter.StoreType)
                    Assert.False(getDataParameter.PropagatesNullability)
                    Assert.Equal(GetType(Integer), getDataParameter.ClrType)
                    Assert.Equal("int", getDataParameter.TypeMapping.StoreType)
                    Assert.Equal("id", getDataParameter.StoreFunctionParameter.Name)
                    Assert.Equal("int", getDataParameter.StoreFunctionParameter.StoreType)

                    Dim getDataParameterless = model.FindDbFunction(GetType(DbFunctionContext).
                                                                    GetMethod("GetData", Array.Empty(Of Type)))
                    Assert.Equal("GetAllData", getDataParameterless.Name)
                    Assert.Equal("dbo", getDataParameterless.Schema)
                    Assert.Equal(GetType(DbFunctionContext).FullName & ".GetData()", getDataParameterless.ModelName)
                    Assert.False(getDataParameterless.IsNullable)
                    Assert.False(getDataParameterless.IsScalar)
                    Assert.False(getDataParameterless.IsBuiltIn)
                    Assert.False(getDataParameterless.IsAggregate)
                    Assert.Null(getDataParameterless.Translation)
                    Assert.Equal(GetType(IQueryable(Of Data)), getDataParameterless.ReturnType)
                    Assert.Equal("GetData", getDataParameterless.MethodInfo.Name)
                    Assert.Empty(getDataParameterless.GetAnnotations())
                    Assert.Empty(getDataParameterless.GetRuntimeAnnotations())
                    Assert.False(getDataParameterless.StoreFunction.IsBuiltIn)
                    Assert.Equal(GetType(Data), getDataParameterless.StoreFunction.EntityTypeMappings.Single().EntityType.ClrType)
                    Assert.Equal(0, getDataParameterless.Parameters.Count)

                    Assert.Equal(2, model.GetEntityTypes().Count())
                    Dim dataEntity = model.FindEntityType(GetType(Data))
                    Assert.Null(dataEntity.FindPrimaryKey())
                    Dim dataEntityFunctionMapping = dataEntity.GetFunctionMappings().Single(Function(m) m.IsDefaultFunctionMapping)
                    Assert.True(dataEntityFunctionMapping.IncludesDerivedTypes)
                    Assert.Null(dataEntityFunctionMapping.IsSharedTablePrincipal)
                    Assert.Null(dataEntityFunctionMapping.IsSplitEntityTypePrincipal)
                    Assert.Same(getDataParameterless, dataEntityFunctionMapping.DbFunction)

                    Dim getDataStoreFunction = dataEntityFunctionMapping.StoreFunction
                    Assert.Same(getDataParameterless, getDataStoreFunction.DbFunctions.Single())
                    Assert.False(getDataStoreFunction.IsOptional(dataEntity))

                    Dim dataEntityOtherFunctionMapping = dataEntity.GetFunctionMappings().Single(Function(m) Not m.IsDefaultFunctionMapping)
                    Assert.True(dataEntityOtherFunctionMapping.IncludesDerivedTypes)
                    Assert.Null(dataEntityOtherFunctionMapping.IsSharedTablePrincipal)
                    Assert.Null(dataEntityOtherFunctionMapping.IsSplitEntityTypePrincipal)
                    Assert.Same(getData, dataEntityOtherFunctionMapping.DbFunction)

                    Dim getDataOtherStoreFunction = dataEntityOtherFunctionMapping.StoreFunction
                    Assert.Same(getData, getDataOtherStoreFunction.DbFunctions.Single())
                    Assert.False(getDataOtherStoreFunction.IsOptional(dataEntity))

                    Dim getBlobs = model.FindDbFunction("GetBlobs()")
                    Assert.Equal("dbo", getBlobs.Schema)
                    Assert.False(getBlobs.IsNullable)
                    Assert.False(getBlobs.IsScalar)
                    Assert.False(getBlobs.IsBuiltIn)
                    Assert.False(getBlobs.IsAggregate)
                    Assert.Null(getBlobs.Translation)
                    Assert.Null(getBlobs.TypeMapping)
                    Assert.Equal(GetType(IQueryable(Of Object)), getBlobs.ReturnType)
                    Assert.Null(getBlobs.MethodInfo)
                    Assert.Empty(getBlobs.GetAnnotations())
                    Assert.Empty(getBlobs.GetRuntimeAnnotations())
                    Assert.Equal("GetBlobs", getBlobs.StoreFunction.Name)
                    Assert.False(getBlobs.StoreFunction.IsShared)
                    Assert.NotNull(getBlobs.ToString())
                    Assert.Empty(getBlobs.Parameters)

                    Dim objectEntity = model.FindEntityType(GetType(Object))
                    Assert.Null(objectEntity.FindPrimaryKey())
                    Dim objectEntityFunctionMapping = objectEntity.GetFunctionMappings().Single(Function(m) m.IsDefaultFunctionMapping)
                    Assert.True(objectEntityFunctionMapping.IncludesDerivedTypes)
                    Assert.Null(objectEntityFunctionMapping.IsSharedTablePrincipal)
                    Assert.Null(objectEntityFunctionMapping.IsSplitEntityTypePrincipal)
                    Assert.Same(getBlobs, objectEntityFunctionMapping.DbFunction)
                End Sub)
        End Sub

        Public Class DbFunctionContext
            Inherits SqlServerContextBase

            Public Shared Function IsDateShared(aDate As String) As Boolean
                Throw New NotImplementedException()
            End Function

            Private Function GetCount(id As Guid?, condition As String) As Integer
                Throw New NotImplementedException()
            End Function

            Public Function GetData(id As Integer) As IQueryable(Of Data)
                Return FromExpression(Function() GetData(id))
            End Function

            Public Function GetData() As IQueryable(Of Data)
                Return FromExpression(Function() GetData())
            End Function

            Protected Overrides Sub ConfigureConventions(configurationBuilder As ModelConfigurationBuilder)
                configurationBuilder.DefaultTypeMapping(Of String)().HasMaxLength(256).IsFixedLength()
            End Sub

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.
                    HasDbFunction(GetType(DbFunctionContext).
                    GetMethod(NameOf(GetCount), BindingFlags.NonPublic Or BindingFlags.Instance)).
                    HasName("CustomerOrderCount").HasSchema("dbf").IsNullable(False).
                    HasParameter("id").
                    PropagatesNullability().
                    Metadata.SetAnnotation("MyAnnotation", {1L})

                modelBuilder.
                    HasDbFunction(GetType(DbFunctionContext).
                    GetMethod(NameOf(IsDateShared))).
                    HasName("IsDate").
                    IsBuiltIn().
                    Metadata.
                    SetAnnotation("MyGuid", New Guid())

                modelBuilder.HasDbFunction(GetType(DbFunctionContext).GetMethod(NameOf(GetData), {GetType(Integer)}))
                modelBuilder.HasDbFunction(GetType(DbFunctionContext).GetMethod(NameOf(GetData), New Type() {}))

                modelBuilder.
                    Entity(Of Data)().
                    ToFunction(GetType(DbFunctionContext).
                    FullName & ".GetData()", Function(f) f.HasName("GetAllData")).
                    HasNoKey()

                modelBuilder.Entity(Of Object)().
                    ToFunction("GetBlobs()", Function(f) f.HasName("GetBlobs")).
                    HasNoKey()
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Sequences()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.SequencesContext))>
    Public Partial Class SequencesContextModel
        Inherits RuntimeModel

        Private Shared _Instance As SequencesContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New SequencesContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Internal

Namespace TestNamespace
    Public Partial Class SequencesContextModel

        Private Sub Initialize()
            Dim data = DataEntityType.Create(Me)

            DataEntityType.CreateAnnotations(data)

            Dim sequences As New SortedDictionary(Of (String, String), ISequence)()
            Dim hL As New RuntimeSequence(
                "HL",
                Me,
                GetType(Long),
                schema:="S",
                incrementBy:=10)

            sequences(("HL", "S")) = hL

            Dim [long] As New RuntimeSequence(
                "Long",
                Me,
                GetType(Long),
                startValue:=-4L,
                incrementBy:=2,
                cyclic:=True,
                minValue:=-2L,
                maxValue:=2L)

            sequences(("Long", Nothing)) = [long]

            AddAnnotation("Relational:Sequences", sequences)
            AddAnnotation("Relational:MaxIdentifierLength", 128)
            AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim data = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            data.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", Nothing, relationalModel)
            Dim blobColumnBase As New ColumnBase(Of ColumnMappingBase)("Blob", "varbinary(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Blob", blobColumnBase)
            Dim idColumnBase As New ColumnBase(Of ColumnMappingBase)("Id", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Id", idColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase As New TableMappingBase(Of ColumnMappingBase)(data, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Blob"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Blob"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)

            Dim tableMappings As New List(Of TableMapping)()
            data.SetRuntimeAnnotation("Relational:TableMappings", tableMappings)
            Dim dataTable As New Table("Data", Nothing, relationalModel)
            Dim idColumn As New Column("Id", "int", dataTable)
            dataTable.Columns.Add("Id", idColumn)
            Dim blobColumn As New Column("Blob", "varbinary(max)", dataTable) With {
                .IsNullable = True
            }
            dataTable.Columns.Add("Blob", blobColumn)
            Dim pK_Data As New UniqueConstraint("PK_Data", dataTable, {idColumn})
            dataTable.PrimaryKey = pK_Data
            Dim pK_DataUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                {"Id"})
            pK_Data.MappedKeys.Add(pK_DataUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DataUc).Add(pK_Data)
            dataTable.UniqueConstraints.Add("PK_Data", pK_Data)
            relationalModel.Tables.Add(("Data", Nothing), dataTable)
            Dim dataTableMapping As New TableMapping(data, dataTable, True)
            dataTable.AddEntityTypeMapping(dataTableMapping, False)
            tableMappings.Add(dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Id"), data.FindProperty("Id"), dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Blob"), data.FindProperty("Blob"), dataTableMapping)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value

            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class DataEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Integer),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            id.AddAnnotation("SqlServer:HiLoSequenceName", "HL")
            id.AddAnnotation("SqlServer:HiLoSequenceSchema", "S")
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.SequenceHiLo)

            Dim blob = entityType.AddProperty(
                "Blob",
                GetType(Byte()),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetProperty("Blob", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetField("_Blob", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            blob.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "Data")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New SequencesContext(),
                CreateCompiledModelCodeGenerationOptions(),
                Sub(code)
                    Assert.Collection(
                        code,
                        Sub(c) AssertFileContents("SequencesContextModel.vb", rm1, c),
                        Sub(c) AssertFileContents("SequencesContextModelBuilder.vb", rm2, c),
                        Sub(c) AssertFileContents("DataEntityType.vb", e1, c))
                End Sub,
                Sub(model)
                    Assert.Equal(2, model.GetSequences().Count())

                    Dim longSequence = model.FindSequence("Long")
                    Assert.Same(model, longSequence.Model)
                    Assert.Equal(GetType(Long), longSequence.Type)
                    Assert.True(longSequence.IsCyclic)
                    Assert.Equal(-4, longSequence.StartValue)
                    Assert.Equal(-2, longSequence.MinValue)
                    Assert.Equal(2, longSequence.MaxValue)
                    Assert.Equal(2, longSequence.IncrementBy)
                    Assert.NotNull(longSequence.ToString())

                    Dim hiLo = model.FindSequence("HL", "S")
                    Assert.Same(model, DirectCast(hiLo, IReadOnlySequence).Model)
                    Assert.Equal("HL", hiLo.Name)
                    Assert.Equal("S", hiLo.Schema)
                    Assert.False(hiLo.IsCyclic)
                    Assert.Equal(1, hiLo.StartValue)
                    Assert.Null(hiLo.MinValue)
                    Assert.Null(hiLo.MaxValue)
                    Assert.Equal(10, hiLo.IncrementBy)
                    Assert.NotNull(hiLo.ToString())

                    Assert.Single(model.GetEntityTypes())
                    Dim dataEntity = model.FindEntityType(GetType(Data))
                    Assert.Same(hiLo, dataEntity.FindPrimaryKey().Properties.Single().FindHiLoSequence())
                End Sub)
        End Sub

        Public Class SequencesContext
            Inherits SqlServerContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.HasSequence(Of Long)("Long").
                         HasMin(-2).
                         HasMax(2).
                         IsCyclic().
                         IncrementsBy(2).
                         StartsAt(-4)

                modelBuilder.Entity(Of Data)(Sub(eb)
                                                 eb.Property(Of Integer)("Id").UseHiLo("HL", "S")
                                                 eb.HasKey("Id")
                                             End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Key_sequences()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.KeySequencesContext))>
    Public Partial Class KeySequencesContextModel
        Inherits RuntimeModel

        Private Shared _Instance As KeySequencesContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New KeySequencesContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Internal

Namespace TestNamespace
    Public Partial Class KeySequencesContextModel

        Private Sub Initialize()
            Dim data = DataEntityType.Create(Me)

            DataEntityType.CreateAnnotations(data)

            Dim sequences As New SortedDictionary(Of (String, String), ISequence)()
            Dim keySeq As New RuntimeSequence(
                "KeySeq",
                Me,
                GetType(Long),
                schema:="KeySeqSchema")

            sequences(("KeySeq", "KeySeqSchema")) = keySeq

            AddAnnotation("Relational:Sequences", sequences)
            AddAnnotation("Relational:MaxIdentifierLength", 128)
            AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim data = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            data.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", Nothing, relationalModel)
            Dim blobColumnBase As New ColumnBase(Of ColumnMappingBase)("Blob", "varbinary(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Blob", blobColumnBase)
            Dim idColumnBase As New ColumnBase(Of ColumnMappingBase)("Id", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Id", idColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase As New TableMappingBase(Of ColumnMappingBase)(data, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Blob"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Blob"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)

            Dim tableMappings As New List(Of TableMapping)()
            data.SetRuntimeAnnotation("Relational:TableMappings", tableMappings)
            Dim dataTable As New Table("Data", Nothing, relationalModel)
            Dim idColumn As New Column("Id", "int", dataTable)
            dataTable.Columns.Add("Id", idColumn)
            Dim blobColumn As New Column("Blob", "varbinary(max)", dataTable) With {
                .IsNullable = True
            }
            dataTable.Columns.Add("Blob", blobColumn)
            Dim pK_Data As New UniqueConstraint("PK_Data", dataTable, {idColumn})
            dataTable.PrimaryKey = pK_Data
            Dim pK_DataUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                {"Id"})
            pK_Data.MappedKeys.Add(pK_DataUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DataUc).Add(pK_Data)
            dataTable.UniqueConstraints.Add("PK_Data", pK_Data)
            relationalModel.Tables.Add(("Data", Nothing), dataTable)
            Dim dataTableMapping As New TableMapping(data, dataTable, True)
            dataTable.AddEntityTypeMapping(dataTableMapping, False)
            tableMappings.Add(dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Id"), data.FindProperty("Id"), dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Blob"), data.FindProperty("Blob"), dataTableMapping)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value

            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class DataEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Integer),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            id.AddAnnotation("Relational:DefaultValueSql", "NEXT VALUE FOR [KeySeqSchema].[KeySeq]")
            id.AddAnnotation("SqlServer:SequenceName", "KeySeq")
            id.AddAnnotation("SqlServer:SequenceSchema", "KeySeqSchema")
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.Sequence)

            Dim blob = entityType.AddProperty(
                "Blob",
                GetType(Byte()),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetProperty("Blob", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetField("_Blob", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            blob.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "Data")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New KeySequencesContext(),
                CreateCompiledModelCodeGenerationOptions(),
                Sub(code)
                    Assert.Collection(
                        code,
                        Sub(c) AssertFileContents("KeySequencesContextModel.vb", rm1, c),
                        Sub(c) AssertFileContents("KeySequencesContextModelBuilder.vb", rm2, c),
                        Sub(c) AssertFileContents("DataEntityType.vb", e1, c))
                End Sub,
                Sub(Model)
                    Assert.Single(Model.GetSequences())

                    Dim keySequence = Model.FindSequence("KeySeq", "KeySeqSchema")
                    Assert.Same(Model, DirectCast(keySequence, IReadOnlySequence).Model)
                    Assert.Equal("KeySeq", keySequence.Name)
                    Assert.Equal("KeySeqSchema", keySequence.Schema)
                    Assert.False(keySequence.IsCyclic)
                    Assert.Equal(1, keySequence.StartValue)
                    Assert.Null(keySequence.MinValue)
                    Assert.Null(keySequence.MaxValue)
                    Assert.Equal(1, keySequence.IncrementBy)
                    Assert.NotNull(keySequence.ToString())

                    Assert.Single(DirectCast(Model.GetEntityTypes(), IEnumerable))
                    Dim dataEntity = Model.FindEntityType(GetType(Data))
                    Assert.Same(keySequence, dataEntity.FindPrimaryKey().Properties.Single().FindSequence())
                End Sub)
        End Sub

        Public Class KeySequencesContext
            Inherits SqlServerContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(Of Data)(
                    Sub(eb)
                        eb.Property(Of Integer)("Id").UseSequence("KeySeq", "KeySeqSchema")
                        eb.HasKey("Id")
                    End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub CheckConstraints()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.ConstraintsContext))>
    Public Partial Class ConstraintsContextModel
        Inherits RuntimeModel

        Private Shared _Instance As ConstraintsContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New ConstraintsContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Internal

Namespace TestNamespace
    Public Partial Class ConstraintsContextModel

        Private Sub Initialize()
            Dim data = DataEntityType.Create(Me)

            DataEntityType.CreateAnnotations(data)

            AddAnnotation("Relational:MaxIdentifierLength", 128)
            AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim data = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            data.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", Nothing, relationalModel)
            Dim blobColumnBase As New ColumnBase(Of ColumnMappingBase)("Blob", "varbinary(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Blob", blobColumnBase)
            Dim idColumnBase As New ColumnBase(Of ColumnMappingBase)("Id", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Id", idColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase As New TableMappingBase(Of ColumnMappingBase)(data, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Blob"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Blob"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)

            Dim tableMappings As New List(Of TableMapping)()
            data.SetRuntimeAnnotation("Relational:TableMappings", tableMappings)
            Dim dataTable As New Table("Data", Nothing, relationalModel)
            Dim idColumn As New Column("Id", "int", dataTable)
            dataTable.Columns.Add("Id", idColumn)
            Dim blobColumn As New Column("Blob", "varbinary(max)", dataTable) With {
                .IsNullable = True
            }
            dataTable.Columns.Add("Blob", blobColumn)
            Dim pK_Data As New UniqueConstraint("PK_Data", dataTable, {idColumn})
            dataTable.PrimaryKey = pK_Data
            Dim pK_DataUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                {"Id"})
            pK_Data.MappedKeys.Add(pK_DataUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DataUc).Add(pK_Data)
            dataTable.UniqueConstraints.Add("PK_Data", pK_Data)
            relationalModel.Tables.Add(("Data", Nothing), dataTable)
            Dim dataTableMapping As New TableMapping(data, dataTable, True)
            dataTable.AddEntityTypeMapping(dataTableMapping, False)
            tableMappings.Add(dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Id"), data.FindProperty("Id"), dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Blob"), data.FindProperty("Blob"), dataTableMapping)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value

            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class DataEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Integer),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)

            Dim blob = entityType.AddProperty(
                "Blob",
                GetType(Byte()),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetProperty("Blob", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetField("_Blob", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            blob.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "Data")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New ConstraintsContext(),
                CreateCompiledModelCodeGenerationOptions(),
                Sub(Code)
                    Assert.Collection(Code,
                                    Sub(c) AssertFileContents("ConstraintsContextModel.vb", rm1, c),
                                    Sub(c) AssertFileContents("ConstraintsContextModelBuilder.vb", rm2, c),
                                    Sub(c) AssertFileContents("DataEntityType.vb", e1, c))
                End Sub,
            Sub(model)
                Dim dataEntity = model.GetEntityTypes().Single()
                Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() dataEntity.GetCheckConstraints()).Message)
            End Sub)
        End Sub

        Public Class ConstraintsContext
            Inherits SqlServerContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(Of Data)(
                    Sub(eb)
                        eb.Property(Of Integer)("Id")
                        eb.HasKey("Id")
                        eb.ToTable(Function(tb) tb.HasCheckConstraint("idConstraint", "Id <> 0"))
                        eb.ToTable(Function(tb) tb.HasCheckConstraint("anotherConstraint", "Id <> -1"))
                    End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Triggers()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.TriggersContext))>
    Public Partial Class TriggersContextModel
        Inherits RuntimeModel

        Private Shared _Instance As TriggersContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New TriggersContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value

            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Collections.Generic
Imports Microsoft.EntityFrameworkCore
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Microsoft.EntityFrameworkCore.Metadata.Internal

Namespace TestNamespace
    Public Partial Class TriggersContextModel

        Private Sub Initialize()
            Dim data = DataEntityType.Create(Me)

            DataEntityType.CreateAnnotations(data)

            AddAnnotation("Relational:MaxIdentifierLength", 128)
            AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)
            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim data = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            data.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", Nothing, relationalModel)
            Dim blobColumnBase As New ColumnBase(Of ColumnMappingBase)("Blob", "varbinary(max)", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Blob", blobColumnBase)
            Dim idColumnBase As New ColumnBase(Of ColumnMappingBase)("Id", "int", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Id", idColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase As New TableMappingBase(Of ColumnMappingBase)(data, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Blob"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Blob"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)

            Dim tableMappings As New List(Of TableMapping)()
            data.SetRuntimeAnnotation("Relational:TableMappings", tableMappings)
            Dim dataTable As New Table("Data", Nothing, relationalModel)
            Dim idColumn As New Column("Id", "int", dataTable)
            dataTable.Columns.Add("Id", idColumn)
            Dim blobColumn As New Column("Blob", "varbinary(max)", dataTable) With {
                .IsNullable = True
            }
            dataTable.Columns.Add("Blob", blobColumn)
            Dim pK_Data As New UniqueConstraint("PK_Data", dataTable, {idColumn})
            dataTable.PrimaryKey = pK_Data
            Dim pK_DataUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                {"Id"})
            pK_Data.MappedKeys.Add(pK_DataUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DataUc).Add(pK_Data)
            dataTable.UniqueConstraints.Add("PK_Data", pK_Data)
            dataTable.Triggers.Add("Trigger1", data.FindDeclaredTrigger("Trigger1"))
            dataTable.Triggers.Add("Trigger2", data.FindDeclaredTrigger("Trigger2"))
            relationalModel.Tables.Add(("Data", Nothing), dataTable)
            Dim dataTableMapping As New TableMapping(data, dataTable, True)
            dataTable.AddEntityTypeMapping(dataTableMapping, False)
            tableMappings.Add(dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Id"), data.FindProperty("Id"), dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Blob"), data.FindProperty("Blob"), dataTableMapping)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value

            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Friend Partial Class DataEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Integer),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)
            id.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.IdentityColumn)

            Dim blob = entityType.AddProperty(
                "Blob",
                GetType(Byte()),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetProperty("Blob", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetField("_Blob", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            blob.AddAnnotation("SqlServer:ValueGenerationStrategy", SqlServerValueGenerationStrategy.None)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Dim trigger1 = entityType.AddTrigger(
                "Trigger1")

            Dim trigger2 = entityType.AddTrigger(
                "Trigger2")

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "Data")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)
            entityType.AddAnnotation("SqlServer:UseSqlOutputClause", False)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New TriggersContext(),
                CreateCompiledModelCodeGenerationOptions(),
                Sub(code)
                    Assert.Collection(code,
                        Sub(c) AssertFileContents("TriggersContextModel.vb", rm1, c),
                        Sub(c) AssertFileContents("TriggersContextModelBuilder.vb", rm2, c),
                        Sub(c) AssertFileContents("DataEntityType.vb", e1, c))
                End Sub,
                Sub(Model)
                    Dim dataEntity = Model.GetEntityTypes().Single()

                    Assert.Equal(
                        CoreStrings.RuntimeModelMissingData,
                        Assert.Throws(Of InvalidOperationException)(Sub() dataEntity.GetCheckConstraints()).Message)
                End Sub)
        End Sub

        Public Class TriggersContext
            Inherits SqlServerContextBase

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                MyBase.OnModelCreating(modelBuilder)

                modelBuilder.Entity(Of Data)(
                    Sub(eb)
                        eb.Property(Of Integer)("Id")
                        eb.HasKey("Id")

                        eb.ToTable(
                            Sub(tb)
                                tb.HasTrigger("Trigger1")
                                tb.HasTrigger("Trigger2")
                            End Sub)
                    End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Sqlite()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure

Namespace Microsoft.EntityFrameworkCore.Metadata
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.SqliteContext))>
    Public Partial Class SqliteContextModel
        Inherits RuntimeModel

        Private Shared _Instance As SqliteContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New SqliteContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value
            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System.Collections.Generic
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata.Internal

Namespace Microsoft.EntityFrameworkCore.Metadata
    Public Partial Class SqliteContextModel

        Private Sub Initialize()
            Dim data = DataEntityType.Create(Me)

            DataEntityType.CreateAnnotations(data)

            AddRuntimeAnnotation("Relational:RelationalModel", CreateRelationalModel())
        End Sub

        Private Function CreateRelationalModel() As IRelationalModel
            Dim relationalModel As New RelationalModel(Me)

            Dim data = FindEntityType("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data")

            Dim defaultTableMappings As New List(Of TableMappingBase(Of ColumnMappingBase))()
            data.SetRuntimeAnnotation("Relational:DefaultMappings", defaultTableMappings)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase As New TableBase("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", Nothing, relationalModel)
            Dim blobColumnBase As New ColumnBase(Of ColumnMappingBase)("Blob", "BLOB", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Blob", blobColumnBase)
            Dim idColumnBase As New ColumnBase(Of ColumnMappingBase)("Id", "INTEGER", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Id", idColumnBase)
            Dim pointColumnBase As New ColumnBase(Of ColumnMappingBase)("Point", "POINT", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase) With {
                .IsNullable = True
            }
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.Columns.Add("Point", pointColumnBase)
            relationalModel.DefaultTables.Add("EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data", entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase)
            Dim entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase As New TableMappingBase(Of ColumnMappingBase)(data, entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase, True)
            entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.AddEntityTypeMapping(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase, False)
            defaultTableMappings.Add(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Id"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Id"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Blob"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Blob"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)
            RelationalModel.CreateColumnMapping(DirectCast(entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataTableBase.FindColumn("Point"), ColumnBase(Of ColumnMappingBase)), data.FindProperty("Point"), entityFrameworkCoreVisualBasicScaffoldingInternalVisualBasicRuntimeModelCodeGeneratorTestDataMappingBase)

            Dim tableMappings As New List(Of TableMapping)()
            data.SetRuntimeAnnotation("Relational:TableMappings", tableMappings)
            Dim dataTable As New Table("Data", Nothing, relationalModel)
            Dim idColumn As New Column("Id", "INTEGER", dataTable)
            dataTable.Columns.Add("Id", idColumn)
            Dim blobColumn As New Column("Blob", "BLOB", dataTable) With {
                .IsNullable = True
            }
            dataTable.Columns.Add("Blob", blobColumn)
            Dim pointColumn As New Column("Point", "POINT", dataTable) With {
                .IsNullable = True
            }
            dataTable.Columns.Add("Point", pointColumn)
            Dim pK_Data As New UniqueConstraint("PK_Data", dataTable, {idColumn})
            dataTable.PrimaryKey = pK_Data
            Dim pK_DataUc = RelationalModel.GetKey(Me,
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                {"Id"})
            pK_Data.MappedKeys.Add(pK_DataUc)
            RelationalModel.GetOrCreateUniqueConstraints(pK_DataUc).Add(pK_Data)
            dataTable.UniqueConstraints.Add("PK_Data", pK_Data)
            relationalModel.Tables.Add(("Data", Nothing), dataTable)
            Dim dataTableMapping As New TableMapping(data, dataTable, True)
            dataTable.AddEntityTypeMapping(dataTableMapping, False)
            tableMappings.Add(dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Id"), data.FindProperty("Id"), dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Blob"), data.FindProperty("Blob"), dataTableMapping)
            RelationalModel.CreateColumnMapping(dataTable.FindColumn("Point"), data.FindProperty("Point"), dataTableMapping)
            Return relationalModel.MakeReadOnly()
        End Function
    End Class
End Namespace
]]>.Value
            Dim e1 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports NetTopologySuite.Geometries

Namespace Microsoft.EntityFrameworkCore.Metadata
    Friend Partial Class DataEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Integer),
                valueGenerated:=ValueGenerated.OnAdd,
                afterSaveBehavior:=PropertySaveBehavior.Throw)

            Dim blob = entityType.AddProperty(
                "Blob",
                GetType(Byte()),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetProperty("Blob", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetField("_Blob", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)

            Dim point = entityType.AddProperty(
                "Point",
                GetType(Point),
                nullable:=True)

            Dim key = entityType.AddKey(
                {id})
            entityType.SetPrimaryKey(key)

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Relational:FunctionName", Nothing)
            entityType.AddAnnotation("Relational:Schema", Nothing)
            entityType.AddAnnotation("Relational:SqlQuery", Nothing)
            entityType.AddAnnotation("Relational:TableName", "Data")
            entityType.AddAnnotation("Relational:ViewName", Nothing)
            entityType.AddAnnotation("Relational:ViewSchema", Nothing)

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value
            Dim Options = CreateCompiledModelCodeGenerationOptions()
            Options.ModelNamespace = "Microsoft.EntityFrameworkCore.Metadata"

            Test(
                New SqliteContext(),
                Options,
                Sub(code)
                    Assert.Collection(code,
                Sub(c) AssertFileContents("SqliteContextModel.vb", rm1, c),
                Sub(c) AssertFileContents("SqliteContextModelBuilder.vb", rm2, c),
                Sub(c) AssertFileContents("DataEntityType.vb", e1, c))

                End Sub,
                Sub(model)
                    Assert.Single(model.GetEntityTypes())
                    Dim dataEntity = model.FindEntityType(GetType(Data))

                    Assert.Equal(GetType(Data).FullName, dataEntity.Name)
                    Assert.False(dataEntity.HasSharedClrType)
                    Assert.False(dataEntity.IsPropertyBag)
                    Assert.False(dataEntity.IsOwned())
                    Assert.IsType(Of ConstructorBinding)(dataEntity.ConstructorBinding)
                    Assert.Null(dataEntity.FindIndexerPropertyInfo())
                    Assert.Equal(ChangeTrackingStrategy.Snapshot, dataEntity.GetChangeTrackingStrategy())
                    Assert.Equal("Data", dataEntity.GetTableName())
                    Assert.Null(dataEntity.GetSchema())

                    Dim point = dataEntity.FindProperty("Point")
                    Assert.Equal(GetType(Point), point.ClrType)
                    Assert.True(point.IsNullable)
                    Assert.Equal(ValueGenerated.Never, point.ValueGenerated)
                    Assert.Equal("Point", point.GetColumnName())
                    Assert.Equal("POINT", point.GetColumnType())
                    Assert.Null(point.GetValueConverter())
                    Assert.IsType(Of GeometryValueComparer(Of Point))(point.GetValueComparer())
                    Assert.IsType(Of GeometryValueComparer(Of Point))(point.GetKeyValueComparer())
                    Assert.Null(point.GetSrid())
                End Sub,
                GetType(SqliteNetTopologySuiteDesignTimeServices))
        End Sub

        Public Class SqliteContext
            Inherits Microsoft.EntityFrameworkCore.DbContext

            Protected Overrides Sub OnConfiguring(options As DbContextOptionsBuilder)
                options.
                    EnableServiceProviderCaching(False).
                    UseSqlite(Sub(o) o.UseNetTopologySuite())
            End Sub

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                modelBuilder.Model.RemoveAnnotation(CoreAnnotationNames.ProductVersion)

                modelBuilder.Entity(Of Data)(
                    Sub(eb)
                        eb.Property(Of Integer)("Id")
                        eb.HasKey("Id")
                        eb.Property(Of Point)("Point").HasSrid(1101)
                    End Sub)
            End Sub
        End Class

        <ConditionalFact>
        Public Sub Cosmos()

            Dim rm1 =
            <![CDATA[' <auto-generated />
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    <DbContext(GetType(VisualBasicRuntimeModelCodeGeneratorTest.CosmosContext))>
    Public Partial Class CosmosContextModel
        Inherits RuntimeModel

        Private Shared _Instance As CosmosContextModel
        Public Shared ReadOnly Property Instance As IModel
            Get
                Return _Instance
            End Get
        End Property

        Shared Sub New()
            Dim model As New CosmosContextModel()
            model.Initialize()
            model.Customize()
            _Instance = model
        End Sub

        Partial Private Sub Initialize()
        End Sub

        Partial Private Sub Customize()
        End Sub
    End Class
End Namespace
]]>.Value


            Dim rm2 =
            <![CDATA[' <auto-generated />
Imports System
Imports Microsoft.EntityFrameworkCore.Infrastructure
Imports Microsoft.EntityFrameworkCore.Metadata

Namespace TestNamespace
    Public Partial Class CosmosContextModel

        Private Sub Initialize()
            Dim data = DataEntityType.Create(Me)

            DataEntityType.CreateAnnotations(data)

            AddAnnotation("Cosmos:ContainerName", "Default")
        End Sub
    End Class
End Namespace
]]>.Value


            Dim e2 =
            <![CDATA[' <auto-generated />
Imports System
Imports System.Reflection
Imports EntityFrameworkCore.VisualBasic.Scaffolding.Internal
Imports Microsoft.EntityFrameworkCore.Cosmos.ValueGeneration
Imports Microsoft.EntityFrameworkCore.Metadata
Imports Newtonsoft.Json.Linq

Namespace TestNamespace
    Friend Partial Class DataEntityType

        Public Shared Function Create(model As RuntimeModel, Optional baseEntityType As RuntimeEntityType = Nothing) As RuntimeEntityType
            Dim entityType = model.AddEntityType(
                "EntityFrameworkCore.VisualBasic.Scaffolding.Internal.VisualBasicRuntimeModelCodeGeneratorTest+Data",
                GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data),
                baseEntityType)

            Dim id = entityType.AddProperty(
                "Id",
                GetType(Integer),
                afterSaveBehavior:=PropertySaveBehavior.Throw)

            Dim partitionId = entityType.AddProperty(
                "PartitionId",
                GetType(Long?),
                afterSaveBehavior:=PropertySaveBehavior.Throw,
                providerPropertyType:=GetType(String))

            Dim blob = entityType.AddProperty(
                "Blob",
                GetType(Byte()),
                propertyInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetProperty("Blob", BindingFlags.Public Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                fieldInfo:=GetType(VisualBasicRuntimeModelCodeGeneratorTest.Data).GetField("_Blob", BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly),
                nullable:=True)
            blob.AddAnnotation("Cosmos:PropertyName", "JsonBlob")

            Dim __id = entityType.AddProperty(
                "__id",
                GetType(String),
                afterSaveBehavior:=PropertySaveBehavior.Throw,
                valueGeneratorFactory:=AddressOf New IdValueGeneratorFactory().Create)
            __id.AddAnnotation("Cosmos:PropertyName", "id")

            Dim __jObject = entityType.AddProperty(
                "__jObject",
                GetType(JObject),
                nullable:=True,
                valueGenerated:=ValueGenerated.OnAddOrUpdate,
                beforeSaveBehavior:=PropertySaveBehavior.Ignore,
                afterSaveBehavior:=PropertySaveBehavior.Ignore)
            __jObject.AddAnnotation("Cosmos:PropertyName", "")

            Dim _etag = entityType.AddProperty(
                "_etag",
                GetType(String),
                nullable:=True,
                concurrencyToken:=True,
                valueGenerated:=ValueGenerated.OnAddOrUpdate,
                beforeSaveBehavior:=PropertySaveBehavior.Ignore,
                afterSaveBehavior:=PropertySaveBehavior.Ignore)

            Dim key = entityType.AddKey(
                {id, partitionId})
            entityType.SetPrimaryKey(key)

            Dim key0 = entityType.AddKey(
                {__id, partitionId})

            Return entityType
        End Function

        Public Shared Sub CreateAnnotations(entityType As RuntimeEntityType)
            entityType.AddAnnotation("Cosmos:ContainerName", "DataContainer")
            entityType.AddAnnotation("Cosmos:ETagName", "_etag")
            entityType.AddAnnotation("Cosmos:PartitionKeyName", "PartitionId")

            Customize(entityType)
        End Sub

        Shared Partial Private Sub Customize(entityType As RuntimeEntityType)
        End Sub
    End Class
End Namespace
]]>.Value

            Test(
                New CosmosContext(),
                CreateCompiledModelCodeGenerationOptions(),
            Sub(code)
                Assert.Collection(code,
                                  Sub(c) AssertFileContents("CosmosContextModel.vb", rm1, c),
                                  Sub(c) AssertFileContents("CosmosContextModelBuilder.vb", rm2, c),
                                  Sub(c) AssertFileContents("DataEntityType.vb", e2, c))
            End Sub,
        Sub(model)
            Assert.Single(model.GetEntityTypes())
            Dim dataEntity = model.FindEntityType(GetType(Data))
            Assert.Equal(GetType(Data).FullName, dataEntity.Name)
            Assert.False(dataEntity.HasSharedClrType)
            Assert.False(dataEntity.IsPropertyBag)
            Assert.False(dataEntity.IsOwned())
            Assert.IsType(Of ConstructorBinding)(dataEntity.ConstructorBinding)
            Assert.Null(dataEntity.FindIndexerPropertyInfo())
            Assert.Equal(ChangeTrackingStrategy.Snapshot, dataEntity.GetChangeTrackingStrategy())
            Assert.Equal("DataContainer", dataEntity.GetContainer())
            Assert.Null(dataEntity.FindDiscriminatorProperty())

            Dim id = dataEntity.FindProperty("Id")
            Assert.Equal(GetType(Integer), id.ClrType)
            Assert.Null(id.PropertyInfo)
            Assert.Null(id.FieldInfo)
            Assert.False(id.IsNullable)
            Assert.False(id.IsConcurrencyToken)
            Assert.Equal(ValueGenerated.Never, id.ValueGenerated)
            Assert.Equal(PropertySaveBehavior.Throw, id.GetAfterSaveBehavior())
            Assert.Equal(PropertySaveBehavior.Save, id.GetBeforeSaveBehavior())
            Assert.Equal("Id", CosmosPropertyExtensions.GetJsonPropertyName(id))
            Assert.Null(id.GetValueGeneratorFactory())
            Assert.Null(id.GetValueConverter())
            Assert.NotNull(id.GetValueComparer())
            Assert.NotNull(id.GetKeyValueComparer())

            Dim storeId = dataEntity.FindProperty("__id")
            Assert.Equal(GetType(String), storeId.ClrType)
            Assert.Null(storeId.PropertyInfo)
            Assert.Null(storeId.FieldInfo)
            Assert.False(storeId.IsNullable)
            Assert.False(storeId.IsConcurrencyToken)
            Assert.Equal(ValueGenerated.Never, storeId.ValueGenerated)
            Assert.Equal(PropertySaveBehavior.Throw, storeId.GetAfterSaveBehavior())
            Assert.Equal(PropertySaveBehavior.Save, storeId.GetBeforeSaveBehavior())
            Assert.Equal("id", CosmosPropertyExtensions.GetJsonPropertyName(storeId))
            Assert.IsType(Of IdValueGenerator)(storeId.GetValueGeneratorFactory()(storeId, dataEntity))
            Assert.Null(storeId.GetValueConverter())
            Assert.NotNull(storeId.GetValueComparer())
            Assert.NotNull(storeId.GetKeyValueComparer())

            Dim partitionId = dataEntity.FindProperty("PartitionId")
            Assert.Equal(GetType(Long?), partitionId.ClrType)
            Assert.Null(partitionId.PropertyInfo)
            Assert.Null(partitionId.FieldInfo)
            Assert.False(partitionId.IsNullable)
            Assert.False(partitionId.IsConcurrencyToken)
            Assert.Equal(ValueGenerated.Never, partitionId.ValueGenerated)
            Assert.Equal(PropertySaveBehavior.Throw, partitionId.GetAfterSaveBehavior())
            Assert.Equal(PropertySaveBehavior.Save, partitionId.GetBeforeSaveBehavior())
            Assert.Equal("PartitionId", CosmosPropertyExtensions.GetJsonPropertyName(partitionId))
            Assert.Null(partitionId.GetValueGeneratorFactory())
            Assert.Null(partitionId.GetValueConverter())
            Assert.IsType(Of NumberToStringConverter(Of Long))(partitionId.FindTypeMapping().Converter)
            Assert.NotNull(partitionId.GetValueComparer())
            Assert.NotNull(partitionId.GetKeyValueComparer())

            Dim eTag = dataEntity.FindProperty("_etag")
            Assert.Equal(GetType(String), eTag.ClrType)
            Assert.Null(eTag.PropertyInfo)
            Assert.Null(eTag.FieldInfo)
            Assert.True(eTag.IsNullable)
            Assert.True(eTag.IsConcurrencyToken)
            Assert.Equal(ValueGenerated.OnAddOrUpdate, eTag.ValueGenerated)
            Assert.Equal(PropertySaveBehavior.Ignore, eTag.GetAfterSaveBehavior())
            Assert.Equal(PropertySaveBehavior.Ignore, eTag.GetBeforeSaveBehavior())
            Assert.Equal("_etag", CosmosPropertyExtensions.GetJsonPropertyName(eTag))
            Assert.Null(eTag.GetValueGeneratorFactory())
            Assert.Null(eTag.GetValueConverter())
            Assert.NotNull(eTag.GetValueComparer())
            Assert.NotNull(eTag.GetKeyValueComparer())
            Assert.Equal("_etag", dataEntity.GetETagPropertyName())
            Assert.Same(eTag, dataEntity.GetETagProperty())

            Dim blob = dataEntity.FindProperty(NameOf(Data.Blob))
            Assert.Equal(GetType(Byte()), blob.ClrType)
            Assert.Equal(NameOf(Data.Blob), blob.PropertyInfo.Name)
            Assert.Equal("_Blob", blob.FieldInfo.Name)
            Assert.True(blob.IsNullable)
            Assert.False(blob.IsConcurrencyToken)
            Assert.Equal(ValueGenerated.Never, blob.ValueGenerated)
            Assert.Equal(PropertySaveBehavior.Save, blob.GetAfterSaveBehavior())
            Assert.Equal(PropertySaveBehavior.Save, blob.GetBeforeSaveBehavior())
            Assert.Equal("JsonBlob", CosmosPropertyExtensions.GetJsonPropertyName(blob))
            Assert.Null(blob.GetValueGeneratorFactory())
            Assert.Null(blob.GetValueConverter())
            Assert.NotNull(blob.GetValueComparer())
            Assert.NotNull(blob.GetKeyValueComparer())

            Dim jObject = dataEntity.FindProperty("__jObject")
            Assert.Equal(GetType(JObject), jObject.ClrType)
            Assert.Null(jObject.PropertyInfo)
            Assert.Null(jObject.FieldInfo)
            Assert.True(jObject.IsNullable)
            Assert.False(jObject.IsConcurrencyToken)
            Assert.Equal(ValueGenerated.OnAddOrUpdate, jObject.ValueGenerated)
            Assert.Equal(PropertySaveBehavior.Ignore, jObject.GetAfterSaveBehavior())
            Assert.Equal(PropertySaveBehavior.Ignore, jObject.GetBeforeSaveBehavior())
            Assert.Equal("", CosmosPropertyExtensions.GetJsonPropertyName(jObject))
            Assert.Null(jObject.GetValueGeneratorFactory())
            Assert.Null(jObject.GetValueConverter())
            Assert.NotNull(jObject.GetValueComparer())
            Assert.NotNull(jObject.GetKeyValueComparer())

            Assert.Equal(2, dataEntity.GetKeys().Count())

            Assert.Equal({id, partitionId, blob, storeId, jObject, eTag}, dataEntity.GetProperties())
        End Sub)
        End Sub

        Public Class CosmosContext
            Inherits DbContext

            Protected Overrides Sub OnConfiguring(options As DbContextOptionsBuilder)
                options.
                    EnableServiceProviderCaching(False).
                    UseCosmos("localhost", "_", "_")
            End Sub

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                modelBuilder.Model.RemoveAnnotation(CoreAnnotationNames.ProductVersion)

                modelBuilder.HasDefaultContainer("Default")

                modelBuilder.Entity(Of Data)(Sub(eb)
                                                 eb.Property(Of Integer)("Id")
                                                 eb.Property(Of Long?)("PartitionId").HasConversion(Of String)()
                                                 eb.HasPartitionKey("PartitionId")
                                                 eb.HasKey("Id", "PartitionId")
                                                 eb.ToContainer("DataContainer")
                                                 eb.UseETagConcurrency()
                                                 eb.HasNoDiscriminator()
                                                 eb.Property(Function(d) d.Blob).ToJsonProperty("JsonBlob")
                                             End Sub)
            End Sub
        End Class

        Public Class Data
            Public Property Blob As Byte()
        End Class

        Public MustInherit Class ContextBase
            Inherits DbContext

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                modelBuilder.Model.RemoveAnnotation(CoreAnnotationNames.ProductVersion)
            End Sub

            Protected Overrides Sub OnConfiguring(options As DbContextOptionsBuilder)
                options.EnableServiceProviderCaching(False).
                    UseInMemoryDatabase(NameOf(VisualBasicRuntimeModelCodeGeneratorTest))
            End Sub
        End Class

        Public MustInherit Class SqlServerContextBase
            Inherits DbContext

            Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
                modelBuilder.Model.RemoveAnnotation(CoreAnnotationNames.ProductVersion)
            End Sub

            Protected Overrides Sub OnConfiguring(options As DbContextOptionsBuilder)
                options.
                    EnableServiceProviderCaching(False).
                    UseSqlServer(Function(o) o.UseNetTopologySuite())
            End Sub
        End Class

        Protected Sub Test(context As DbContext,
                           options As CompiledModelCodeGenerationOptions,
                           Optional assertScaffold As Action(Of IReadOnlyCollection(Of ScaffoldedFile)) = Nothing,
                           Optional assertModel As Action(Of IModel) = Nothing,
                           Optional additionalDesignTimeServices As Type = Nothing,
                           Optional expectedExceptionMessage As String = Nothing)

            Dim model = context.GetService(Of IDesignTimeModel)().Model

            Dim services As New ServiceCollection()

            services.AddEntityFrameworkDesignTimeServices()

            Dim vbServices As New EFCoreVisualBasicServices
            vbServices.ConfigureDesignTimeServices(Services)

            If additionalDesignTimeServices IsNot Nothing Then
                ConfigureDesignTimeServices(additionalDesignTimeServices, Services)
            End If

            ConfigureProviderServices(context.GetService(Of IDatabaseProvider)().Name, Services)
            ConfigureVisualBasicProviderServices(context.GetService(Of IDatabaseProvider)().Name, Services)

            options.ModelNamespace = If(options.ModelNamespace, "TestNamespace")
            options.ContextType = context.GetType()

            Dim generator = Services.
                                BuildServiceProvider(validateScopes:=True).
                                GetRequiredService(Of ICompiledModelCodeGeneratorSelector)().
                                Select(options)

            If expectedExceptionMessage IsNot Nothing Then
                Assert.Equal(expectedExceptionMessage,
                    Assert.Throws(Of InvalidOperationException)(Sub() generator.GenerateModel(Model, options)).Message)
                Exit Sub
            End If

            Dim scaffoldedFiles = generator.GenerateModel(Model, options)

            Dim build As New BuildSource With {
                .Sources = scaffoldedFiles.ToDictionary(Function(f) f.Path, Function(f) f.Code)
            }

            With build.References
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.Abstractions"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.Cosmos"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.InMemory"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.Proxies"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.Relational"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.Sqlite"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.SqlServer"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.SqlServer.NetTopologySuite"))
                .Add(BuildReference.ByName("Microsoft.EntityFrameworkCore.Specification.Tests"))
                .Add(BuildReference.ByName("NetTopologySuite"))
                .Add(BuildReference.ByName("Newtonsoft.Json"))
                .Add(BuildReference.ByName(GetType(VisualBasicRuntimeModelCodeGeneratorTest).Assembly.GetName().Name))
            End With

            Dim Assembly = build.BuildInMemory()

            Dim modelType = Assembly.GetType(options.ModelNamespace & "." & options.ContextType.Name & "Model")
            Dim instancePropertyInfo = modelType.GetProperty("Instance", BindingFlags.Public Or BindingFlags.Static)
            Dim compiledModel = DirectCast(instancePropertyInfo.GetValue(Nothing), IModel)

            Dim ModelRuntimeInitializer = context.GetService(Of IModelRuntimeInitializer)()
            compiledModel = ModelRuntimeInitializer.Initialize(compiledModel, designTime:=False)
            assertModel(compiledModel)

            Dim RelationalModel = TryCast(context.Model.FindRuntimeAnnotationValue(RelationalAnnotationNames.RelationalModel), IRelationalModel)
            If RelationalModel IsNot Nothing Then
                Metadata.RelationalModelTest.AssertEqual(RelationalModel, compiledModel.GetRelationalModel())
            End If

            If assertScaffold IsNot Nothing Then
                assertScaffold(scaffoldedFiles)
            End If
        End Sub

        Private Sub ConfigureProviderServices(provider As String, services As IServiceCollection)
            Dim providerAssembly = Assembly.Load(New AssemblyName(provider))

            Dim providerServicesAttribute = providerAssembly.GetCustomAttribute(Of DesignTimeProviderServicesAttribute)
            If providerServicesAttribute Is Nothing Then
                Throw New InvalidOperationException(DesignStrings.CannotFindDesignTimeProviderAssemblyAttribute(provider))
            End If

            Dim designTimeServicesType = providerAssembly.GetType(
                providerServicesAttribute.TypeName,
                throwOnError:=True,
                ignoreCase:=False)

            ConfigureDesignTimeServices(designTimeServicesType, services)
        End Sub

        Private Sub ConfigureVisualBasicProviderServices(provider As String, services As IServiceCollection)

            Dim VBAssembly = Assembly.Load("EntityFrameworkCore.VisualBasic")

            Dim Types = VBAssembly.GetTypes().
                                        Where(Function(t) t.GetCustomAttributes(Of VisualBasicDesignTimeProviderServicesAttribute).
                                                            Any(Function(x) x.ProviderName IsNot Nothing AndAlso
                                                                            x.ProviderName = provider)).
                                        ToList()

            Types.ForEach(Sub(t) ConfigureDesignTimeServices(t, services))
        End Sub

        Private Shared Sub ConfigureDesignTimeServices(designTimeServicesType As Type,
                                                       services As IServiceCollection)
            Dim designTimeServices = DirectCast(Activator.CreateInstance(designTimeServicesType), IDesignTimeServices)
            designTimeServices.ConfigureDesignTimeServices(services)
        End Sub

        Protected Shared Sub AssertFileContents(expectedPath As String,
                                                expectedCode As String,
                                                file As ScaffoldedFile)

            Assert.Equal(expectedPath, file.Path)
            Assert.Equal(expectedCode, file.Code, ignoreLineEndingDifferences:=True)
        End Sub

        Private Function CreateCompiledModelCodeGenerationOptions() As CompiledModelCodeGenerationOptions
            Return New CompiledModelCodeGenerationOptions With {.Language = "VB"}
        End Function

    End Class

    Public Class Internal
        Public Property Id As Long
    End Class

    Public Class Index
        Public Property Id As Guid
    End Class

    Public Class IdentityUser
        Inherits TestModels.AspNetIdentity.IdentityUser
    End Class

    Public Class SelfReferentialEntity
        Public Property Id As Long

        Public Property Collection As SelfReferentialProperty
    End Class

    Public Class SelfReferentialProperty
        Inherits List(Of SelfReferentialProperty)
    End Class
End Namespace

Namespace Scaffolding.TestModel.Internal
    Public Class DbContext
        Inherits ContextBase

        Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)

            MyBase.OnModelCreating(modelBuilder)

            modelBuilder.Entity(Of Scaffolding.Internal.Index)()
            modelBuilder.Entity(Of TestModels.AspNetIdentity.IdentityUser)()
            modelBuilder.Entity(Of IdentityUser)(
            Sub(eb)
                eb.HasDiscriminator().HasValue("DerivedIdentityUser")
            End Sub)
            modelBuilder.Entity(Of Scaffolding.Internal.Internal)()
        End Sub
    End Class

    Public Class SelfReferentialDbContext
        Inherits ContextBase

        Protected Overrides Sub OnModelCreating(modelBuilder As ModelBuilder)
            MyBase.OnModelCreating(modelBuilder)

            modelBuilder.Entity(Of Scaffolding.Internal.SelfReferentialEntity)(
                Sub(eb)
                    eb.Property(Function(e) e.Collection).HasConversion(GetType(SelfReferentialPropertyValueConverter))
                End Sub)
        End Sub
    End Class

    Public Class SelfReferentialPropertyValueConverter
        Inherits ValueConverter(Of Scaffolding.Internal.SelfReferentialProperty, String)

        Public Sub New()
            Me.New(Nothing)
        End Sub

        Public Sub New(hints As ConverterMappingHints)
            MyBase.New(Function(v) Nothing, Function(v) Nothing, hints)
        End Sub
    End Class
End Namespace
